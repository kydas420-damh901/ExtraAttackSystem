using System;
using System.Collections.Generic;
using System.Linq;
using System.Reflection;
using System.Text;
using SoftReferenceableAssets;
using Splatform;
using UnityEngine;
using UnityEngine.Rendering;

// Token: 0x02000043 RID: 67
public class Player : Humanoid
{
	// Token: 0x06000331 RID: 817 RVA: 0x0003BB90 File Offset: 0x00039D90
	protected override void Awake()
	{
		base.Awake();
		Player.s_players.Add(this);
		this.m_skills = base.GetComponent<Skills>();
		this.SetupAwake();
		this.m_equipmentModifierValues = new float[Player.s_equipmentModifierSources.Length];
		if (Player.s_equipmentModifierSourceFields == null)
		{
			Player.s_equipmentModifierSourceFields = new FieldInfo[Player.s_equipmentModifierSources.Length];
			for (int i = 0; i < Player.s_equipmentModifierSources.Length; i++)
			{
				Player.s_equipmentModifierSourceFields[i] = typeof(ItemDrop.ItemData.SharedData).GetField(Player.s_equipmentModifierSources[i], BindingFlags.Instance | BindingFlags.Public);
			}
			if (Player.s_equipmentModifierSources.Length != Player.s_equipmentModifierTooltips.Length)
			{
				ZLog.LogError("Equipment modifier tooltip missmatch in player!");
			}
		}
		if (this.m_nview.GetZDO() == null)
		{
			return;
		}
		this.m_placeRayMask = LayerMask.GetMask(new string[]
		{
			"Default",
			"static_solid",
			"Default_small",
			"piece",
			"piece_nonsolid",
			"terrain",
			"vehicle"
		});
		this.m_placeWaterRayMask = LayerMask.GetMask(new string[]
		{
			"Default",
			"static_solid",
			"Default_small",
			"piece",
			"piece_nonsolid",
			"terrain",
			"Water",
			"vehicle"
		});
		this.m_removeRayMask = LayerMask.GetMask(new string[]
		{
			"Default",
			"static_solid",
			"Default_small",
			"piece",
			"piece_nonsolid",
			"terrain",
			"vehicle"
		});
		this.m_interactMask = LayerMask.GetMask(new string[]
		{
			"item",
			"piece",
			"piece_nonsolid",
			"Default",
			"static_solid",
			"Default_small",
			"character",
			"character_net",
			"terrain",
			"vehicle"
		});
		this.m_autoPickupMask = LayerMask.GetMask(new string[]
		{
			"item"
		});
		Inventory inventory = this.m_inventory;
		inventory.m_onChanged = (Action)Delegate.Combine(inventory.m_onChanged, new Action(this.OnInventoryChanged));
		if (Player.s_attackMask == 0)
		{
			Player.s_attackMask = LayerMask.GetMask(new string[]
			{
				"Default",
				"static_solid",
				"Default_small",
				"piece",
				"piece_nonsolid",
				"terrain",
				"character",
				"character_net",
				"character_ghost",
				"hitbox",
				"character_noenv",
				"vehicle"
			});
		}
		this.m_nview.Register("OnDeath", new Action<long>(this.RPC_OnDeath));
		this.m_nview.Register("RPC_HitWhileDodging", new Action<long>(this.RPC_HitWhileDodging));
		if (this.m_nview.IsOwner())
		{
			this.m_nview.Register<int, string, int>("Message", new Action<long, int, string, int>(this.RPC_Message));
			this.m_nview.Register<bool, bool>("OnTargeted", new Action<long, bool, bool>(this.RPC_OnTargeted));
			this.m_nview.Register<float>("UseStamina", new Action<long, float>(this.RPC_UseStamina));
			if (MusicMan.instance)
			{
				MusicMan.instance.TriggerMusic("Wakeup");
			}
			this.UpdateKnownRecipesList();
			this.UpdateAvailablePiecesList();
			this.SetupPlacementGhost();
			this.m_dodgeInvincibleCached = this.m_nview.GetZDO().GetBool(ZDOVars.s_dodgeinv, false);
		}
		this.m_placeRotation = UnityEngine.Random.Range(0, 16);
		float f = UnityEngine.Random.Range(0f, 6.2831855f);
		base.SetLookDir(new Vector3(Mathf.Cos(f), 0f, Mathf.Sin(f)), 0f);
		this.FaceLookDirection();
		this.AddQueuedKeys();
		this.UpdateCurrentSeason();
		this.m_attackTowardsPlayerLookDir = (PlatformPrefs.GetInt("AttackTowardsPlayerLookDir", 1) == 1);
	}

	// Token: 0x06000332 RID: 818 RVA: 0x0000CB92 File Offset: 0x0000AD92
	protected override void OnEnable()
	{
		base.OnEnable();
	}

	// Token: 0x06000333 RID: 819 RVA: 0x0000CB9A File Offset: 0x0000AD9A
	protected override void OnDisable()
	{
		base.OnDisable();
	}

	// Token: 0x06000334 RID: 820 RVA: 0x0003BF90 File Offset: 0x0003A190
	public void SetLocalPlayer()
	{
		if (Player.m_localPlayer == this)
		{
			return;
		}
		Player.m_localPlayer = this;
		Game.instance.IncrementPlayerStat(PlayerStatType.WorldLoads, 1f);
		ZNet.instance.SetReferencePosition(base.transform.position);
		EnvMan.instance.SetForceEnvironment("");
		this.AddQueuedKeys();
	}

	// Token: 0x06000335 RID: 821 RVA: 0x0003BFEC File Offset: 0x0003A1EC
	private void AddQueuedKeys()
	{
		if (Player.m_addUniqueKeyQueue.Count > 0)
		{
			foreach (string name in Player.m_addUniqueKeyQueue)
			{
				this.AddUniqueKey(name);
			}
			Player.m_addUniqueKeyQueue.Clear();
		}
	}

	// Token: 0x06000336 RID: 822 RVA: 0x0003C058 File Offset: 0x0003A258
	public void SetPlayerID(long playerID, string name)
	{
		if (this.m_nview.GetZDO() == null)
		{
			return;
		}
		if (this.GetPlayerID() != 0L)
		{
			return;
		}
		this.m_nview.GetZDO().Set(ZDOVars.s_playerID, playerID);
		this.m_nview.GetZDO().Set(ZDOVars.s_playerName, name);
	}

	// Token: 0x06000337 RID: 823 RVA: 0x0000CBA2 File Offset: 0x0000ADA2
	public long GetPlayerID()
	{
		if (!this.m_nview.IsValid())
		{
			return 0L;
		}
		return this.m_nview.GetZDO().GetLong(ZDOVars.s_playerID, 0L);
	}

	// Token: 0x06000338 RID: 824 RVA: 0x0000CBCB File Offset: 0x0000ADCB
	public string GetPlayerName()
	{
		if (!this.m_nview.IsValid())
		{
			return "";
		}
		return this.m_nview.GetZDO().GetString(ZDOVars.s_playerName, "...");
	}

	// Token: 0x06000339 RID: 825 RVA: 0x0000B141 File Offset: 0x00009341
	public override string GetHoverText()
	{
		return "";
	}

	// Token: 0x0600033A RID: 826 RVA: 0x0000CBFA File Offset: 0x0000ADFA
	public override string GetHoverName()
	{
		return CensorShittyWords.FilterUGC(this.GetPlayerName(), UGCType.CharacterName, this.GetPlayerID());
	}

	// Token: 0x0600033B RID: 827 RVA: 0x0000CC0E File Offset: 0x0000AE0E
	protected override void Start()
	{
		base.Start();
		base.InvalidateCachedLiquidDepth();
	}

	// Token: 0x0600033C RID: 828 RVA: 0x0003C0A8 File Offset: 0x0003A2A8
	protected override void OnDestroy()
	{
		ZDO zdo = this.m_nview.GetZDO();
		if (zdo != null && ZNet.instance != null)
		{
			ZLog.LogWarning(string.Concat(new string[]
			{
				"Player destroyed sec:",
				zdo.GetSector().ToString(),
				"  pos:",
				base.transform.position.ToString(),
				"  zdopos:",
				zdo.GetPosition().ToString(),
				"  ref ",
				ZNet.instance.GetReferencePosition().ToString()
			}));
		}
		if (this.m_placementGhost)
		{
			UnityEngine.Object.Destroy(this.m_placementGhost);
			this.m_placementGhost = null;
		}
		base.OnDestroy();
		Player.s_players.Remove(this);
		if (Player.m_localPlayer == this)
		{
			ZLog.LogWarning("Local player destroyed");
			Player.m_localPlayer = null;
		}
	}

	// Token: 0x0600033D RID: 829 RVA: 0x0003C1BC File Offset: 0x0003A3BC
	private void FixedUpdate()
	{
		float fixedDeltaTime = Time.fixedDeltaTime;
		this.UpdateAwake(fixedDeltaTime);
		if (this.m_nview.GetZDO() == null)
		{
			return;
		}
		this.UpdateTargeted(fixedDeltaTime);
		if (this.m_nview.IsOwner())
		{
			if (Player.m_localPlayer != this)
			{
				ZLog.Log("Destroying old local player");
				ZNetScene.instance.Destroy(base.gameObject);
				return;
			}
			if (this.IsDead())
			{
				return;
			}
			this.UpdateActionQueue(fixedDeltaTime);
			this.PlayerAttackInput(fixedDeltaTime);
			this.UpdateAttach();
			this.UpdateDoodadControls(fixedDeltaTime);
			this.UpdateCrouch(fixedDeltaTime);
			this.UpdateDodge(fixedDeltaTime);
			this.UpdateCover(fixedDeltaTime);
			this.UpdateStations(fixedDeltaTime);
			this.UpdateGuardianPower(fixedDeltaTime);
			this.UpdateBaseValue(fixedDeltaTime);
			this.UpdateStats(fixedDeltaTime);
			this.UpdateTeleport(fixedDeltaTime);
			this.AutoPickup(fixedDeltaTime);
			this.EdgeOfWorldKill(fixedDeltaTime);
			this.UpdateBiome(fixedDeltaTime);
			this.UpdateStealth(fixedDeltaTime);
			if (GameCamera.instance && this.m_attachPointCamera == null && Vector3.Distance(GameCamera.instance.transform.position, base.transform.position) < 2f)
			{
				base.SetVisible(false);
			}
			AudioMan.instance.SetIndoor(this.InShelter() || ShieldGenerator.IsInsideShield(base.transform.position));
		}
	}

	// Token: 0x0600033E RID: 830 RVA: 0x0003C308 File Offset: 0x0003A508
	private void Update()
	{
		bool flag = InventoryGui.IsVisible();
		if (ZInput.InputLayout != InputLayout.Default && ZInput.IsGamepadActive() && !flag && (ZInput.GetButtonUp("JoyAltPlace") && ZInput.GetButton("JoyAltKeys")))
		{
			this.m_altPlace = !this.m_altPlace;
			if (MessageHud.instance != null)
			{
				string str = Localization.instance.Localize("$hud_altplacement");
				string str2 = this.m_altPlace ? Localization.instance.Localize("$hud_on") : Localization.instance.Localize("$hud_off");
				MessageHud.instance.ShowMessage(MessageHud.MessageType.TopLeft, str + " " + str2, 0, null, false);
			}
		}
		this.UpdateClothFix();
		if (!this.m_nview.IsValid())
		{
			return;
		}
		if (!this.m_nview.IsOwner())
		{
			return;
		}
		bool flag2 = this.TakeInput();
		this.UpdateHover();
		if (flag2)
		{
			if (Player.m_debugMode && global::Console.instance.IsCheatsEnabled())
			{
				if (ZInput.GetKeyDown(KeyCode.Z, true))
				{
					this.ToggleDebugFly();
				}
				if (ZInput.GetKeyDown(KeyCode.B, true))
				{
					this.ToggleNoPlacementCost();
				}
				if (ZInput.GetKeyDown(KeyCode.K, true))
				{
					global::Console.instance.TryRunCommand("killenemies", false, false);
				}
				if (ZInput.GetKeyDown(KeyCode.L, true))
				{
					global::Console.instance.TryRunCommand("removedrops", false, false);
				}
			}
			bool alt = (ZInput.IsNonClassicFunctionality() && ZInput.IsGamepadActive()) ? ZInput.GetButton("JoyAltKeys") : (ZInput.GetButton("AltPlace") || ZInput.GetButton("JoyAltPlace"));
			if ((ZInput.GetButtonDown("Use") || ZInput.GetButtonDown("JoyUse")) && !Hud.InRadial())
			{
				if (this.m_hovering)
				{
					this.Interact(this.m_hovering, false, alt);
				}
				else if (this.m_doodadController != null)
				{
					this.StopDoodadControl();
				}
			}
			else if ((ZInput.GetButton("Use") || ZInput.GetButton("JoyUse")) && !Hud.InRadial() && this.m_hovering)
			{
				this.Interact(this.m_hovering, true, alt);
			}
			bool flag3 = !Hud.InRadial() && ZInput.GetButtonUp("JoyHide") && ZInput.GetButtonLastPressedTimer("JoyHide") < 0.33f;
			if ((ZInput.InputLayout != InputLayout.Default && ZInput.IsGamepadActive()) ? (!this.InPlaceMode() && flag3 && !ZInput.GetButton("JoyAltKeys")) : (ZInput.GetButtonDown("Hide") || (flag3 && !ZInput.GetButton("JoyAltKeys") && !this.InPlaceMode())))
			{
				if (base.GetRightItem() != null || base.GetLeftItem() != null)
				{
					if (!this.InAttack() && !this.InDodge())
					{
						base.HideHandItems(false, true);
					}
				}
				else if ((!base.IsSwimming() || base.IsOnGround()) && !this.InDodge())
				{
					base.ShowHandItems(false, true);
				}
			}
			if (ZInput.GetButtonDown("ToggleWalk") && !Hud.InRadial())
			{
				base.SetWalk(!base.GetWalk());
				if (base.GetWalk())
				{
					this.Message(MessageHud.MessageType.TopLeft, "$msg_walk $hud_on", 0, null);
				}
				else
				{
					this.Message(MessageHud.MessageType.TopLeft, "$msg_walk $hud_off", 0, null);
				}
			}
			this.HandleRadialInput();
			bool flag4 = ZInput.IsGamepadActive() && !ZInput.GetButton("JoyAltKeys");
			bool flag5 = ZInput.InputLayout == InputLayout.Default && ZInput.GetButtonDown("JoyGP");
			bool flag6 = ZInput.IsNonClassicFunctionality() && ZInput.GetButton("JoyLStick") && ZInput.GetButton("JoyRStick");
			if (!Hud.InRadial() && !Hud.IsPieceSelectionVisible() && (ZInput.GetButtonDown("GP") || (flag4 && (flag5 || flag6))))
			{
				this.StartGuardianPower();
			}
			bool flag7 = ZInput.GetButtonDown("JoyAutoPickup") && ZInput.GetButton("JoyAltKeys");
			if (ZInput.GetButtonDown("AutoPickup") || flag7)
			{
				Player.m_enableAutoPickup = !Player.m_enableAutoPickup;
				this.Message(MessageHud.MessageType.TopLeft, "$hud_autopickup:" + (Player.m_enableAutoPickup ? "$hud_on" : "$hud_off"), 0, null);
			}
			if (ZInput.GetButtonDown("Hotbar1"))
			{
				this.UseHotbarItem(1);
			}
			if (ZInput.GetButtonDown("Hotbar2"))
			{
				this.UseHotbarItem(2);
			}
			if (ZInput.GetButtonDown("Hotbar3"))
			{
				this.UseHotbarItem(3);
			}
			if (ZInput.GetButtonDown("Hotbar4"))
			{
				this.UseHotbarItem(4);
			}
			if (ZInput.GetButtonDown("Hotbar5"))
			{
				this.UseHotbarItem(5);
			}
			if (ZInput.GetButtonDown("Hotbar6"))
			{
				this.UseHotbarItem(6);
			}
			if (ZInput.GetButtonDown("Hotbar7"))
			{
				this.UseHotbarItem(7);
			}
			if (ZInput.GetButtonDown("Hotbar8"))
			{
				this.UseHotbarItem(8);
			}
		}
		this.UpdatePlacement(flag2, Time.deltaTime);
		this.UpdateStats();
	}

	// Token: 0x0600033F RID: 831 RVA: 0x0003C7C0 File Offset: 0x0003A9C0
	private void UpdateClothFix()
	{
		float magnitude = base.GetVelocity().magnitude;
		if (magnitude > 0.01f && this.m_lastVelocity < 0.01f)
		{
			base.ResetCloth();
			Terminal.Increment("resetcloth", 1);
		}
		this.m_lastVelocity = magnitude;
	}

	// Token: 0x06000340 RID: 832 RVA: 0x0003C80C File Offset: 0x0003AA0C
	private void HandleRadialInput()
	{
		if (!Hud.InRadial())
		{
			if (!Hud.instance.m_radialMenu.CanOpen)
			{
				Hud.instance.m_radialMenu.CanOpen = (ZInput.GetButtonDown("JoyRadial") || ZInput.GetButtonDown("OpenRadial") || ZInput.GetButtonDown("OpenEmote"));
			}
			if ((!ZInput.GetButton("JoyAltKeys") && ZInput.GetButtonPressedTimer("JoyRadial") > 0.33f) || ZInput.GetButtonDown("OpenRadial") || ZInput.GetButtonDown("OpenEmote"))
			{
				Hud.instance.m_radialMenu.Open(Hud.instance.m_config, null);
				return;
			}
			if ((!this.InPlaceMode() && !ZInput.GetButton("JoyAltKeys") && ZInput.GetButtonUp("JoySit")) || ZInput.GetButtonDown("Sit"))
			{
				if (this.InEmote() && this.IsSitting())
				{
					this.StopEmote();
					return;
				}
				this.StartEmote("sit", false);
				return;
			}
		}
		else if (!Hud.instance.m_radialMenu.CanThrow && (ZInput.GetButtonDown("JoyRadialSecondaryInteract") || ZInput.GetButtonDown("RadialSecondaryInteract")))
		{
			Hud.instance.m_radialMenu.CanThrow = true;
		}
	}

	// Token: 0x06000341 RID: 833 RVA: 0x0003C944 File Offset: 0x0003AB44
	private void UpdateStats()
	{
		if (this.IsDebugFlying())
		{
			return;
		}
		this.m_statCheck += Time.deltaTime;
		if (this.m_statCheck < 0.5f)
		{
			return;
		}
		this.m_statCheck = 0f;
		PlayerProfile playerProfile = Game.instance.GetPlayerProfile();
		playerProfile.IncrementStat(this.IsSafeInHome() ? PlayerStatType.TimeInBase : PlayerStatType.TimeOutOfBase, 0.5f);
		float num = Vector3.Distance(base.transform.position, this.m_lastDistCheck);
		if (num > 1f)
		{
			if (num < 20f)
			{
				playerProfile.IncrementStat(PlayerStatType.DistanceTraveled, num);
				if (Ship.GetLocalShip() != null)
				{
					playerProfile.IncrementStat(PlayerStatType.DistanceSail, 1f);
				}
				else if (base.IsOnGround())
				{
					playerProfile.IncrementStat(base.IsRunning() ? PlayerStatType.DistanceRun : PlayerStatType.DistanceWalk, num);
				}
				else
				{
					playerProfile.IncrementStat(PlayerStatType.DistanceAir, num);
				}
			}
			this.m_lastDistCheck = base.transform.position;
		}
	}

	// Token: 0x06000342 RID: 834 RVA: 0x0003CA30 File Offset: 0x0003AC30
	private float GetBuildStamina()
	{
		float num = base.GetRightItem().m_shared.m_attack.m_attackStamina;
		num *= 1f + this.GetEquipmentHomeItemModifier();
		this.m_seman.ModifyHomeItemStaminaUsage(num, ref num, true);
		if (this.m_buildPieces.m_skill != Skills.SkillType.None)
		{
			float skillFactor = this.GetSkillFactor(this.m_buildPieces.m_skill);
			num -= num * 0.5f * skillFactor;
		}
		return num;
	}

	// Token: 0x06000343 RID: 835 RVA: 0x0003CAA0 File Offset: 0x0003ACA0
	private void UpdatePlacement(bool takeInput, float dt)
	{
		this.UpdateWearNTearHover();
		if (this.InPlaceMode() && !this.IsDead())
		{
			if (!takeInput)
			{
				return;
			}
			this.UpdateBuildGuiInput();
			if (Hud.IsPieceSelectionVisible())
			{
				return;
			}
			ItemDrop.ItemData rightItem = base.GetRightItem();
			if ((ZInput.GetButton("AltPlace") || ZInput.GetButton("JoyAltKeys")) && (ZInput.GetButtonDown("JoyLStick") || ZInput.GetButtonDown("JoyRStick") || ZInput.GetButtonDown("JoyButtonA") || ZInput.GetButtonDown("JoyButtonB") || ZInput.GetButtonDown("JoyButtonX") || ZInput.GetButtonDown("JoyButtonY") || ZInput.GetButtonDown("JoyDPadUp") || ZInput.GetButtonDown("JoyDPadDown") || ZInput.GetButtonDown("JoyDPadLeft") || ZInput.GetButtonDown("JoyDPadRight")))
			{
				this.m_blockRemove = true;
			}
			if ((ZInput.GetButtonDown("Remove") || ZInput.GetButtonDown("JoyRemove")) && (ZInput.GetButton("AltPlace") || ZInput.GetButton("JoyAltKeys")) && (ZInput.InputLayout == InputLayout.Default || !ZInput.IsGamepadActive()))
			{
				this.CopyPiece();
				this.m_blockRemove = true;
			}
			else if (!this.m_blockRemove && (ZInput.GetButtonUp("Remove") || ZInput.GetButtonUp("JoyRemove")))
			{
				this.m_removePressedTime = Time.time;
			}
			if (!ZInput.GetButton("AltPlace") && !ZInput.GetButton("JoyAltKeys"))
			{
				this.m_blockRemove = false;
			}
			Piece hoveringPiece = this.GetHoveringPiece();
			Feast feast;
			if (hoveringPiece)
			{
				Feast component = hoveringPiece.GetComponent<Feast>();
				if (component != null)
				{
					feast = component;
					goto IL_181;
				}
			}
			feast = null;
			IL_181:
			Feast exists = feast;
			ItemDrop itemDrop;
			if (hoveringPiece)
			{
				ItemDrop component2 = hoveringPiece.GetComponent<ItemDrop>();
				if (component2 != null)
				{
					itemDrop = component2;
					goto IL_19B;
				}
			}
			itemDrop = null;
			IL_19B:
			ItemDrop itemDrop2 = itemDrop;
			bool flag = (rightItem.m_shared.m_buildPieces.m_canRemovePieces && (!hoveringPiece || (!exists && (!itemDrop2 || !itemDrop2.IsPiece())))) || (rightItem.m_shared.m_buildPieces.m_canRemoveFeasts && (!hoveringPiece || exists || (itemDrop2 && itemDrop2.IsPiece())));
			if (Time.time - this.m_removePressedTime < 0.2f && flag && Time.time - this.m_lastToolUseTime > this.m_removeDelay)
			{
				this.m_removePressedTime = -9999f;
				if (this.HaveStamina(rightItem.m_shared.m_attack.m_attackStamina))
				{
					if (this.RemovePiece())
					{
						this.m_lastToolUseTime = Time.time;
						base.AddNoise(50f);
						this.UseStamina(this.GetBuildStamina());
						if (this.m_buildPieces.m_skill != Skills.SkillType.None && this.m_buildRemoveDebt < 20)
						{
							this.m_buildRemoveDebt++;
						}
						if (rightItem.m_shared.m_useDurability)
						{
							rightItem.m_durability -= this.GetPlaceDurability(rightItem);
						}
						rightItem.m_shared.m_destroyEffect.Create(hoveringPiece.transform.position, Quaternion.identity, null, 1f, -1);
					}
				}
				else
				{
					Hud.instance.StaminaBarEmptyFlash();
				}
			}
			if ((ZInput.GetButtonDown("Attack") || ZInput.GetButtonDown("JoyPlace")) && !Hud.InRadial())
			{
				this.m_placePressedTime = Time.time;
			}
			if (Time.time - this.m_placePressedTime < 0.2f && Time.time - this.m_lastToolUseTime > this.m_placeDelay)
			{
				this.m_placePressedTime = -9999f;
				if (ZInput.GetButton("JoyAltKeys"))
				{
					this.CopyPiece();
					this.m_blockRemove = true;
				}
				else
				{
					Piece selectedPiece = this.m_buildPieces.GetSelectedPiece();
					if (selectedPiece != null)
					{
						if (this.HaveStamina(rightItem.m_shared.m_attack.m_attackStamina))
						{
							if (selectedPiece.m_repairPiece)
							{
								this.Repair(rightItem, selectedPiece);
							}
							else if (selectedPiece.m_removePiece && flag)
							{
								this.RemovePiece();
							}
							else if (this.m_placementGhost != null)
							{
								if (this.m_noPlacementCost || this.HaveRequirements(selectedPiece, Player.RequirementMode.CanBuild))
								{
									if (this.TryPlacePiece(selectedPiece))
									{
										this.m_lastToolUseTime = Time.time;
										if (!ZoneSystem.instance.GetGlobalKey(selectedPiece.FreeBuildKey()))
										{
											this.ConsumeResources(selectedPiece.m_resources, 0, -1, 1);
										}
										this.UseStamina(this.GetBuildStamina());
										if (this.m_buildPieces.m_skill != Skills.SkillType.None)
										{
											if (this.m_buildRemoveDebt > 0)
											{
												this.m_buildRemoveDebt--;
											}
											else
											{
												this.RaiseSkill(this.m_buildPieces.m_skill, 1f);
											}
										}
										if (rightItem.m_shared.m_useDurability)
										{
											rightItem.m_durability -= this.GetPlaceDurability(rightItem);
										}
										rightItem.m_shared.m_buildEffect.Create(base.transform.position, Quaternion.identity, null, 1f, -1);
									}
								}
								else
								{
									this.Message(MessageHud.MessageType.Center, "$msg_missingrequirement", 0, null);
								}
							}
						}
						else
						{
							Hud.instance.StaminaBarEmptyFlash();
						}
					}
				}
			}
			if (this.m_placementGhost)
			{
				IPieceMarker component3 = this.m_placementGhost.gameObject.GetComponent<IPieceMarker>();
				if (component3 != null)
				{
					component3.ShowBuildMarker();
				}
			}
			if (hoveringPiece)
			{
				IPieceMarker component4 = hoveringPiece.gameObject.GetComponent<IPieceMarker>();
				if (component4 != null)
				{
					component4.ShowHoverMarker();
				}
			}
			if (this.m_placementGhost)
			{
				Piece component5 = this.m_placementGhost.GetComponent<Piece>();
				if (component5 != null && component5.m_canRotate && this.m_placementGhost.activeInHierarchy)
				{
					this.m_scrollCurrAmount += ZInput.GetMouseScrollWheel();
					if (this.m_scrollCurrAmount > this.m_scrollAmountThreshold)
					{
						this.m_scrollCurrAmount = 0f;
						this.m_placeRotation++;
					}
					if (this.m_scrollCurrAmount < -this.m_scrollAmountThreshold)
					{
						this.m_scrollCurrAmount = 0f;
						this.m_placeRotation--;
					}
				}
			}
			float num = 0f;
			bool flag2 = false;
			if (ZInput.IsGamepadActive())
			{
				switch (ZInput.InputLayout)
				{
				case InputLayout.Default:
					num = ZInput.GetJoyRightStickX(true);
					flag2 = (ZInput.GetButton("JoyRotate") && Mathf.Abs(num) > 0.5f);
					break;
				case InputLayout.Alternative1:
				{
					bool button = ZInput.GetButton("JoyRotate");
					bool button2 = ZInput.GetButton("JoyRotateRight");
					flag2 = (button || button2);
					if (button)
					{
						num = 0.5f;
					}
					else if (button2)
					{
						num = -0.5f;
					}
					break;
				}
				case InputLayout.Alternative2:
				{
					object obj = ZInput.GetButtonLastPressedTimer("JoyRotate") < 0.33f && ZInput.GetButtonUp("JoyRotate");
					bool button3 = ZInput.GetButton("JoyRotateRight");
					object obj2 = obj;
					flag2 = ((obj2 | button3) != null);
					if (obj2 != null)
					{
						num = 0.5f;
					}
					else if (button3)
					{
						num = -0.5f;
					}
					break;
				}
				}
			}
			if (flag2)
			{
				if (this.m_rotatePieceTimer == 0f)
				{
					if (num < 0f)
					{
						this.m_placeRotation++;
					}
					else
					{
						this.m_placeRotation--;
					}
				}
				else if (this.m_rotatePieceTimer > 0.25f)
				{
					if (num < 0f)
					{
						this.m_placeRotation++;
					}
					else
					{
						this.m_placeRotation--;
					}
					this.m_rotatePieceTimer = 0.17f;
				}
				this.m_rotatePieceTimer += dt;
			}
			else
			{
				this.m_rotatePieceTimer = 0f;
			}
			using (Dictionary<Material, float>.Enumerator enumerator = this.m_ghostRippleDistance.GetEnumerator())
			{
				while (enumerator.MoveNext())
				{
					KeyValuePair<Material, float> keyValuePair = enumerator.Current;
					keyValuePair.Key.SetFloat("_RippleDistance", ZInput.GetKey(KeyCode.LeftControl, true) ? keyValuePair.Value : 0f);
				}
				return;
			}
		}
		if (this.m_placementGhost)
		{
			this.m_placementGhost.SetActive(false);
		}
	}

	// Token: 0x06000344 RID: 836 RVA: 0x0003D288 File Offset: 0x0003B488
	private float GetPlaceDurability(ItemDrop.ItemData tool)
	{
		float num = tool.m_shared.m_useDurabilityDrain;
		if (tool.m_shared.m_placementDurabilitySkill != Skills.SkillType.None)
		{
			float skillFactor = this.GetSkillFactor(tool.m_shared.m_placementDurabilitySkill);
			num -= num * tool.m_shared.m_placementDurabilityMax * skillFactor;
		}
		return num;
	}

	// Token: 0x06000345 RID: 837 RVA: 0x0003D2D4 File Offset: 0x0003B4D4
	private void UpdateBuildGuiInputAlternative1()
	{
		if (!Hud.IsPieceSelectionVisible() && ZInput.GetButtonDown("JoyBuildMenu") && !PlayerController.HasInputDelay && !Hud.InRadial())
		{
			for (int i = 0; i < this.m_buildPieces.m_selectedPiece.Length; i++)
			{
				this.m_buildPieces.m_lastSelectedPiece[i] = this.m_buildPieces.m_selectedPiece[i];
			}
			Hud.instance.TogglePieceSelection();
			return;
		}
		if (Hud.IsPieceSelectionVisible())
		{
			if (ZInput.GetKeyDown(KeyCode.Escape, true) || ZInput.GetButtonDown("JoyButtonB") || ZInput.GetButtonDown("BuildMenu"))
			{
				for (int j = 0; j < this.m_buildPieces.m_selectedPiece.Length; j++)
				{
					this.m_buildPieces.m_selectedPiece[j] = this.m_buildPieces.m_lastSelectedPiece[j];
				}
				Hud.HidePieceSelection();
				this.SetupPlacementGhost();
			}
			if (ZInput.GetButtonDown("JoyButtonA"))
			{
				Hud.HidePieceSelection();
				this.PlayButtonSound();
			}
			this.m_scrollCurrAmount += ZInput.GetMouseScrollWheel();
			if (ZInput.GetButtonDown("JoyTabLeft") || ZInput.GetButtonDown("TabLeft") || this.m_scrollCurrAmount > this.m_scrollAmountThreshold)
			{
				this.m_scrollCurrAmount = 0f;
				this.m_buildPieces.PrevCategory();
				this.UpdateAvailablePiecesList();
			}
			if (ZInput.GetButtonDown("JoyTabRight") || ZInput.GetButtonDown("TabRight") || this.m_scrollCurrAmount < -this.m_scrollAmountThreshold)
			{
				this.m_scrollCurrAmount = 0f;
				this.m_buildPieces.NextCategory();
				this.UpdateAvailablePiecesList();
			}
			if (ZInput.GetButtonDown("JoyLStickLeft") || ZInput.GetButtonDown("JoyDPadLeft"))
			{
				this.m_buildPieces.LeftPiece();
				this.SetupPlacementGhost();
			}
			if (ZInput.GetButtonDown("JoyLStickRight") || ZInput.GetButtonDown("JoyDPadRight"))
			{
				this.m_buildPieces.RightPiece();
				this.SetupPlacementGhost();
			}
			if (ZInput.GetButtonDown("JoyLStickUp") || ZInput.GetButtonDown("JoyDPadUp"))
			{
				this.m_buildPieces.UpPiece();
				this.SetupPlacementGhost();
			}
			if (ZInput.GetButtonDown("JoyLStickDown") || ZInput.GetButtonDown("JoyDPadDown"))
			{
				this.m_buildPieces.DownPiece();
				this.SetupPlacementGhost();
			}
		}
	}

	// Token: 0x06000346 RID: 838 RVA: 0x0003D50C File Offset: 0x0003B70C
	private void UpdateBuildGuiInput()
	{
		if (ZInput.IsNonClassicFunctionality() && ZInput.IsGamepadActive())
		{
			this.UpdateBuildGuiInputAlternative1();
			return;
		}
		if (!Hud.IsPieceSelectionVisible())
		{
			if (Hud.instance.IsQuickPieceSelectEnabled())
			{
				if (!Hud.IsPieceSelectionVisible() && ZInput.GetButtonDown("BuildMenu") && !PlayerController.HasInputDelay && !Hud.InRadial())
				{
					Hud.instance.TogglePieceSelection();
				}
			}
			else if (ZInput.GetButtonDown("BuildMenu") && !PlayerController.HasInputDelay && !Hud.InRadial())
			{
				Hud.instance.TogglePieceSelection();
			}
			if (ZInput.GetButtonDown("JoyUse") && !PlayerController.HasInputDelay && !Hud.InRadial())
			{
				Hud.instance.TogglePieceSelection();
				return;
			}
		}
		else if (Hud.IsPieceSelectionVisible())
		{
			if (ZInput.GetKeyDown(KeyCode.Escape, true) || ZInput.GetButtonDown("JoyButtonB") || ZInput.GetButtonDown("BuildMenu"))
			{
				Hud.HidePieceSelection();
			}
			if (ZInput.GetButtonDown("JoyUse"))
			{
				Hud.HidePieceSelection();
				this.PlayButtonSound();
			}
			this.m_scrollCurrAmount += ZInput.GetMouseScrollWheel();
			if (ZInput.GetButtonDown("JoyTabLeft") || ZInput.GetButtonDown("TabLeft") || this.m_scrollCurrAmount > this.m_scrollAmountThreshold)
			{
				this.m_scrollCurrAmount = 0f;
				this.m_buildPieces.PrevCategory();
				this.UpdateAvailablePiecesList();
			}
			if (ZInput.GetButtonDown("JoyTabRight") || ZInput.GetButtonDown("TabRight") || this.m_scrollCurrAmount < -this.m_scrollAmountThreshold)
			{
				this.m_scrollCurrAmount = 0f;
				this.m_buildPieces.NextCategory();
				this.UpdateAvailablePiecesList();
			}
			if (ZInput.GetButtonDown("JoyLStickLeft") || ZInput.GetButtonDown("JoyDPadLeft"))
			{
				this.m_buildPieces.LeftPiece();
				this.SetupPlacementGhost();
			}
			if (ZInput.GetButtonDown("JoyLStickRight") || ZInput.GetButtonDown("JoyDPadRight"))
			{
				this.m_buildPieces.RightPiece();
				this.SetupPlacementGhost();
			}
			if (ZInput.GetButtonDown("JoyLStickUp") || ZInput.GetButtonDown("JoyDPadUp"))
			{
				this.m_buildPieces.UpPiece();
				this.SetupPlacementGhost();
			}
			if (ZInput.GetButtonDown("JoyLStickDown") || ZInput.GetButtonDown("JoyDPadDown"))
			{
				this.m_buildPieces.DownPiece();
				this.SetupPlacementGhost();
			}
		}
	}

	// Token: 0x06000347 RID: 839 RVA: 0x0000CC1C File Offset: 0x0000AE1C
	private void PlayButtonSound()
	{
		if (Player.m_localPlayer)
		{
			EffectList buttonEffects = this.m_buttonEffects;
			if (buttonEffects == null)
			{
				return;
			}
			buttonEffects.Create(Player.m_localPlayer.transform.position, Quaternion.identity, null, 1f, -1);
		}
	}

	// Token: 0x06000348 RID: 840 RVA: 0x0003D748 File Offset: 0x0003B948
	public bool SetSelectedPiece(Piece p)
	{
		Vector2Int selectedPiece;
		int buildCategory;
		if (this.m_buildPieces.GetPieceIndex(p, out selectedPiece, out buildCategory))
		{
			this.SetBuildCategory(buildCategory);
			this.SetSelectedPiece(selectedPiece);
			return true;
		}
		return false;
	}

	// Token: 0x06000349 RID: 841 RVA: 0x0000CC56 File Offset: 0x0000AE56
	public void SetSelectedPiece(Vector2Int p)
	{
		if (this.m_buildPieces && this.m_buildPieces.GetSelectedIndex() != p)
		{
			this.m_buildPieces.SetSelected(p);
			this.SetupPlacementGhost();
		}
	}

	// Token: 0x0600034A RID: 842 RVA: 0x0000CC8A File Offset: 0x0000AE8A
	public Piece GetPiece(Vector2Int p)
	{
		if (!(this.m_buildPieces != null))
		{
			return null;
		}
		return this.m_buildPieces.GetPiece(p);
	}

	// Token: 0x0600034B RID: 843 RVA: 0x0000CCA8 File Offset: 0x0000AEA8
	public bool IsPieceAvailable(Piece piece)
	{
		return this.m_buildPieces != null && this.m_buildPieces.IsPieceAvailable(piece);
	}

	// Token: 0x0600034C RID: 844 RVA: 0x0000CCC6 File Offset: 0x0000AEC6
	public Piece GetSelectedPiece()
	{
		if (!(this.m_buildPieces != null))
		{
			return null;
		}
		return this.m_buildPieces.GetSelectedPiece();
	}

	// Token: 0x0600034D RID: 845 RVA: 0x0000CCE3 File Offset: 0x0000AEE3
	private void LateUpdate()
	{
		if (!this.m_nview.IsValid())
		{
			return;
		}
		this.UpdateEmote();
		if (this.m_nview.IsOwner())
		{
			ZNet.instance.SetReferencePosition(base.transform.position);
			this.UpdatePlacementGhost(false);
		}
	}

	// Token: 0x0600034E RID: 846 RVA: 0x0003D778 File Offset: 0x0003B978
	public void UpdateEvents()
	{
		if (!RandEventSystem.instance)
		{
			return;
		}
		this.m_readyEvents.Clear();
		foreach (RandomEvent randomEvent in RandEventSystem.instance.m_events)
		{
			if (RandEventSystem.instance.PlayerIsReadyForEvent(this, randomEvent))
			{
				this.m_readyEvents.Add(randomEvent.m_name);
			}
		}
		if (ZNet.instance)
		{
			RandEventSystem.SetRandomEventsNeedsRefresh();
			ZNet.instance.m_serverSyncedPlayerData["possibleEvents"] = string.Join(",", this.m_readyEvents);
		}
	}

	// Token: 0x0600034F RID: 847 RVA: 0x0003D834 File Offset: 0x0003BA34
	private void SetupAwake()
	{
		if (this.m_nview.GetZDO() == null)
		{
			this.m_animator.SetBool("wakeup", false);
			return;
		}
		bool @bool = this.m_nview.GetZDO().GetBool(ZDOVars.s_wakeup, true);
		this.m_animator.SetBool("wakeup", @bool);
		if (@bool)
		{
			this.m_wakeupTimer = 0f;
		}
	}

	// Token: 0x06000350 RID: 848 RVA: 0x0003D898 File Offset: 0x0003BA98
	private void UpdateAwake(float dt)
	{
		if (this.m_wakeupTimer >= 0f)
		{
			this.m_wakeupTimer += dt;
			if (this.m_wakeupTimer > 1f)
			{
				this.m_wakeupTimer = -1f;
				this.m_animator.SetBool("wakeup", false);
				if (this.m_nview.IsOwner())
				{
					this.m_nview.GetZDO().Set(ZDOVars.s_wakeup, false);
				}
			}
		}
	}

	// Token: 0x06000351 RID: 849 RVA: 0x0003D90C File Offset: 0x0003BB0C
	private void EdgeOfWorldKill(float dt)
	{
		if (this.IsDead())
		{
			return;
		}
		float num = global::Utils.DistanceXZ(Vector3.zero, base.transform.position);
		float num2 = 10420f;
		if (num > num2 && (base.IsSwimming() || base.transform.position.y < 30f))
		{
			Vector3 a = Vector3.Normalize(base.transform.position);
			float d = global::Utils.LerpStep(num2, 10500f, num) * 10f;
			this.m_body.MovePosition(this.m_body.position + a * d * dt);
		}
		if (num > num2 && base.transform.position.y < -10f)
		{
			HitData hitData = new HitData();
			hitData.m_damage.m_damage = 99999f;
			hitData.m_hitType = HitData.HitType.EdgeOfWorld;
			base.Damage(hitData);
		}
	}

	// Token: 0x06000352 RID: 850 RVA: 0x0003D9F4 File Offset: 0x0003BBF4
	private void AutoPickup(float dt)
	{
		if (this.IsTeleporting())
		{
			return;
		}
		if (!Player.m_enableAutoPickup)
		{
			return;
		}
		Vector3 vector = base.transform.position + Vector3.up;
		foreach (Collider collider in Physics.OverlapSphere(vector, this.m_autoPickupRange, this.m_autoPickupMask))
		{
			if (collider.attachedRigidbody)
			{
				ItemDrop component = collider.attachedRigidbody.GetComponent<ItemDrop>();
				FloatingTerrainDummy floatingTerrainDummy = null;
				if (component == null && (floatingTerrainDummy = collider.attachedRigidbody.gameObject.GetComponent<FloatingTerrainDummy>()) && floatingTerrainDummy)
				{
					component = floatingTerrainDummy.m_parent.gameObject.GetComponent<ItemDrop>();
				}
				if (!(component == null) && component.m_autoPickup && !component.IsPiece() && !this.HaveUniqueKey(component.m_itemData.m_shared.m_name) && component.GetComponent<ZNetView>().IsValid())
				{
					if (!component.CanPickup(true))
					{
						component.RequestOwn();
					}
					else if (!component.InTar())
					{
						component.Load();
						if (this.m_inventory.CanAddItem(component.m_itemData, -1) && component.m_itemData.GetWeight(-1) + this.m_inventory.GetTotalWeight() <= this.GetMaxCarryWeight())
						{
							float num = Vector3.Distance(component.transform.position, vector);
							if (num <= this.m_autoPickupRange)
							{
								if (num < 0.3f)
								{
									base.Pickup(component.gameObject, true, true);
								}
								else
								{
									Vector3 a = Vector3.Normalize(vector - component.transform.position);
									float d = 15f;
									Vector3 b = a * d * dt;
									component.transform.position += b;
									if (floatingTerrainDummy)
									{
										floatingTerrainDummy.transform.position += b;
									}
								}
							}
						}
					}
				}
			}
		}
	}

	// Token: 0x06000353 RID: 851 RVA: 0x0003DC10 File Offset: 0x0003BE10
	private void PlayerAttackInput(float dt)
	{
		if (this.InPlaceMode())
		{
			return;
		}
		ItemDrop.ItemData currentWeapon = base.GetCurrentWeapon();
		this.UpdateWeaponLoading(currentWeapon, dt);
		if (currentWeapon != null && currentWeapon.m_shared.m_attack.m_bowDraw)
		{
			this.UpdateAttackBowDraw(currentWeapon, dt);
		}
		else
		{
			if (this.m_attack)
			{
				this.m_queuedAttackTimer = 0.5f;
				this.m_queuedSecondAttackTimer = 0f;
			}
			if (this.m_secondaryAttack)
			{
				this.m_queuedSecondAttackTimer = 0.5f;
				this.m_queuedAttackTimer = 0f;
			}
			this.m_queuedAttackTimer -= Time.fixedDeltaTime;
			this.m_queuedSecondAttackTimer -= Time.fixedDeltaTime;
			if ((this.m_queuedAttackTimer > 0f || this.m_attackHold) && this.StartAttack(null, false))
			{
				this.m_queuedAttackTimer = 0f;
			}
			if ((this.m_queuedSecondAttackTimer > 0f || this.m_secondaryAttackHold) && this.StartAttack(null, true))
			{
				this.m_queuedSecondAttackTimer = 0f;
			}
		}
		if (this.m_currentAttack != null && this.m_currentAttack.m_loopingAttack && !(this.m_currentAttackIsSecondary ? this.m_secondaryAttackHold : this.m_attackHold))
		{
			this.m_currentAttack.Abort();
		}
	}

	// Token: 0x06000354 RID: 852 RVA: 0x0003DD44 File Offset: 0x0003BF44
	private void UpdateWeaponLoading(ItemDrop.ItemData weapon, float dt)
	{
		if (weapon == null || !weapon.m_shared.m_attack.m_requiresReload)
		{
			this.SetWeaponLoaded(null);
			return;
		}
		if (this.m_weaponLoaded == weapon)
		{
			return;
		}
		if (weapon.m_shared.m_attack.m_requiresReload && !this.IsReloadActionQueued())
		{
			if (!base.TryUseEitr(weapon.m_shared.m_attack.m_reloadEitrDrain))
			{
				return;
			}
			this.QueueReloadAction();
		}
	}

	// Token: 0x06000355 RID: 853 RVA: 0x0003DDB4 File Offset: 0x0003BFB4
	private void CancelReloadAction()
	{
		foreach (Player.MinorActionData minorActionData in this.m_actionQueue)
		{
			if (minorActionData.m_type == Player.MinorActionData.ActionType.Reload)
			{
				this.m_actionQueue.Remove(minorActionData);
				break;
			}
		}
	}

	// Token: 0x06000356 RID: 854 RVA: 0x0003DE18 File Offset: 0x0003C018
	public override void ResetLoadedWeapon()
	{
		this.SetWeaponLoaded(null);
		foreach (Player.MinorActionData minorActionData in this.m_actionQueue)
		{
			if (minorActionData.m_type == Player.MinorActionData.ActionType.Reload)
			{
				this.m_actionQueue.Remove(minorActionData);
				break;
			}
		}
	}

	// Token: 0x06000357 RID: 855 RVA: 0x0000CD22 File Offset: 0x0000AF22
	private void SetWeaponLoaded(ItemDrop.ItemData weapon)
	{
		if (weapon == this.m_weaponLoaded)
		{
			return;
		}
		this.m_weaponLoaded = weapon;
		this.m_nview.GetZDO().Set(ZDOVars.s_weaponLoaded, weapon != null);
	}

	// Token: 0x06000358 RID: 856 RVA: 0x0000CD4E File Offset: 0x0000AF4E
	public override bool IsWeaponLoaded()
	{
		if (!this.m_nview.IsValid())
		{
			return false;
		}
		if (!this.m_nview.IsOwner())
		{
			return this.m_nview.GetZDO().GetBool(ZDOVars.s_weaponLoaded, false);
		}
		return this.m_weaponLoaded != null;
	}

	// Token: 0x06000359 RID: 857 RVA: 0x0003DE84 File Offset: 0x0003C084
	private void UpdateAttackBowDraw(ItemDrop.ItemData weapon, float dt)
	{
		if (this.m_blocking || this.InMinorAction() || this.IsAttached())
		{
			this.m_attackDrawTime = -1f;
			if (!string.IsNullOrEmpty(weapon.m_shared.m_attack.m_drawAnimationState))
			{
				this.m_zanim.SetBool(weapon.m_shared.m_attack.m_drawAnimationState, false);
			}
			return;
		}
		float num = weapon.GetDrawStaminaDrain();
		float drawEitrDrain = weapon.GetDrawEitrDrain();
		if ((double)base.GetAttackDrawPercentage() >= 1.0)
		{
			num *= 0.5f;
		}
		num += num * this.GetEquipmentAttackStaminaModifier();
		this.m_seman.ModifyAttackStaminaUsage(num, ref num, true);
		bool flag = num <= 0f || this.HaveStamina(0f);
		bool flag2 = drawEitrDrain <= 0f || this.HaveEitr(0f);
		if (this.m_attackDrawTime < 0f)
		{
			if (!this.m_attackHold)
			{
				this.m_attackDrawTime = 0f;
				return;
			}
		}
		else
		{
			if (this.m_attackHold && flag && this.m_attackDrawTime >= 0f)
			{
				if (this.m_attackDrawTime == 0f)
				{
					if (!weapon.m_shared.m_attack.StartDraw(this, weapon))
					{
						this.m_attackDrawTime = -1f;
						return;
					}
					weapon.m_shared.m_holdStartEffect.Create(base.transform.position, Quaternion.identity, base.transform, 1f, -1);
				}
				this.m_attackDrawTime += Time.fixedDeltaTime;
				if (!string.IsNullOrEmpty(weapon.m_shared.m_attack.m_drawAnimationState))
				{
					this.m_zanim.SetBool(weapon.m_shared.m_attack.m_drawAnimationState, true);
					this.m_zanim.SetFloat("drawpercent", base.GetAttackDrawPercentage());
				}
				this.UseStamina(num * dt);
				this.UseEitr(drawEitrDrain * dt);
				return;
			}
			if (this.m_attackDrawTime > 0f)
			{
				if (flag && flag2)
				{
					this.StartAttack(null, false);
				}
				if (!string.IsNullOrEmpty(weapon.m_shared.m_attack.m_drawAnimationState))
				{
					this.m_zanim.SetBool(weapon.m_shared.m_attack.m_drawAnimationState, false);
				}
				this.m_attackDrawTime = 0f;
			}
		}
	}

	// Token: 0x0600035A RID: 858 RVA: 0x0000CD8C File Offset: 0x0000AF8C
	protected override bool HaveQueuedChain()
	{
		return (this.m_queuedAttackTimer > 0f || this.m_attackHold) && base.GetCurrentWeapon() != null && this.m_currentAttack != null && this.m_currentAttack.CanStartChainAttack();
	}

	// Token: 0x0600035B RID: 859 RVA: 0x0003E0BC File Offset: 0x0003C2BC
	private void UpdateBaseValue(float dt)
	{
		this.m_baseValueUpdateTimer += dt;
		if (this.m_baseValueUpdateTimer > 2f)
		{
			this.m_baseValueUpdateTimer = 0f;
			this.m_baseValue = EffectArea.GetBaseValue(base.transform.position, 20f);
			this.m_comfortLevel = SE_Rested.CalculateComfortLevel(this);
			if (this.m_baseValueOld == this.m_baseValue)
			{
				return;
			}
			this.m_baseValueOld = this.m_baseValue;
			ZNet.instance.m_serverSyncedPlayerData["baseValue"] = this.m_baseValue.ToString();
			this.m_nview.GetZDO().Set(ZDOVars.s_baseValue, this.m_baseValue, false);
			RandEventSystem.SetRandomEventsNeedsRefresh();
		}
	}

	// Token: 0x0600035C RID: 860 RVA: 0x0000CDC0 File Offset: 0x0000AFC0
	public int GetComfortLevel()
	{
		if (this.m_nview == null)
		{
			return 0;
		}
		return this.m_comfortLevel;
	}

	// Token: 0x0600035D RID: 861 RVA: 0x0000CDD8 File Offset: 0x0000AFD8
	public int GetBaseValue()
	{
		if (!this.m_nview.IsValid())
		{
			return 0;
		}
		if (this.m_nview.IsOwner())
		{
			return this.m_baseValue;
		}
		return this.m_nview.GetZDO().GetInt(ZDOVars.s_baseValue, 0);
	}

	// Token: 0x0600035E RID: 862 RVA: 0x0000CE13 File Offset: 0x0000B013
	public bool IsSafeInHome()
	{
		return this.m_safeInHome;
	}

	// Token: 0x0600035F RID: 863 RVA: 0x0003E174 File Offset: 0x0003C374
	private void UpdateBiome(float dt)
	{
		if (this.InIntro())
		{
			return;
		}
		if (this.m_biomeTimer == 0f)
		{
			Location location = Location.GetLocation(base.transform.position, false);
			if (location != null && !string.IsNullOrEmpty(location.m_discoverLabel))
			{
				this.AddKnownLocationName(location.m_discoverLabel);
			}
		}
		this.m_biomeTimer += dt;
		if (this.m_biomeTimer > 1f)
		{
			this.m_biomeTimer = 0f;
			Heightmap.Biome biome = Heightmap.FindBiome(base.transform.position);
			if (this.m_currentBiome != biome)
			{
				this.m_currentBiome = biome;
				this.AddKnownBiome(biome);
			}
		}
	}

	// Token: 0x06000360 RID: 864 RVA: 0x0000CE1B File Offset: 0x0000B01B
	public Heightmap.Biome GetCurrentBiome()
	{
		return this.m_currentBiome;
	}

	// Token: 0x06000361 RID: 865 RVA: 0x0003E214 File Offset: 0x0003C414
	public override void RaiseSkill(Skills.SkillType skill, float value = 1f)
	{
		if (skill == Skills.SkillType.None)
		{
			return;
		}
		float num = 1f;
		this.m_seman.ModifyRaiseSkill(skill, ref num);
		value *= num;
		this.m_skills.RaiseSkill(skill, value);
	}

	// Token: 0x06000362 RID: 866 RVA: 0x0003E24C File Offset: 0x0003C44C
	private void UpdateStats(float dt)
	{
		if (this.InIntro() || this.IsTeleporting())
		{
			return;
		}
		this.m_timeSinceDeath += dt;
		this.UpdateModifiers();
		this.UpdateFood(dt, false);
		bool flag = this.IsEncumbered();
		float maxStamina = this.GetMaxStamina();
		float num = 1f;
		if (this.IsBlocking())
		{
			num *= 0.8f;
		}
		if ((base.IsSwimming() && !base.IsOnGround()) || this.InAttack() || this.InDodge() || this.m_wallRunning || flag)
		{
			num = 0f;
		}
		float num2 = (this.m_staminaRegen + (1f - this.m_stamina / maxStamina) * this.m_staminaRegen * this.m_staminaRegenTimeMultiplier) * num;
		float num3 = 1f;
		this.m_seman.ModifyStaminaRegen(ref num3);
		num2 *= num3;
		this.m_staminaRegenTimer -= dt;
		if (this.m_stamina < maxStamina && this.m_staminaRegenTimer <= 0f)
		{
			this.m_stamina = Mathf.Min(maxStamina, this.m_stamina + num2 * dt * Game.m_staminaRegenRate);
		}
		this.m_nview.GetZDO().Set(ZDOVars.s_stamina, this.m_stamina);
		float adrenaline = this.GetAdrenaline();
		float maxAdrenaline = this.GetMaxAdrenaline();
		if (maxAdrenaline > 0f)
		{
			this.m_lastMaxAdrenaline = maxAdrenaline;
		}
		this.m_adrenalineDegenTimer -= dt;
		if (adrenaline > 0f && this.m_adrenalineDegenTimer <= 0f)
		{
			float time = adrenaline / this.m_lastMaxAdrenaline;
			float num4 = this.m_adrenalineDegen.Evaluate(time) * dt;
			this.AddAdrenaline(-num4);
		}
		this.m_nview.GetZDO().Set(ZDOVars.s_adrenaline, this.m_adrenaline);
		float maxEitr = this.GetMaxEitr();
		float num5 = 1f;
		if (this.IsBlocking())
		{
			num5 *= 0.8f;
		}
		if (this.InAttack() || this.InDodge())
		{
			num5 = 0f;
		}
		float num6 = (this.m_eiterRegen + (1f - this.m_eitr / maxEitr) * this.m_eiterRegen) * num5;
		float num7 = 1f;
		this.m_seman.ModifyEitrRegen(ref num7);
		num7 += this.GetEquipmentEitrRegenModifier();
		num6 *= num7;
		this.m_eitrRegenTimer -= dt;
		if (this.m_eitr < maxEitr && this.m_eitrRegenTimer <= 0f)
		{
			this.m_eitr = Mathf.Min(maxEitr, this.m_eitr + num6 * dt);
		}
		this.m_nview.GetZDO().Set(ZDOVars.s_eitr, this.m_eitr);
		if (flag)
		{
			if (this.m_moveDir.magnitude > 0.1f)
			{
				this.UseStamina(this.m_encumberedStaminaDrain * dt);
			}
			this.m_seman.AddStatusEffect(SEMan.s_statusEffectEncumbered, false, 0, 0f);
			this.ShowTutorial("encumbered", false);
		}
		else
		{
			this.m_seman.RemoveStatusEffect(SEMan.s_statusEffectEncumbered, false);
		}
		if (!this.HardDeath() && this.m_seman.GetStatusEffect(SEMan.s_statusEffectSoftDeath) == null)
		{
			this.m_seman.AddStatusEffect(SEMan.s_statusEffectSoftDeath, false, 0, 0f);
		}
		this.UpdateEnvStatusEffects(dt);
	}

	// Token: 0x06000363 RID: 867 RVA: 0x0003E570 File Offset: 0x0003C770
	public float GetEquipmentEitrRegenModifier()
	{
		float num = 0f;
		if (this.m_chestItem != null)
		{
			num += this.m_chestItem.m_shared.m_eitrRegenModifier;
		}
		if (this.m_legItem != null)
		{
			num += this.m_legItem.m_shared.m_eitrRegenModifier;
		}
		if (this.m_helmetItem != null)
		{
			num += this.m_helmetItem.m_shared.m_eitrRegenModifier;
		}
		if (this.m_shoulderItem != null)
		{
			num += this.m_shoulderItem.m_shared.m_eitrRegenModifier;
		}
		if (this.m_leftItem != null)
		{
			num += this.m_leftItem.m_shared.m_eitrRegenModifier;
		}
		if (this.m_rightItem != null)
		{
			num += this.m_rightItem.m_shared.m_eitrRegenModifier;
		}
		if (this.m_utilityItem != null)
		{
			num += this.m_utilityItem.m_shared.m_eitrRegenModifier;
		}
		return num;
	}

	// Token: 0x06000364 RID: 868 RVA: 0x0003E644 File Offset: 0x0003C844
	private void UpdateEnvStatusEffects(float dt)
	{
		this.m_nearFireTimer += dt;
		HitData.DamageModifiers damageModifiers = base.GetDamageModifiers(null);
		bool flag = this.m_nearFireTimer < 0.25f;
		bool flag2 = this.m_seman.HaveStatusEffect(SEMan.s_statusEffectBurning);
		bool flag3 = this.InShelter();
		HitData.DamageModifier modifier = damageModifiers.GetModifier(HitData.DamageType.Frost);
		bool flag4 = EnvMan.IsFreezing();
		bool flag5 = EnvMan.IsCold();
		bool flag6 = EnvMan.IsWet();
		bool flag7 = this.IsSensed();
		bool flag8 = this.m_seman.HaveStatusEffect(SEMan.s_statusEffectWet);
		bool flag9 = this.IsSitting();
		bool flag10 = EffectArea.IsPointInsideArea(base.transform.position, EffectArea.Type.WarmCozyArea, 1f);
		bool flag11 = ShieldGenerator.IsInsideShield(base.transform.position);
		bool flag12 = flag4 && !flag && !flag3;
		bool flag13 = (flag5 && !flag) || (flag4 && flag && !flag3) || (flag4 && !flag && flag3);
		if (modifier == HitData.DamageModifier.Resistant || modifier == HitData.DamageModifier.VeryResistant || modifier == HitData.DamageModifier.SlightlyResistant || flag10)
		{
			flag12 = false;
			flag13 = false;
		}
		if (flag6 && !this.m_underRoof && !flag11)
		{
			this.m_seman.AddStatusEffect(SEMan.s_statusEffectWet, true, 0, 0f);
		}
		if (flag3)
		{
			this.m_seman.AddStatusEffect(SEMan.s_statusEffectShelter, false, 0, 0f);
		}
		else
		{
			this.m_seman.RemoveStatusEffect(SEMan.s_statusEffectShelter, false);
		}
		if (flag)
		{
			this.m_seman.AddStatusEffect(SEMan.s_statusEffectCampFire, false, 0, 0f);
		}
		else
		{
			this.m_seman.RemoveStatusEffect(SEMan.s_statusEffectCampFire, false);
		}
		bool flag14 = !flag7 && (flag9 || flag3) && !flag13 && !flag12 && (!flag8 || flag10) && !flag2 && flag;
		if (flag14)
		{
			this.m_seman.AddStatusEffect(SEMan.s_statusEffectResting, false, 0, 0f);
		}
		else
		{
			this.m_seman.RemoveStatusEffect(SEMan.s_statusEffectResting, false);
		}
		this.m_safeInHome = (flag14 && flag3 && (float)this.GetBaseValue() >= 1f);
		if (flag12)
		{
			if (!this.m_seman.RemoveStatusEffect(SEMan.s_statusEffectCold, true))
			{
				this.m_seman.AddStatusEffect(SEMan.s_statusEffectFreezing, false, 0, 0f);
				return;
			}
		}
		else if (flag13)
		{
			if (!this.m_seman.RemoveStatusEffect(SEMan.s_statusEffectFreezing, true) && this.m_seman.AddStatusEffect(SEMan.s_statusEffectCold, false, 0, 0f))
			{
				this.ShowTutorial("cold", false);
				return;
			}
		}
		else
		{
			this.m_seman.RemoveStatusEffect(SEMan.s_statusEffectCold, false);
			this.m_seman.RemoveStatusEffect(SEMan.s_statusEffectFreezing, false);
		}
	}

	// Token: 0x06000365 RID: 869 RVA: 0x0003E8DC File Offset: 0x0003CADC
	public bool CanEat(ItemDrop.ItemData item, bool showMessages)
	{
		foreach (Player.Food food in this.m_foods)
		{
			if (food.m_item.m_shared.m_name == item.m_shared.m_name)
			{
				if (food.CanEatAgain())
				{
					return true;
				}
				if (showMessages)
				{
					this.Message(MessageHud.MessageType.Center, Localization.instance.Localize("$msg_nomore", new string[]
					{
						item.m_shared.m_name
					}), 0, null);
				}
				return false;
			}
		}
		using (List<Player.Food>.Enumerator enumerator = this.m_foods.GetEnumerator())
		{
			while (enumerator.MoveNext())
			{
				if (enumerator.Current.CanEatAgain())
				{
					return true;
				}
			}
		}
		if (this.m_foods.Count >= 3)
		{
			if (showMessages)
			{
				this.Message(MessageHud.MessageType.Center, "$msg_isfull", 0, null);
			}
			return false;
		}
		return true;
	}

	// Token: 0x06000366 RID: 870 RVA: 0x0003E9F8 File Offset: 0x0003CBF8
	private Player.Food GetMostDepletedFood()
	{
		Player.Food food = null;
		foreach (Player.Food food2 in this.m_foods)
		{
			if (food2.CanEatAgain() && (food == null || food2.m_time < food.m_time))
			{
				food = food2;
			}
		}
		return food;
	}

	// Token: 0x06000367 RID: 871 RVA: 0x0000CE23 File Offset: 0x0000B023
	public void ClearFood()
	{
		this.m_foods.Clear();
	}

	// Token: 0x06000368 RID: 872 RVA: 0x0000CE30 File Offset: 0x0000B030
	public bool RemoveOneFood()
	{
		if (this.m_foods.Count == 0)
		{
			return false;
		}
		this.m_foods.RemoveAt(UnityEngine.Random.Range(0, this.m_foods.Count));
		return true;
	}

	// Token: 0x06000369 RID: 873 RVA: 0x0003EA64 File Offset: 0x0003CC64
	public bool EatFood(ItemDrop.ItemData item)
	{
		if (!this.CanEat(item, false))
		{
			return false;
		}
		string text = "";
		if (item.m_shared.m_food > 0f)
		{
			text = text + " +" + item.m_shared.m_food.ToString() + " $item_food_health ";
		}
		if (item.m_shared.m_foodStamina > 0f)
		{
			text = text + " +" + item.m_shared.m_foodStamina.ToString() + " $item_food_stamina ";
		}
		if (item.m_shared.m_foodEitr > 0f)
		{
			text = text + " +" + item.m_shared.m_foodEitr.ToString() + " $item_food_eitr ";
		}
		this.Message(MessageHud.MessageType.Center, text, 0, null);
		foreach (Player.Food food in this.m_foods)
		{
			if (food.m_item.m_shared.m_name == item.m_shared.m_name)
			{
				if (food.CanEatAgain())
				{
					food.m_time = item.m_shared.m_foodBurnTime;
					food.m_health = item.m_shared.m_food;
					food.m_stamina = item.m_shared.m_foodStamina;
					food.m_eitr = item.m_shared.m_foodEitr;
					this.UpdateFood(0f, true);
					return true;
				}
				return false;
			}
		}
		if (this.m_foods.Count < 3)
		{
			Player.Food food2 = new Player.Food();
			food2.m_name = item.m_dropPrefab.name;
			food2.m_item = item;
			food2.m_time = item.m_shared.m_foodBurnTime;
			food2.m_health = item.m_shared.m_food;
			food2.m_stamina = item.m_shared.m_foodStamina;
			food2.m_eitr = item.m_shared.m_foodEitr;
			this.m_foods.Add(food2);
			this.UpdateFood(0f, true);
			return true;
		}
		Player.Food mostDepletedFood = this.GetMostDepletedFood();
		if (mostDepletedFood != null)
		{
			mostDepletedFood.m_name = item.m_dropPrefab.name;
			mostDepletedFood.m_item = item;
			mostDepletedFood.m_time = item.m_shared.m_foodBurnTime;
			mostDepletedFood.m_health = item.m_shared.m_food;
			mostDepletedFood.m_stamina = item.m_shared.m_foodStamina;
			this.UpdateFood(0f, true);
			return true;
		}
		Game.instance.IncrementPlayerStat(PlayerStatType.FoodEaten, 1f);
		return false;
	}

	// Token: 0x0600036A RID: 874 RVA: 0x0003ED04 File Offset: 0x0003CF04
	private void UpdateFood(float dt, bool forceUpdate)
	{
		this.m_foodUpdateTimer += dt;
		if (this.m_foodUpdateTimer >= 1f || forceUpdate)
		{
			this.m_foodUpdateTimer -= 1f;
			foreach (Player.Food food in this.m_foods)
			{
				food.m_time -= 1f;
				float num = Mathf.Clamp01(food.m_time / food.m_item.m_shared.m_foodBurnTime);
				num = Mathf.Pow(num, 0.3f);
				food.m_health = food.m_item.m_shared.m_food * num;
				food.m_stamina = food.m_item.m_shared.m_foodStamina * num;
				food.m_eitr = food.m_item.m_shared.m_foodEitr * num;
				if (food.m_time <= 0f)
				{
					this.Message(MessageHud.MessageType.Center, "$msg_food_done", 0, null);
					this.m_foods.Remove(food);
					break;
				}
			}
			float health;
			float stamina;
			float num2;
			this.GetTotalFoodValue(out health, out stamina, out num2);
			this.SetMaxHealth(health, true);
			this.SetMaxStamina(stamina, true);
			this.SetMaxEitr(num2, true);
			if (num2 > 0f)
			{
				this.ShowTutorial("eitr", false);
			}
		}
		if (!forceUpdate)
		{
			this.m_foodRegenTimer += dt;
			if (this.m_foodRegenTimer >= 10f)
			{
				this.m_foodRegenTimer = 0f;
				float num3 = 0f;
				foreach (Player.Food food2 in this.m_foods)
				{
					num3 += food2.m_item.m_shared.m_foodRegen;
				}
				if (num3 > 0f)
				{
					float num4 = 1f;
					this.m_seman.ModifyHealthRegen(ref num4);
					num3 *= num4;
					base.Heal(num3, true);
				}
			}
		}
	}

	// Token: 0x0600036B RID: 875 RVA: 0x0003EF3C File Offset: 0x0003D13C
	private void GetTotalFoodValue(out float hp, out float stamina, out float eitr)
	{
		hp = this.m_baseHP;
		stamina = this.m_baseStamina;
		eitr = 0f;
		foreach (Player.Food food in this.m_foods)
		{
			hp += food.m_health;
			stamina += food.m_stamina;
			eitr += food.m_eitr;
		}
	}

	// Token: 0x0600036C RID: 876 RVA: 0x0000CE5E File Offset: 0x0000B05E
	public float GetBaseFoodHP()
	{
		return this.m_baseHP;
	}

	// Token: 0x0600036D RID: 877 RVA: 0x0000CE66 File Offset: 0x0000B066
	public List<Player.Food> GetFoods()
	{
		return this.m_foods;
	}

	// Token: 0x0600036E RID: 878 RVA: 0x0000CE6E File Offset: 0x0000B06E
	public void OnSpawned(bool spawnValkyrie)
	{
		this.m_spawnEffects.Create(base.transform.position, Quaternion.identity, null, 1f, -1);
		if (spawnValkyrie)
		{
			this.SetIntro(true);
			this.SpawnValkyrie();
		}
	}

	// Token: 0x0600036F RID: 879 RVA: 0x0003EFC0 File Offset: 0x0003D1C0
	private void SpawnValkyrie()
	{
		this.m_valkyrie.Load();
		UnityEngine.Object.Instantiate<GameObject>(this.m_valkyrie.Asset, base.transform.position, Quaternion.identity).GetComponent<ZNetView>().HoldReferenceTo(this.m_valkyrie);
		this.m_valkyrie.Release();
	}

	// Token: 0x06000370 RID: 880 RVA: 0x0003F01C File Offset: 0x0003D21C
	protected override bool CheckRun(Vector3 moveDir, float dt)
	{
		if (!base.CheckRun(moveDir, dt))
		{
			return false;
		}
		bool flag = this.HaveStamina(0f);
		float skillFactor = this.m_skills.GetSkillFactor(Skills.SkillType.Run);
		float num = Mathf.Lerp(1f, 0.5f, skillFactor);
		float num2 = this.m_runStaminaDrain * num;
		num2 -= num2 * this.GetEquipmentMovementModifier();
		num2 += num2 * this.GetEquipmentRunStaminaModifier();
		this.m_seman.ModifyRunStaminaDrain(num2, ref num2, moveDir, true);
		this.UseStamina(dt * num2 * Game.m_moveStaminaRate);
		if (this.HaveStamina(0f))
		{
			this.m_runSkillImproveTimer += dt;
			if (this.m_runSkillImproveTimer > 1f)
			{
				this.m_runSkillImproveTimer = 0f;
				this.RaiseSkill(Skills.SkillType.Run, 1f);
			}
			this.ClearActionQueue();
			return true;
		}
		if (flag)
		{
			Hud.instance.StaminaBarEmptyFlash();
		}
		return false;
	}

	// Token: 0x06000371 RID: 881 RVA: 0x0003F0F4 File Offset: 0x0003D2F4
	private void UpdateModifiers()
	{
		if (Player.s_equipmentModifierSourceFields == null)
		{
			return;
		}
		for (int i = 0; i < this.m_equipmentModifierValues.Length; i++)
		{
			float num = 0f;
			if (this.m_rightItem != null)
			{
				num += (float)Player.s_equipmentModifierSourceFields[i].GetValue(this.m_rightItem.m_shared);
			}
			if (this.m_leftItem != null)
			{
				num += (float)Player.s_equipmentModifierSourceFields[i].GetValue(this.m_leftItem.m_shared);
			}
			if (this.m_chestItem != null)
			{
				num += (float)Player.s_equipmentModifierSourceFields[i].GetValue(this.m_chestItem.m_shared);
			}
			if (this.m_legItem != null)
			{
				num += (float)Player.s_equipmentModifierSourceFields[i].GetValue(this.m_legItem.m_shared);
			}
			if (this.m_helmetItem != null)
			{
				num += (float)Player.s_equipmentModifierSourceFields[i].GetValue(this.m_helmetItem.m_shared);
			}
			if (this.m_shoulderItem != null)
			{
				num += (float)Player.s_equipmentModifierSourceFields[i].GetValue(this.m_shoulderItem.m_shared);
			}
			if (this.m_utilityItem != null)
			{
				num += (float)Player.s_equipmentModifierSourceFields[i].GetValue(this.m_utilityItem.m_shared);
			}
			if (this.m_trinketItem != null)
			{
				num += (float)Player.s_equipmentModifierSourceFields[i].GetValue(this.m_trinketItem.m_shared);
			}
			this.m_equipmentModifierValues[i] = num;
		}
	}

	// Token: 0x06000372 RID: 882 RVA: 0x0003F26C File Offset: 0x0003D46C
	public void AppendEquipmentModifierTooltips(ItemDrop.ItemData item, StringBuilder sb)
	{
		for (int i = 0; i < this.m_equipmentModifierValues.Length; i++)
		{
			object value = Player.s_equipmentModifierSourceFields[i].GetValue(item.m_shared);
			if (value is float)
			{
				float num = (float)value;
				if (num != 0f)
				{
					float equipmentModifierPlusSE = this.GetEquipmentModifierPlusSE(i);
					if (i >= 10)
					{
						sb.AppendFormat(string.Format("\n{0}: <color=orange>{1}</color>", Player.s_equipmentModifierTooltips[i], num), Array.Empty<object>());
					}
					else
					{
						sb.AppendFormat(string.Concat(new string[]
						{
							"\n",
							Player.s_equipmentModifierTooltips[i],
							": <color=orange>",
							(num * 100f).ToString("+0;-0"),
							"%</color>"
						}), Array.Empty<object>());
						if (equipmentModifierPlusSE != num)
						{
							sb.AppendFormat(" ($item_total:<color=yellow>" + (this.GetEquipmentModifierPlusSE(i) * 100f).ToString("+0;-0") + "%</color>)", Array.Empty<object>());
						}
					}
				}
			}
		}
	}

	// Token: 0x06000373 RID: 883 RVA: 0x0000CEA3 File Offset: 0x0000B0A3
	public void OnSkillLevelup(Skills.SkillType skill, float level)
	{
		this.m_skillLevelupEffects.Create(this.m_head.position, this.m_head.rotation, this.m_head, 1f, -1);
	}

	// Token: 0x06000374 RID: 884 RVA: 0x0003F384 File Offset: 0x0003D584
	protected override void OnJump()
	{
		this.ClearActionQueue();
		float num = this.m_jumpStaminaUsage - this.m_jumpStaminaUsage * this.GetEquipmentMovementModifier() + this.m_jumpStaminaUsage * this.GetEquipmentJumpStaminaModifier();
		this.m_seman.ModifyJumpStaminaUsage(num, ref num, true);
		this.UseStamina(num * Game.m_moveStaminaRate);
		Game.instance.IncrementPlayerStat(PlayerStatType.Jumps, 1f);
	}

	// Token: 0x06000375 RID: 885 RVA: 0x0003F3E8 File Offset: 0x0003D5E8
	protected override void OnSwimming(Vector3 targetVel, float dt)
	{
		base.OnSwimming(targetVel, dt);
		if (targetVel.magnitude > 0.1f)
		{
			float skillFactor = this.m_skills.GetSkillFactor(Skills.SkillType.Swim);
			float num = Mathf.Lerp(this.m_swimStaminaDrainMinSkill, this.m_swimStaminaDrainMaxSkill, skillFactor);
			num += num * this.GetEquipmentSwimStaminaModifier();
			this.m_seman.ModifySwimStaminaUsage(num, ref num, true);
			this.UseStamina(dt * num * Game.m_moveStaminaRate);
			this.m_swimSkillImproveTimer += dt;
			if (this.m_swimSkillImproveTimer > 1f)
			{
				this.m_swimSkillImproveTimer = 0f;
				this.RaiseSkill(Skills.SkillType.Swim, 1f);
			}
		}
		if (!this.HaveStamina(0f))
		{
			this.m_drownDamageTimer += dt;
			if (this.m_drownDamageTimer > 1f)
			{
				this.m_drownDamageTimer = 0f;
				float damage = Mathf.Ceil(base.GetMaxHealth() / 20f);
				HitData hitData = new HitData();
				hitData.m_damage.m_damage = damage;
				hitData.m_point = base.GetCenterPoint();
				hitData.m_dir = Vector3.down;
				hitData.m_pushForce = 10f;
				hitData.m_hitType = HitData.HitType.Drowning;
				base.Damage(hitData);
				Vector3 position = base.transform.position;
				position.y = base.GetLiquidLevel();
				this.m_drownEffects.Create(position, base.transform.rotation, null, 1f, -1);
			}
		}
	}

	// Token: 0x06000376 RID: 886 RVA: 0x0003F550 File Offset: 0x0003D750
	protected override bool TakeInput()
	{
		bool result = (!Chat.instance || !Chat.instance.HasFocus()) && !global::Console.IsVisible() && !TextInput.IsVisible() && (!StoreGui.IsVisible() && !InventoryGui.IsVisible() && !Menu.IsVisible() && (!TextViewer.instance || !TextViewer.instance.IsVisible()) && !Minimap.IsOpen() && !GameCamera.InFreeFly()) && !PlayerCustomizaton.IsBarberGuiVisible();
		if (this.IsDead() || this.InCutscene() || this.IsTeleporting())
		{
			result = false;
		}
		return result;
	}

	// Token: 0x06000377 RID: 887 RVA: 0x0003F5E8 File Offset: 0x0003D7E8
	public void UseHotbarItem(int index)
	{
		ItemDrop.ItemData itemAt = this.m_inventory.GetItemAt(index - 1, 0);
		if (itemAt != null)
		{
			base.UseItem(null, itemAt, false);
		}
	}

	// Token: 0x06000378 RID: 888 RVA: 0x0003F614 File Offset: 0x0003D814
	public bool RequiredCraftingStation(Recipe recipe, int qualityLevel, bool checkLevel)
	{
		CraftingStation requiredStation = recipe.GetRequiredStation(qualityLevel);
		if (requiredStation != null)
		{
			if (this.m_currentStation == null)
			{
				return false;
			}
			if (requiredStation.m_name != this.m_currentStation.m_name)
			{
				return false;
			}
			if (checkLevel)
			{
				int requiredStationLevel = recipe.GetRequiredStationLevel(qualityLevel);
				if (this.m_currentStation.GetLevel(true) < requiredStationLevel)
				{
					return false;
				}
			}
		}
		else if (this.m_currentStation != null && !this.m_currentStation.m_showBasicRecipies)
		{
			return false;
		}
		return true;
	}

	// Token: 0x06000379 RID: 889 RVA: 0x0003F698 File Offset: 0x0003D898
	public bool HaveRequirements(Recipe recipe, bool discover, int qualityLevel, int amount = 1)
	{
		if (discover)
		{
			if (recipe.m_craftingStation && !this.KnowStationLevel(recipe.m_craftingStation.m_name, recipe.m_minStationLevel))
			{
				return false;
			}
		}
		else if (!this.RequiredCraftingStation(recipe, qualityLevel, true))
		{
			return false;
		}
		return (recipe.m_item.m_itemData.m_shared.m_dlc.Length <= 0 || DLCMan.instance.IsDLCInstalled(recipe.m_item.m_itemData.m_shared.m_dlc)) && this.HaveRequirementItems(recipe, discover, qualityLevel, amount);
	}

	// Token: 0x0600037A RID: 890 RVA: 0x0003F730 File Offset: 0x0003D930
	private bool HaveRequirementItems(Recipe piece, bool discover, int qualityLevel, int amount = 1)
	{
		foreach (Piece.Requirement requirement in piece.m_resources)
		{
			if (requirement.m_resItem)
			{
				if (discover)
				{
					if (requirement.m_amount > 0)
					{
						if (piece.m_requireOnlyOneIngredient)
						{
							if (this.m_knownMaterial.Contains(requirement.m_resItem.m_itemData.m_shared.m_name))
							{
								return true;
							}
						}
						else if (!this.m_knownMaterial.Contains(requirement.m_resItem.m_itemData.m_shared.m_name))
						{
							return false;
						}
					}
				}
				else
				{
					int num = requirement.GetAmount(qualityLevel) * amount;
					int num2 = 0;
					for (int j = 1; j < requirement.m_resItem.m_itemData.m_shared.m_maxQuality + 1; j++)
					{
						int num3 = this.m_inventory.CountItems(requirement.m_resItem.m_itemData.m_shared.m_name, j, true);
						if (num3 > num2)
						{
							num2 = num3;
						}
					}
					if (piece.m_requireOnlyOneIngredient)
					{
						if (num2 >= num)
						{
							return true;
						}
					}
					else if (num2 < num)
					{
						return false;
					}
				}
			}
		}
		return !piece.m_requireOnlyOneIngredient;
	}

	// Token: 0x0600037B RID: 891 RVA: 0x0003F854 File Offset: 0x0003DA54
	public ItemDrop.ItemData GetFirstRequiredItem(Inventory inventory, Recipe recipe, int qualityLevel, out int amount, out int extraAmount, int craftMultiplier = 1)
	{
		foreach (Piece.Requirement requirement in recipe.m_resources)
		{
			if (requirement.m_resItem)
			{
				int num = requirement.GetAmount(qualityLevel) * craftMultiplier;
				for (int j = 0; j <= requirement.m_resItem.m_itemData.m_shared.m_maxQuality; j++)
				{
					if (this.m_inventory.CountItems(requirement.m_resItem.m_itemData.m_shared.m_name, j, true) >= num)
					{
						amount = num;
						extraAmount = requirement.m_extraAmountOnlyOneIngredient;
						return inventory.GetItem(requirement.m_resItem.m_itemData.m_shared.m_name, j, false);
					}
				}
			}
		}
		amount = 0;
		extraAmount = 0;
		return null;
	}

	// Token: 0x0600037C RID: 892 RVA: 0x0003F91C File Offset: 0x0003DB1C
	public bool HaveRequirements(Piece piece, Player.RequirementMode mode)
	{
		if (piece.m_craftingStation)
		{
			if (mode == Player.RequirementMode.IsKnown || mode == Player.RequirementMode.CanAlmostBuild)
			{
				if (!this.m_knownStations.ContainsKey(piece.m_craftingStation.m_name))
				{
					return false;
				}
			}
			else if (!CraftingStation.HaveBuildStationInRange(piece.m_craftingStation.m_name, base.transform.position) && !ZoneSystem.instance.GetGlobalKey(GlobalKeys.NoWorkbench))
			{
				return false;
			}
		}
		if (piece.m_dlc.Length > 0 && !DLCMan.instance.IsDLCInstalled(piece.m_dlc))
		{
			return false;
		}
		if (mode != Player.RequirementMode.IsKnown && ZoneSystem.instance.GetGlobalKey(piece.FreeBuildKey()))
		{
			return true;
		}
		foreach (Piece.Requirement requirement in piece.m_resources)
		{
			if (requirement.m_resItem && requirement.m_amount > 0)
			{
				if (mode == Player.RequirementMode.IsKnown)
				{
					if (!this.m_knownMaterial.Contains(requirement.m_resItem.m_itemData.m_shared.m_name))
					{
						return false;
					}
				}
				else if (mode == Player.RequirementMode.CanAlmostBuild)
				{
					if (!this.m_inventory.HaveItem(requirement.m_resItem.m_itemData.m_shared.m_name, true))
					{
						return false;
					}
				}
				else if (mode == Player.RequirementMode.CanBuild && this.m_inventory.CountItems(requirement.m_resItem.m_itemData.m_shared.m_name, -1, true) < requirement.m_amount)
				{
					return false;
				}
			}
		}
		return true;
	}

	// Token: 0x0600037D RID: 893 RVA: 0x0003FA80 File Offset: 0x0003DC80
	public void ConsumeResources(Piece.Requirement[] requirements, int qualityLevel, int itemQuality = -1, int multiplier = 1)
	{
		foreach (Piece.Requirement requirement in requirements)
		{
			if (requirement.m_resItem)
			{
				int num = requirement.GetAmount(qualityLevel) * multiplier;
				if (num > 0)
				{
					this.m_inventory.RemoveItem(requirement.m_resItem.m_itemData.m_shared.m_name, num, itemQuality, true);
				}
			}
		}
	}

	// Token: 0x0600037E RID: 894 RVA: 0x0000CED3 File Offset: 0x0000B0D3
	private void UpdateHover()
	{
		if (this.InPlaceMode() || this.IsDead() || this.m_doodadController != null)
		{
			this.m_hovering = null;
			this.m_hoveringCreature = null;
			return;
		}
		this.FindHoverObject(out this.m_hovering, out this.m_hoveringCreature);
	}

	// Token: 0x0600037F RID: 895 RVA: 0x0000CF0E File Offset: 0x0000B10E
	public bool IsMaterialKnown(string sharedName)
	{
		return this.m_knownMaterial.Contains(sharedName);
	}

	// Token: 0x06000380 RID: 896 RVA: 0x0003FAE0 File Offset: 0x0003DCE0
	private bool CheckCanRemovePiece(Piece piece)
	{
		if (!this.m_noPlacementCost && piece.m_craftingStation != null && !CraftingStation.HaveBuildStationInRange(piece.m_craftingStation.m_name, base.transform.position) && !ZoneSystem.instance.GetGlobalKey(GlobalKeys.NoWorkbench))
		{
			this.Message(MessageHud.MessageType.Center, "$msg_missingstation", 0, null);
			return false;
		}
		return true;
	}

	// Token: 0x06000381 RID: 897 RVA: 0x0003FB44 File Offset: 0x0003DD44
	private bool CopyPiece()
	{
		RaycastHit raycastHit;
		if (Physics.Raycast(GameCamera.instance.transform.position, GameCamera.instance.transform.forward, out raycastHit, 50f, this.m_removeRayMask) && Vector3.Distance(raycastHit.point, this.m_eye.position) < this.m_maxPlaceDistance)
		{
			Piece piece = raycastHit.collider.GetComponentInParent<Piece>();
			if (piece == null && raycastHit.collider.GetComponent<Heightmap>())
			{
				piece = TerrainModifier.FindClosestModifierPieceInRange(raycastHit.point, 2.5f);
			}
			if (piece)
			{
				if (this.SetSelectedPiece(piece))
				{
					this.m_placeRotation = (int)Math.Round((double)(piece.transform.rotation.eulerAngles.y / this.m_placeRotationDegrees));
					return true;
				}
				this.Message(MessageHud.MessageType.Center, "$msg_missingrequirement", 0, null);
				return false;
			}
		}
		return false;
	}

	// Token: 0x06000382 RID: 898 RVA: 0x0003FC34 File Offset: 0x0003DE34
	private bool RemovePiece()
	{
		RaycastHit raycastHit;
		if (Physics.Raycast(GameCamera.instance.transform.position, GameCamera.instance.transform.forward, out raycastHit, 50f, this.m_removeRayMask) && Vector3.Distance(raycastHit.point, this.m_eye.position) < this.m_maxPlaceDistance)
		{
			Piece piece = raycastHit.collider.GetComponentInParent<Piece>();
			if (piece == null && raycastHit.collider.GetComponent<Heightmap>())
			{
				piece = TerrainModifier.FindClosestModifierPieceInRange(raycastHit.point, 2.5f);
			}
			if (piece)
			{
				if (!piece.m_canBeRemoved)
				{
					return false;
				}
				if (Location.IsInsideNoBuildLocation(piece.transform.position))
				{
					this.Message(MessageHud.MessageType.Center, "$msg_nobuildzone", 0, null);
					return false;
				}
				if (!PrivateArea.CheckAccess(piece.transform.position, 0f, true, false))
				{
					this.Message(MessageHud.MessageType.Center, "$msg_privatezone", 0, null);
					return false;
				}
				if (!this.CheckCanRemovePiece(piece))
				{
					return false;
				}
				ZNetView component = piece.GetComponent<ZNetView>();
				if (component == null)
				{
					return false;
				}
				if (!piece.CanBeRemoved())
				{
					this.Message(MessageHud.MessageType.Center, "$msg_cantremovenow", 0, null);
					return false;
				}
				IRemoved component2 = piece.GetComponent<IRemoved>();
				if (component2 != null)
				{
					component2.OnRemoved();
				}
				WearNTear component3 = piece.GetComponent<WearNTear>();
				if (component3)
				{
					component3.Remove(false);
				}
				else
				{
					Character component4 = piece.GetComponent<Character>();
					if (component4 != null)
					{
						component4.Damage(new HitData(1E+10f));
					}
					else
					{
						ZLog.Log("Removing non WNT object with hammer " + piece.name);
						component.ClaimOwnership();
						piece.DropResources(null);
						piece.m_placeEffect.Create(piece.transform.position, piece.transform.rotation, piece.gameObject.transform, 1f, -1);
						this.m_removeEffects.Create(piece.transform.position, Quaternion.identity, null, 1f, -1);
						ZNetScene.instance.Destroy(piece.gameObject);
					}
				}
				ItemDrop.ItemData rightItem = base.GetRightItem();
				if (rightItem != null)
				{
					this.FaceLookDirection();
					this.m_zanim.SetTrigger(rightItem.m_shared.m_attack.m_attackAnimation);
				}
				return true;
			}
		}
		return false;
	}

	// Token: 0x06000383 RID: 899 RVA: 0x0000CF1C File Offset: 0x0000B11C
	public void FaceLookDirection()
	{
		base.transform.rotation = base.GetLookYaw();
		Physics.SyncTransforms();
	}

	// Token: 0x06000384 RID: 900 RVA: 0x0003FE74 File Offset: 0x0003E074
	public bool TryPlacePiece(Piece piece)
	{
		this.UpdatePlacementGhost(true);
		switch (this.m_placementStatus)
		{
		case Player.PlacementStatus.Invalid:
		case Player.PlacementStatus.NoRayHits:
			this.Message(MessageHud.MessageType.Center, "$msg_invalidplacement", 0, null);
			return false;
		case Player.PlacementStatus.BlockedbyPlayer:
			this.Message(MessageHud.MessageType.Center, "$msg_blocked", 0, null);
			return false;
		case Player.PlacementStatus.NoBuildZone:
			this.Message(MessageHud.MessageType.Center, "$msg_nobuildzone", 0, null);
			return false;
		case Player.PlacementStatus.PrivateZone:
			this.Message(MessageHud.MessageType.Center, "$msg_privatezone", 0, null);
			return false;
		case Player.PlacementStatus.MoreSpace:
			this.Message(MessageHud.MessageType.Center, "$msg_needspace", 0, null);
			return false;
		case Player.PlacementStatus.NoTeleportArea:
			this.Message(MessageHud.MessageType.Center, "$msg_noteleportarea", 0, null);
			return false;
		case Player.PlacementStatus.ExtensionMissingStation:
			this.Message(MessageHud.MessageType.Center, "$msg_extensionmissingstation", 0, null);
			return false;
		case Player.PlacementStatus.WrongBiome:
			this.Message(MessageHud.MessageType.Center, "$msg_wrongbiome", 0, null);
			return false;
		case Player.PlacementStatus.NeedCultivated:
			this.Message(MessageHud.MessageType.Center, "$msg_needcultivated", 0, null);
			return false;
		case Player.PlacementStatus.NeedDirt:
			this.Message(MessageHud.MessageType.Center, "$msg_needdirt", 0, null);
			return false;
		case Player.PlacementStatus.NotInDungeon:
			this.Message(MessageHud.MessageType.Center, "$msg_notindungeon", 0, null);
			return false;
		default:
			ZLog.Log("Placed " + piece.gameObject.name);
			Gogan.LogEvent("Game", "PlacedPiece", piece.gameObject.name, 0L);
			Game.instance.IncrementPlayerStat(PlayerStatType.Builds, 1f);
			this.PlacePiece(piece, this.m_placementGhost.transform.position, this.m_placementGhost.transform.rotation, true);
			return true;
		}
	}

	// Token: 0x06000385 RID: 901 RVA: 0x0003FFEC File Offset: 0x0003E1EC
	public void PlacePiece(Piece piece, Vector3 pos, Quaternion rot, bool doAttack = true)
	{
		GameObject gameObject = piece.gameObject;
		TerrainModifier.SetTriggerOnPlaced(true);
		GameObject gameObject2 = UnityEngine.Object.Instantiate<GameObject>(gameObject, pos, rot);
		TerrainModifier.SetTriggerOnPlaced(false);
		CraftingStation componentInChildren = gameObject2.GetComponentInChildren<CraftingStation>();
		if (componentInChildren)
		{
			this.AddKnownStation(componentInChildren);
		}
		Piece component = gameObject2.GetComponent<Piece>();
		if (component)
		{
			component.SetCreator(this.GetPlayerID());
		}
		PrivateArea component2 = gameObject2.GetComponent<PrivateArea>();
		if (component2 != null)
		{
			component2.Setup(Game.instance.GetPlayerProfile().GetName());
		}
		WearNTear component3 = gameObject2.GetComponent<WearNTear>();
		if (component3 != null)
		{
			component3.OnPlaced();
		}
		if (doAttack)
		{
			ItemDrop.ItemData rightItem = base.GetRightItem();
			if (rightItem != null)
			{
				this.FaceLookDirection();
				this.m_zanim.SetTrigger(rightItem.m_shared.m_attack.m_attackAnimation);
			}
		}
		if (piece.m_randomInitBuildRotation)
		{
			this.m_placeRotation = UnityEngine.Random.Range(0, 16);
		}
		ItemDrop component4 = gameObject2.gameObject.GetComponent<ItemDrop>();
		if (component4 != null)
		{
			component4.MakePiece(true);
		}
		Player.m_placed.Clear();
		gameObject2.GetComponents<IPlaced>(Player.m_placed);
		foreach (IPlaced placed in Player.m_placed)
		{
			placed.OnPlaced();
		}
		piece.m_placeEffect.Create(pos, rot, gameObject2.transform, 1f, -1);
		base.AddNoise(50f);
	}

	// Token: 0x06000386 RID: 902 RVA: 0x0000B938 File Offset: 0x00009B38
	public override bool IsPlayer()
	{
		return true;
	}

	// Token: 0x06000387 RID: 903 RVA: 0x00040154 File Offset: 0x0003E354
	public void GetBuildSelection(out Piece go, out Vector2Int id, out int total, out Piece.PieceCategory category, out PieceTable pieceTable)
	{
		category = this.m_buildPieces.GetSelectedCategory();
		pieceTable = this.m_buildPieces;
		if (this.m_buildPieces.GetAvailablePiecesInSelectedCategory() == 0)
		{
			go = null;
			id = Vector2Int.zero;
			total = 0;
			return;
		}
		GameObject selectedPrefab = this.m_buildPieces.GetSelectedPrefab();
		go = (selectedPrefab ? selectedPrefab.GetComponent<Piece>() : null);
		id = this.m_buildPieces.GetSelectedIndex();
		total = this.m_buildPieces.GetAvailablePiecesInSelectedCategory();
	}

	// Token: 0x06000388 RID: 904 RVA: 0x0000CF34 File Offset: 0x0000B134
	public List<Piece> GetBuildPieces()
	{
		if (!(this.m_buildPieces != null))
		{
			return null;
		}
		return this.m_buildPieces.GetPiecesInSelectedCategory();
	}

	// Token: 0x06000389 RID: 905 RVA: 0x0000CF51 File Offset: 0x0000B151
	public int GetAvailableBuildPiecesInCategory(Piece.PieceCategory cat)
	{
		if (!(this.m_buildPieces != null))
		{
			return 0;
		}
		return this.m_buildPieces.GetAvailablePiecesInCategory(cat);
	}

	// Token: 0x0600038A RID: 906 RVA: 0x0000CF6F File Offset: 0x0000B16F
	private void RPC_OnDeath(long sender)
	{
		this.m_visual.SetActive(false);
	}

	// Token: 0x0600038B RID: 907 RVA: 0x000401D4 File Offset: 0x0003E3D4
	private void CreateDeathEffects()
	{
		GameObject[] array = this.m_deathEffects.Create(base.transform.position, base.transform.rotation, base.transform, 1f, -1);
		for (int i = 0; i < array.Length; i++)
		{
			Ragdoll component = array[i].GetComponent<Ragdoll>();
			if (component)
			{
				Vector3 velocity = this.m_body.linearVelocity;
				if (this.m_pushForce.magnitude * 0.5f > velocity.magnitude)
				{
					velocity = this.m_pushForce * 0.5f;
				}
				component.Setup(velocity, 0f, 0f, 0f, null);
				this.OnRagdollCreated(component);
				this.m_ragdoll = component;
			}
		}
	}

	// Token: 0x0600038C RID: 908 RVA: 0x0004028C File Offset: 0x0003E48C
	public void UnequipDeathDropItems()
	{
		if (this.m_rightItem != null)
		{
			base.UnequipItem(this.m_rightItem, false);
		}
		if (this.m_leftItem != null)
		{
			base.UnequipItem(this.m_leftItem, false);
		}
		if (this.m_ammoItem != null)
		{
			base.UnequipItem(this.m_ammoItem, false);
		}
		if (this.m_utilityItem != null)
		{
			base.UnequipItem(this.m_utilityItem, false);
		}
		if (this.m_trinketItem != null)
		{
			base.UnequipItem(this.m_trinketItem, false);
		}
	}

	// Token: 0x0600038D RID: 909 RVA: 0x00040304 File Offset: 0x0003E504
	public void CreateTombStone()
	{
		if (this.m_inventory.NrOfItems() == 0)
		{
			return;
		}
		if (!ZoneSystem.instance.GetGlobalKey(GlobalKeys.DeathKeepEquip) && !ZoneSystem.instance.GetGlobalKey(GlobalKeys.DeathDeleteUnequipped))
		{
			base.UnequipAllItems();
		}
		if (ZoneSystem.instance.GetGlobalKey(GlobalKeys.DeathDeleteItems) || ZoneSystem.instance.GetGlobalKey(GlobalKeys.DeathDeleteUnequipped))
		{
			this.m_inventory.RemoveUnequipped();
		}
		if (ZoneSystem.instance.GetGlobalKey(GlobalKeys.DeathDeleteUnequipped) && !ZoneSystem.instance.GetGlobalKey(GlobalKeys.DeathKeepEquip))
		{
			base.UnequipAllItems();
		}
		GameObject gameObject = UnityEngine.Object.Instantiate<GameObject>(this.m_tombstone, base.GetCenterPoint(), base.transform.rotation);
		gameObject.GetComponent<Container>().GetInventory().MoveInventoryToGrave(this.m_inventory);
		TombStone component = gameObject.GetComponent<TombStone>();
		PlayerProfile playerProfile = Game.instance.GetPlayerProfile();
		component.Setup(playerProfile.GetName(), playerProfile.GetPlayerID());
	}

	// Token: 0x0600038E RID: 910 RVA: 0x0000CF7D File Offset: 0x0000B17D
	private bool HardDeath()
	{
		return this.m_timeSinceDeath > this.m_hardDeathCooldown;
	}

	// Token: 0x0600038F RID: 911 RVA: 0x0000CF8D File Offset: 0x0000B18D
	public void ClearHardDeath()
	{
		this.m_timeSinceDeath = this.m_hardDeathCooldown + 1f;
	}

	// Token: 0x06000390 RID: 912 RVA: 0x000403E0 File Offset: 0x0003E5E0
	protected override void OnDeath()
	{
		if (!this.m_nview.IsOwner())
		{
			Debug.Log("OnDeath call but not the owner");
			return;
		}
		bool flag = this.HardDeath();
		this.m_nview.GetZDO().Set(ZDOVars.s_dead, true);
		this.m_nview.InvokeRPC(ZNetView.Everybody, "OnDeath", Array.Empty<object>());
		Game.instance.IncrementPlayerStat(PlayerStatType.Deaths, 1f);
		switch (this.m_lastHit.m_hitType)
		{
		case HitData.HitType.Undefined:
			Game.instance.IncrementPlayerStat(PlayerStatType.DeathByUndefined, 1f);
			break;
		case HitData.HitType.EnemyHit:
			Game.instance.IncrementPlayerStat(PlayerStatType.DeathByEnemyHit, 1f);
			break;
		case HitData.HitType.PlayerHit:
			Game.instance.IncrementPlayerStat(PlayerStatType.DeathByPlayerHit, 1f);
			break;
		case HitData.HitType.Fall:
			Game.instance.IncrementPlayerStat(PlayerStatType.DeathByFall, 1f);
			break;
		case HitData.HitType.Drowning:
			Game.instance.IncrementPlayerStat(PlayerStatType.DeathByDrowning, 1f);
			break;
		case HitData.HitType.Burning:
			Game.instance.IncrementPlayerStat(PlayerStatType.DeathByBurning, 1f);
			break;
		case HitData.HitType.Freezing:
			Game.instance.IncrementPlayerStat(PlayerStatType.DeathByFreezing, 1f);
			break;
		case HitData.HitType.Poisoned:
			Game.instance.IncrementPlayerStat(PlayerStatType.DeathByPoisoned, 1f);
			break;
		case HitData.HitType.Water:
			Game.instance.IncrementPlayerStat(PlayerStatType.DeathByWater, 1f);
			break;
		case HitData.HitType.Smoke:
			Game.instance.IncrementPlayerStat(PlayerStatType.DeathBySmoke, 1f);
			break;
		case HitData.HitType.EdgeOfWorld:
			Game.instance.IncrementPlayerStat(PlayerStatType.DeathByEdgeOfWorld, 1f);
			break;
		case HitData.HitType.Impact:
			Game.instance.IncrementPlayerStat(PlayerStatType.DeathByImpact, 1f);
			break;
		case HitData.HitType.Cart:
			Game.instance.IncrementPlayerStat(PlayerStatType.DeathByCart, 1f);
			break;
		case HitData.HitType.Tree:
			Game.instance.IncrementPlayerStat(PlayerStatType.DeathByTree, 1f);
			break;
		case HitData.HitType.Self:
			Game.instance.IncrementPlayerStat(PlayerStatType.DeathBySelf, 1f);
			break;
		case HitData.HitType.Structural:
			Game.instance.IncrementPlayerStat(PlayerStatType.DeathByStructural, 1f);
			break;
		case HitData.HitType.Turret:
			Game.instance.IncrementPlayerStat(PlayerStatType.DeathByTurret, 1f);
			break;
		case HitData.HitType.Boat:
			Game.instance.IncrementPlayerStat(PlayerStatType.DeathByBoat, 1f);
			break;
		case HitData.HitType.Stalagtite:
			Game.instance.IncrementPlayerStat(PlayerStatType.DeathByStalagtite, 1f);
			break;
		default:
			ZLog.LogWarning("Not implemented death type " + this.m_lastHit.m_hitType.ToString());
			break;
		}
		Game.instance.GetPlayerProfile().SetDeathPoint(base.transform.position);
		this.CreateDeathEffects();
		this.CreateTombStone();
		this.m_foods.Clear();
		if (ZoneSystem.instance.GetGlobalKey(GlobalKeys.DeathSkillsReset))
		{
			this.m_skills.Clear();
		}
		else if (flag)
		{
			this.m_skills.OnDeath();
		}
		this.m_seman.RemoveAllStatusEffects(false);
		Game.instance.RequestRespawn(10f, true);
		this.m_timeSinceDeath = 0f;
		if (!flag)
		{
			this.Message(MessageHud.MessageType.TopLeft, "$msg_softdeath", 0, null);
		}
		this.Message(MessageHud.MessageType.Center, "$msg_youdied", 0, null);
		this.ShowTutorial("death", false);
		Minimap.instance.AddPin(base.transform.position, Minimap.PinType.Death, string.Format("$hud_mapday {0}", EnvMan.instance.GetDay(ZNet.instance.GetTimeSeconds())), true, false, 0L, default(PlatformUserID));
		if (this.m_onDeath != null)
		{
			this.m_onDeath();
		}
		string eventLabel = "biome:" + this.GetCurrentBiome().ToString();
		Gogan.LogEvent("Game", "Death", eventLabel, 0L);
	}

	// Token: 0x06000391 RID: 913 RVA: 0x0000CFA1 File Offset: 0x0000B1A1
	public void OnRespawn()
	{
		this.m_nview.GetZDO().Set(ZDOVars.s_dead, false);
		base.SetHealth(base.GetMaxHealth());
	}

	// Token: 0x06000392 RID: 914 RVA: 0x000407A0 File Offset: 0x0003E9A0
	private void SetupPlacementGhost()
	{
		if (this.m_placementGhost)
		{
			UnityEngine.Object.Destroy(this.m_placementGhost);
			this.m_placementGhost = null;
		}
		if (this.m_buildPieces == null || this.IsDead())
		{
			return;
		}
		GameObject selectedPrefab = this.m_buildPieces.GetSelectedPrefab();
		if (selectedPrefab == null)
		{
			return;
		}
		Piece component = selectedPrefab.GetComponent<Piece>();
		if (component.m_repairPiece || component.m_removePiece)
		{
			return;
		}
		bool enabled = false;
		TerrainModifier componentInChildren = selectedPrefab.GetComponentInChildren<TerrainModifier>();
		if (componentInChildren)
		{
			enabled = componentInChildren.enabled;
			componentInChildren.enabled = false;
		}
		TerrainOp.m_forceDisableTerrainOps = true;
		ZNetView.m_forceDisableInit = true;
		GameObject placementGhost = this.m_placementGhost;
		this.m_placementGhost = UnityEngine.Object.Instantiate<GameObject>(selectedPrefab);
		Piece component2 = this.m_placementGhost.GetComponent<Piece>();
		if (component2 != null && component2.m_randomInitBuildRotation)
		{
			this.m_placeRotation = UnityEngine.Random.Range(0, 16);
		}
		ItemDrop component3 = this.m_placementGhost.gameObject.GetComponent<ItemDrop>();
		if (component3 != null)
		{
			component3.MakePiece(false);
		}
		ZNetView.m_forceDisableInit = false;
		TerrainOp.m_forceDisableTerrainOps = false;
		this.m_placementGhost.name = selectedPrefab.name;
		if (this.m_placementGhostLast != this.m_placementGhost.name)
		{
			this.m_manualSnapPoint = -1;
		}
		this.m_placementGhostLast = this.m_placementGhost.name;
		if (componentInChildren)
		{
			componentInChildren.enabled = enabled;
		}
		Joint[] componentsInChildren = this.m_placementGhost.GetComponentsInChildren<Joint>();
		for (int i = 0; i < componentsInChildren.Length; i++)
		{
			UnityEngine.Object.Destroy(componentsInChildren[i]);
		}
		Rigidbody[] componentsInChildren2 = this.m_placementGhost.GetComponentsInChildren<Rigidbody>();
		for (int i = 0; i < componentsInChildren2.Length; i++)
		{
			UnityEngine.Object.Destroy(componentsInChildren2[i]);
		}
		ParticleSystemForceField[] componentsInChildren3 = this.m_placementGhost.GetComponentsInChildren<ParticleSystemForceField>();
		for (int i = 0; i < componentsInChildren3.Length; i++)
		{
			UnityEngine.Object.Destroy(componentsInChildren3[i]);
		}
		Demister[] componentsInChildren4 = this.m_placementGhost.GetComponentsInChildren<Demister>();
		for (int i = 0; i < componentsInChildren4.Length; i++)
		{
			UnityEngine.Object.Destroy(componentsInChildren4[i]);
		}
		foreach (Collider collider in this.m_placementGhost.GetComponentsInChildren<Collider>())
		{
			if ((1 << collider.gameObject.layer & this.m_placeRayMask) == 0)
			{
				ZLog.Log("Disabling " + collider.gameObject.name + "  " + LayerMask.LayerToName(collider.gameObject.layer));
				collider.enabled = false;
			}
		}
		Transform[] componentsInChildren6 = this.m_placementGhost.GetComponentsInChildren<Transform>();
		int layer = LayerMask.NameToLayer("ghost");
		Transform[] array = componentsInChildren6;
		for (int i = 0; i < array.Length; i++)
		{
			array[i].gameObject.layer = layer;
		}
		TerrainModifier[] componentsInChildren7 = this.m_placementGhost.GetComponentsInChildren<TerrainModifier>();
		for (int i = 0; i < componentsInChildren7.Length; i++)
		{
			UnityEngine.Object.Destroy(componentsInChildren7[i]);
		}
		GuidePoint[] componentsInChildren8 = this.m_placementGhost.GetComponentsInChildren<GuidePoint>();
		for (int i = 0; i < componentsInChildren8.Length; i++)
		{
			UnityEngine.Object.Destroy(componentsInChildren8[i]);
		}
		LightLod[] componentsInChildren9 = this.m_placementGhost.GetComponentsInChildren<LightLod>();
		for (int i = 0; i < componentsInChildren9.Length; i++)
		{
			UnityEngine.Object.Destroy(componentsInChildren9[i]);
		}
		LightFlicker[] componentsInChildren10 = this.m_placementGhost.GetComponentsInChildren<LightFlicker>();
		for (int i = 0; i < componentsInChildren10.Length; i++)
		{
			UnityEngine.Object.Destroy(componentsInChildren10[i]);
		}
		Light[] componentsInChildren11 = this.m_placementGhost.GetComponentsInChildren<Light>();
		for (int i = 0; i < componentsInChildren11.Length; i++)
		{
			UnityEngine.Object.Destroy(componentsInChildren11[i]);
		}
		AudioSource[] componentsInChildren12 = this.m_placementGhost.GetComponentsInChildren<AudioSource>();
		for (int i = 0; i < componentsInChildren12.Length; i++)
		{
			componentsInChildren12[i].enabled = false;
		}
		ZSFX[] componentsInChildren13 = this.m_placementGhost.GetComponentsInChildren<ZSFX>();
		for (int i = 0; i < componentsInChildren13.Length; i++)
		{
			componentsInChildren13[i].enabled = false;
		}
		WispSpawner componentInChildren2 = this.m_placementGhost.GetComponentInChildren<WispSpawner>();
		if (componentInChildren2)
		{
			UnityEngine.Object.Destroy(componentInChildren2);
		}
		Windmill componentInChildren3 = this.m_placementGhost.GetComponentInChildren<Windmill>();
		if (componentInChildren3)
		{
			componentInChildren3.enabled = false;
		}
		ParticleSystem[] componentsInChildren14 = this.m_placementGhost.GetComponentsInChildren<ParticleSystem>();
		for (int i = 0; i < componentsInChildren14.Length; i++)
		{
			componentsInChildren14[i].gameObject.SetActive(false);
		}
		Transform transform = this.m_placementGhost.transform.Find("_GhostOnly");
		if (transform)
		{
			transform.gameObject.SetActive(true);
		}
		this.m_placementGhost.transform.position = base.transform.position;
		this.m_placementGhost.transform.localScale = selectedPrefab.transform.localScale;
		this.m_ghostRippleDistance.Clear();
		this.CleanupGhostMaterials<MeshRenderer>(this.m_placementGhost);
		this.CleanupGhostMaterials<SkinnedMeshRenderer>(this.m_placementGhost);
	}

	// Token: 0x06000393 RID: 915 RVA: 0x0000CFC5 File Offset: 0x0000B1C5
	public static bool IsPlacementGhost(GameObject obj)
	{
		return Player.m_localPlayer && obj == Player.m_localPlayer.m_placementGhost;
	}

	// Token: 0x06000394 RID: 916 RVA: 0x00040C6C File Offset: 0x0003EE6C
	private void CleanupGhostMaterials<T>(GameObject ghost) where T : Renderer
	{
		foreach (T t in this.m_placementGhost.GetComponentsInChildren<T>())
		{
			if (!(t.sharedMaterial == null))
			{
				Material[] sharedMaterials = t.sharedMaterials;
				for (int j = 0; j < sharedMaterials.Length; j++)
				{
					Material material = new Material(sharedMaterials[j]);
					if (material.HasProperty("_RippleDistance"))
					{
						this.m_ghostRippleDistance[material] = material.GetFloat("_RippleDistance");
					}
					material.SetFloat("_ValueNoise", 0f);
					material.SetFloat("_TriplanarLocalPos", 1f);
					sharedMaterials[j] = material;
				}
				t.sharedMaterials = sharedMaterials;
				t.shadowCastingMode = ShadowCastingMode.Off;
			}
		}
	}

	// Token: 0x06000395 RID: 917 RVA: 0x0000CFE2 File Offset: 0x0000B1E2
	private void SetPlacementGhostValid(bool valid)
	{
		this.m_placementGhost.GetComponent<Piece>().SetInvalidPlacementHeightlight(!valid);
	}

	// Token: 0x06000396 RID: 918 RVA: 0x0000CFF8 File Offset: 0x0000B1F8
	protected override void SetPlaceMode(PieceTable buildPieces)
	{
		base.SetPlaceMode(buildPieces);
		this.m_buildPieces = buildPieces;
		this.UpdateAvailablePiecesList();
	}

	// Token: 0x06000397 RID: 919 RVA: 0x0000D00E File Offset: 0x0000B20E
	public void SetBuildCategory(int index)
	{
		if (this.m_buildPieces != null)
		{
			this.m_buildPieces.SetCategory(index);
			this.UpdateAvailablePiecesList();
		}
	}

	// Token: 0x06000398 RID: 920 RVA: 0x0000D030 File Offset: 0x0000B230
	public override bool InPlaceMode()
	{
		return this.m_buildPieces != null;
	}

	// Token: 0x06000399 RID: 921 RVA: 0x00040D48 File Offset: 0x0003EF48
	public bool InRepairMode()
	{
		if (this.InPlaceMode())
		{
			Piece selectedPiece = this.m_buildPieces.GetSelectedPiece();
			if (selectedPiece != null)
			{
				return selectedPiece.m_repairPiece || selectedPiece.m_removePiece;
			}
		}
		return false;
	}

	// Token: 0x0600039A RID: 922 RVA: 0x0000D03E File Offset: 0x0000B23E
	public Player.PlacementStatus GetPlacementStatus()
	{
		return this.m_placementStatus;
	}

	// Token: 0x0600039B RID: 923 RVA: 0x00040D80 File Offset: 0x0003EF80
	public bool CanRotatePiece()
	{
		if (this.InPlaceMode())
		{
			Piece selectedPiece = this.m_buildPieces.GetSelectedPiece();
			if (selectedPiece != null)
			{
				return selectedPiece.m_canRotate;
			}
		}
		return false;
	}

	// Token: 0x0600039C RID: 924 RVA: 0x00040DAC File Offset: 0x0003EFAC
	private void Repair(ItemDrop.ItemData toolItem, Piece repairPiece)
	{
		if (!this.InPlaceMode())
		{
			return;
		}
		Piece hoveringPiece = this.GetHoveringPiece();
		if (hoveringPiece)
		{
			if (!this.CheckCanRemovePiece(hoveringPiece))
			{
				return;
			}
			if (!PrivateArea.CheckAccess(hoveringPiece.transform.position, 0f, true, false))
			{
				return;
			}
			bool flag = false;
			WearNTear component = hoveringPiece.GetComponent<WearNTear>();
			if (component && component.Repair())
			{
				flag = true;
			}
			if (flag)
			{
				this.FaceLookDirection();
				this.m_zanim.SetTrigger(toolItem.m_shared.m_attack.m_attackAnimation);
				hoveringPiece.m_placeEffect.Create(hoveringPiece.transform.position, hoveringPiece.transform.rotation, null, 1f, -1);
				this.Message(MessageHud.MessageType.TopLeft, Localization.instance.Localize("$msg_repaired", new string[]
				{
					hoveringPiece.m_name
				}), 0, null);
				this.UseStamina(this.GetBuildStamina());
				this.UseEitr(toolItem.m_shared.m_attack.m_attackEitr);
				if (toolItem.m_shared.m_useDurability)
				{
					toolItem.m_durability -= toolItem.m_shared.m_useDurabilityDrain;
					return;
				}
			}
			else
			{
				this.Message(MessageHud.MessageType.TopLeft, hoveringPiece.m_name + " $msg_doesnotneedrepair", 0, null);
			}
		}
	}

	// Token: 0x0600039D RID: 925 RVA: 0x00040EEC File Offset: 0x0003F0EC
	private void UpdateWearNTearHover()
	{
		if (!this.InPlaceMode())
		{
			this.m_hoveringPiece = null;
			return;
		}
		this.m_hoveringPiece = null;
		RaycastHit raycastHit;
		if (Physics.Raycast(GameCamera.instance.transform.position, GameCamera.instance.transform.forward, out raycastHit, 50f, this.m_removeRayMask) && Vector3.Distance(this.m_eye.position, raycastHit.point) < this.m_maxPlaceDistance)
		{
			Piece componentInParent = raycastHit.collider.GetComponentInParent<Piece>();
			this.m_hoveringPiece = componentInParent;
			if (componentInParent)
			{
				WearNTear component = componentInParent.GetComponent<WearNTear>();
				if (component)
				{
					component.Highlight();
				}
			}
		}
	}

	// Token: 0x0600039E RID: 926 RVA: 0x0000D046 File Offset: 0x0000B246
	public Piece GetHoveringPiece()
	{
		if (!this.InPlaceMode())
		{
			return null;
		}
		return this.m_hoveringPiece;
	}

	// Token: 0x0600039F RID: 927 RVA: 0x00040F94 File Offset: 0x0003F194
	private void UpdatePlacementGhost(bool flashGuardStone)
	{
		if (this.m_placementGhost == null)
		{
			if (this.m_placementMarkerInstance)
			{
				this.m_placementMarkerInstance.SetActive(false);
			}
			return;
		}
		bool flag = (ZInput.IsNonClassicFunctionality() && ZInput.IsGamepadActive()) ? this.m_altPlace : (ZInput.GetButton("AltPlace") || (ZInput.GetButton("JoyAltPlace") && !ZInput.GetButton("JoyRotate")));
		Piece component = this.m_placementGhost.GetComponent<Piece>();
		bool water = component.m_waterPiece || component.m_noInWater;
		Vector3 vector;
		Vector3 up;
		Piece piece;
		Heightmap heightmap;
		Collider x;
		if (this.PieceRayTest(out vector, out up, out piece, out heightmap, out x, water))
		{
			this.m_placementStatus = Player.PlacementStatus.Valid;
			Quaternion rotation = Quaternion.Euler(0f, this.m_placeRotationDegrees * (float)this.m_placeRotation, 0f);
			if (this.m_placementMarkerInstance == null)
			{
				this.m_placementMarkerInstance = UnityEngine.Object.Instantiate<GameObject>(this.m_placeMarker, vector, Quaternion.identity);
			}
			this.m_placementMarkerInstance.SetActive(true);
			this.m_placementMarkerInstance.transform.position = vector;
			this.m_placementMarkerInstance.transform.rotation = Quaternion.LookRotation(up, rotation * Vector3.forward);
			if (component.m_groundOnly || component.m_groundPiece || component.m_cultivatedGroundOnly)
			{
				this.m_placementMarkerInstance.SetActive(false);
			}
			WearNTear wearNTear = (piece != null) ? piece.GetComponent<WearNTear>() : null;
			StationExtension component2 = component.GetComponent<StationExtension>();
			if (component2 != null)
			{
				CraftingStation craftingStation = component2.FindClosestStationInRange(vector);
				if (craftingStation)
				{
					component2.StartConnectionEffect(craftingStation, 1f);
				}
				else
				{
					component2.StopConnectionEffect();
					this.m_placementStatus = Player.PlacementStatus.ExtensionMissingStation;
				}
				if (component2.OtherExtensionInRange(component.m_spaceRequirement))
				{
					this.m_placementStatus = Player.PlacementStatus.MoreSpace;
				}
			}
			if (component.m_blockRadius > 0f && component.m_blockingPieces.Count > 0)
			{
				Collider[] array = Physics.OverlapSphere(vector, component.m_blockRadius, LayerMask.GetMask(new string[]
				{
					"piece"
				}));
				for (int i = 0; i < array.Length; i++)
				{
					Piece componentInParent = array[i].gameObject.GetComponentInParent<Piece>();
					if (componentInParent != null && componentInParent != component)
					{
						using (List<Piece>.Enumerator enumerator = component.m_blockingPieces.GetEnumerator())
						{
							while (enumerator.MoveNext())
							{
								if (enumerator.Current.m_name == componentInParent.m_name)
								{
									this.m_placementStatus = Player.PlacementStatus.MoreSpace;
									break;
								}
							}
						}
					}
				}
			}
			if (component.m_mustConnectTo != null)
			{
				ZNetView exists = null;
				Collider[] array = Physics.OverlapSphere(component.transform.position, component.m_connectRadius);
				for (int i = 0; i < array.Length; i++)
				{
					ZNetView componentInParent2 = array[i].GetComponentInParent<ZNetView>();
					if (componentInParent2 != null && componentInParent2 != this.m_nview && componentInParent2.name.Contains(component.m_mustConnectTo.name))
					{
						if (component.m_mustBeAboveConnected)
						{
							RaycastHit raycastHit;
							Physics.Raycast(component.transform.position, Vector3.down, out raycastHit);
							if (raycastHit.transform.GetComponentInParent<ZNetView>() != componentInParent2)
							{
								goto IL_31F;
							}
						}
						exists = componentInParent2;
						break;
					}
					IL_31F:;
				}
				if (!exists)
				{
					this.m_placementStatus = Player.PlacementStatus.Invalid;
				}
			}
			if (wearNTear && !wearNTear.m_supports)
			{
				this.m_placementStatus = Player.PlacementStatus.Invalid;
			}
			if (component.m_waterPiece && x == null && !flag)
			{
				this.m_placementStatus = Player.PlacementStatus.Invalid;
			}
			if (component.m_noInWater && x != null)
			{
				this.m_placementStatus = Player.PlacementStatus.Invalid;
			}
			if (component.m_groundPiece && heightmap == null)
			{
				this.m_placementGhost.SetActive(false);
				this.m_placementStatus = Player.PlacementStatus.Invalid;
				return;
			}
			if (component.m_groundOnly && heightmap == null)
			{
				this.m_placementStatus = Player.PlacementStatus.Invalid;
			}
			if (component.m_cultivatedGroundOnly && (heightmap == null || !heightmap.IsCultivated(vector)))
			{
				this.m_placementStatus = Player.PlacementStatus.NeedCultivated;
			}
			if (component.m_vegetationGroundOnly)
			{
				bool flag2 = heightmap == null;
				if (!flag2)
				{
					int biome = (int)heightmap.GetBiome(vector, 0.02f, false);
					float vegetationMask = heightmap.GetVegetationMask(vector);
					flag2 = ((biome == 32) ? (vegetationMask > 0.1f) : (vegetationMask < 0.25f));
				}
				if (flag2)
				{
					this.m_placementStatus = Player.PlacementStatus.NeedDirt;
				}
			}
			if (component.m_notOnWood && piece && wearNTear && (wearNTear.m_materialType == WearNTear.MaterialType.Wood || wearNTear.m_materialType == WearNTear.MaterialType.HardWood))
			{
				this.m_placementStatus = Player.PlacementStatus.Invalid;
			}
			if (component.m_notOnTiltingSurface && up.y < 0.8f)
			{
				this.m_placementStatus = Player.PlacementStatus.Invalid;
			}
			if (component.m_inCeilingOnly && up.y > -0.5f)
			{
				this.m_placementStatus = Player.PlacementStatus.Invalid;
			}
			if (component.m_notOnFloor && up.y > 0.1f)
			{
				this.m_placementStatus = Player.PlacementStatus.Invalid;
			}
			if (component.m_onlyInTeleportArea && !EffectArea.IsPointInsideArea(vector, EffectArea.Type.Teleport, 0f))
			{
				this.m_placementStatus = Player.PlacementStatus.NoTeleportArea;
			}
			if (!component.m_allowedInDungeons && base.InInterior() && !EnvMan.instance.CheckInteriorBuildingOverride() && !ZoneSystem.instance.GetGlobalKey(GlobalKeys.DungeonBuild))
			{
				this.m_placementStatus = Player.PlacementStatus.NotInDungeon;
			}
			if (heightmap)
			{
				up = Vector3.up;
			}
			this.m_placementGhost.SetActive(true);
			int manualSnapPoint = this.m_manualSnapPoint;
			if (!ZInput.GetButton("JoyAltKeys") && !Hud.IsPieceSelectionVisible() && Minimap.instance.m_mode != Minimap.MapMode.Large && !global::Console.IsVisible() && !Chat.instance.HasFocus())
			{
				if (ZInput.GetButtonDown("TabLeft") || (ZInput.GetButtonUp("JoyPrevSnap") && ZInput.GetButtonLastPressedTimer("JoyPrevSnap") < 0.33f))
				{
					this.m_manualSnapPoint--;
				}
				if (ZInput.GetButtonDown("TabRight") || (ZInput.GetButtonUp("JoyNextSnap") && ZInput.GetButtonLastPressedTimer("JoyNextSnap") < 0.33f))
				{
					this.m_manualSnapPoint++;
				}
			}
			this.m_tempSnapPoints1.Clear();
			this.m_placementGhost.GetComponent<Piece>().GetSnapPoints(this.m_tempSnapPoints1);
			if (this.m_manualSnapPoint < -1)
			{
				this.m_manualSnapPoint = this.m_tempSnapPoints1.Count - 1;
			}
			if (this.m_manualSnapPoint >= this.m_tempSnapPoints1.Count)
			{
				this.m_manualSnapPoint = -1;
			}
			if (((component.m_groundPiece || component.m_clipGround) && heightmap) || component.m_clipEverything)
			{
				GameObject selectedPrefab = this.m_buildPieces.GetSelectedPrefab();
				TerrainModifier component3 = selectedPrefab.GetComponent<TerrainModifier>();
				TerrainOp component4 = selectedPrefab.GetComponent<TerrainOp>();
				if ((component3 || component4) && component.m_allowAltGroundPlacement && ((ZInput.IsNonClassicFunctionality() && ZInput.IsGamepadActive()) ? (component.m_groundPiece && !this.m_altPlace) : (component.m_groundPiece && !ZInput.GetButton("AltPlace") && !ZInput.GetButton("JoyAltPlace"))))
				{
					float groundHeight = ZoneSystem.instance.GetGroundHeight(base.transform.position);
					vector.y = groundHeight;
				}
				this.m_placementGhost.transform.position = vector + ((this.m_manualSnapPoint < 0) ? Vector3.zero : (rotation * -this.m_tempSnapPoints1[this.m_manualSnapPoint].localPosition));
				this.m_placementGhost.transform.rotation = rotation;
			}
			else
			{
				Collider[] componentsInChildren = this.m_placementGhost.GetComponentsInChildren<Collider>();
				if (componentsInChildren.Length != 0)
				{
					this.m_placementGhost.transform.position = vector + up * 50f;
					this.m_placementGhost.transform.rotation = rotation;
					Vector3 b = Vector3.zero;
					float num = 999999f;
					foreach (Collider collider in componentsInChildren)
					{
						if (!collider.isTrigger && collider.enabled)
						{
							MeshCollider meshCollider = collider as MeshCollider;
							if (!(meshCollider != null) || meshCollider.convex)
							{
								Vector3 vector2 = collider.ClosestPoint(vector);
								float num2 = Vector3.Distance(vector2, vector);
								if (num2 < num)
								{
									b = vector2;
									num = num2;
								}
							}
						}
					}
					Vector3 vector3 = this.m_placementGhost.transform.position - b;
					if (component.m_waterPiece)
					{
						vector3.y = 3f;
					}
					this.m_placementGhost.transform.position = vector + ((this.m_manualSnapPoint < 0) ? vector3 : (rotation * -this.m_tempSnapPoints1[this.m_manualSnapPoint].localPosition));
					this.m_placementGhost.transform.rotation = rotation;
				}
			}
			if (manualSnapPoint != this.m_manualSnapPoint)
			{
				this.Message(MessageHud.MessageType.Center, "$msg_snapping " + ((this.m_manualSnapPoint == -1) ? "$msg_snapping_auto" : this.m_tempSnapPoints1[this.m_manualSnapPoint].name), 0, null);
			}
			if (!flag)
			{
				this.m_tempPieces.Clear();
				Transform transform;
				Transform transform2;
				if (this.FindClosestSnapPoints(this.m_placementGhost.transform, 0.5f, out transform, out transform2, this.m_tempPieces))
				{
					Vector3 position = transform2.parent.position;
					Vector3 vector4 = transform2.position - (transform.position - this.m_placementGhost.transform.position);
					if (!this.IsOverlappingOtherPiece(vector4, this.m_placementGhost.transform.rotation, this.m_placementGhost.name, this.m_tempPieces, component.m_allowRotatedOverlap))
					{
						this.m_placementGhost.transform.position = vector4;
					}
				}
			}
			if (Location.IsInsideNoBuildLocation(this.m_placementGhost.transform.position))
			{
				this.m_placementStatus = Player.PlacementStatus.NoBuildZone;
			}
			PrivateArea component5 = component.GetComponent<PrivateArea>();
			float radius = component5 ? component5.m_radius : 0f;
			bool wardCheck = component5 != null;
			if (!PrivateArea.CheckAccess(this.m_placementGhost.transform.position, radius, flashGuardStone, wardCheck))
			{
				this.m_placementStatus = Player.PlacementStatus.PrivateZone;
			}
			if (this.CheckPlacementGhostVSPlayers())
			{
				this.m_placementStatus = Player.PlacementStatus.BlockedbyPlayer;
			}
			if (component.m_onlyInBiome != Heightmap.Biome.None && (Heightmap.FindBiome(this.m_placementGhost.transform.position) & component.m_onlyInBiome) == Heightmap.Biome.None)
			{
				this.m_placementStatus = Player.PlacementStatus.WrongBiome;
			}
			if (component.m_noClipping && this.TestGhostClipping(this.m_placementGhost, 0.2f))
			{
				this.m_placementStatus = Player.PlacementStatus.Invalid;
			}
		}
		else
		{
			if (this.m_placementMarkerInstance)
			{
				this.m_placementMarkerInstance.SetActive(false);
			}
			this.m_placementGhost.SetActive(false);
			this.m_placementStatus = Player.PlacementStatus.NoRayHits;
		}
		this.SetPlacementGhostValid(this.m_placementStatus == Player.PlacementStatus.Valid);
	}

	// Token: 0x060003A0 RID: 928 RVA: 0x00041A60 File Offset: 0x0003FC60
	private bool IsOverlappingOtherPiece(Vector3 p, Quaternion rotation, string pieceName, List<Piece> pieces, bool allowRotatedOverlap)
	{
		foreach (Piece piece in this.m_tempPieces)
		{
			if (Vector3.Distance(p, piece.transform.position) < 0.05f && (!allowRotatedOverlap || Quaternion.Angle(piece.transform.rotation, rotation) <= 10f) && piece.gameObject.name.CustomStartsWith(pieceName))
			{
				return true;
			}
		}
		return false;
	}

	// Token: 0x060003A1 RID: 929 RVA: 0x00041AFC File Offset: 0x0003FCFC
	private bool FindClosestSnapPoints(Transform ghost, float maxSnapDistance, out Transform a, out Transform b, List<Piece> pieces)
	{
		this.m_tempSnapPoints1.Clear();
		ghost.GetComponent<Piece>().GetSnapPoints(this.m_tempSnapPoints1);
		this.m_tempSnapPoints2.Clear();
		this.m_tempPieces.Clear();
		Piece.GetSnapPoints(ghost.transform.position, 10f, this.m_tempSnapPoints2, this.m_tempPieces);
		float num = 9999999f;
		a = null;
		b = null;
		if (this.m_manualSnapPoint < 0)
		{
			foreach (Transform transform in this.m_tempSnapPoints1)
			{
				Transform transform2;
				float num2;
				if (this.FindClosestSnappoint(transform.position, this.m_tempSnapPoints2, maxSnapDistance, out transform2, out num2) && num2 < num)
				{
					num = num2;
					a = transform;
					b = transform2;
				}
			}
			return a != null;
		}
		Transform transform3;
		float num3;
		if (this.FindClosestSnappoint(this.m_tempSnapPoints1[this.m_manualSnapPoint].position, this.m_tempSnapPoints2, maxSnapDistance, out transform3, out num3))
		{
			a = this.m_tempSnapPoints1[this.m_manualSnapPoint];
			b = transform3;
			return true;
		}
		return false;
	}

	// Token: 0x060003A2 RID: 930 RVA: 0x00041C2C File Offset: 0x0003FE2C
	private bool FindClosestSnappoint(Vector3 p, List<Transform> snapPoints, float maxDistance, out Transform closest, out float distance)
	{
		closest = null;
		distance = 999999f;
		foreach (Transform transform in snapPoints)
		{
			float num = Vector3.Distance(transform.position, p);
			if (num <= maxDistance && num < distance)
			{
				closest = transform;
				distance = num;
			}
		}
		return closest != null;
	}

	// Token: 0x060003A3 RID: 931 RVA: 0x00041CA8 File Offset: 0x0003FEA8
	private bool TestGhostClipping(GameObject ghost, float maxPenetration)
	{
		Collider[] componentsInChildren = ghost.GetComponentsInChildren<Collider>();
		Collider[] array = Physics.OverlapSphere(ghost.transform.position, 10f, this.m_placeRayMask);
		foreach (Collider collider in componentsInChildren)
		{
			foreach (Collider collider2 in array)
			{
				Vector3 vector;
				float num;
				if (Physics.ComputePenetration(collider, collider.transform.position, collider.transform.rotation, collider2, collider2.transform.position, collider2.transform.rotation, out vector, out num) && num > maxPenetration)
				{
					return true;
				}
			}
		}
		return false;
	}

	// Token: 0x060003A4 RID: 932 RVA: 0x00041D4C File Offset: 0x0003FF4C
	private bool CheckPlacementGhostVSPlayers()
	{
		if (this.m_placementGhost == null)
		{
			return false;
		}
		List<Character> list = new List<Character>();
		Character.GetCharactersInRange(base.transform.position, 30f, list);
		foreach (Collider collider in this.m_placementGhost.GetComponentsInChildren<Collider>())
		{
			if (!collider.isTrigger && collider.enabled && !(collider.gameObject == this.m_placementGhost))
			{
				MeshCollider meshCollider = collider as MeshCollider;
				if (!(meshCollider != null) || meshCollider.convex)
				{
					foreach (Character character in list)
					{
						CapsuleCollider collider2 = character.GetCollider();
						Vector3 vector;
						float num;
						if (Physics.ComputePenetration(collider, collider.transform.position, collider.transform.rotation, collider2, collider2.transform.position, collider2.transform.rotation, out vector, out num))
						{
							return true;
						}
					}
				}
			}
		}
		return false;
	}

	// Token: 0x060003A5 RID: 933 RVA: 0x00041E78 File Offset: 0x00040078
	private bool PieceRayTest(out Vector3 point, out Vector3 normal, out Piece piece, out Heightmap heightmap, out Collider waterSurface, bool water)
	{
		int layerMask = this.m_placeRayMask;
		if (water)
		{
			layerMask = this.m_placeWaterRayMask;
		}
		RaycastHit raycastHit;
		if (Physics.Raycast(GameCamera.instance.transform.position, GameCamera.instance.transform.forward, out raycastHit, 50f, layerMask))
		{
			float num = this.m_maxPlaceDistance;
			if (this.m_placementGhost)
			{
				Piece component = this.m_placementGhost.GetComponent<Piece>();
				if (component != null)
				{
					num += (float)component.m_extraPlacementDistance;
				}
			}
			if (raycastHit.collider && !raycastHit.collider.attachedRigidbody && Vector3.Distance(this.m_eye.position, raycastHit.point) < num)
			{
				point = raycastHit.point;
				normal = raycastHit.normal;
				piece = raycastHit.collider.GetComponentInParent<Piece>();
				heightmap = raycastHit.collider.GetComponent<Heightmap>();
				if (raycastHit.collider.gameObject.layer == LayerMask.NameToLayer("Water"))
				{
					waterSurface = raycastHit.collider;
				}
				else
				{
					waterSurface = null;
				}
				return true;
			}
		}
		point = Vector3.zero;
		normal = Vector3.zero;
		piece = null;
		heightmap = null;
		waterSurface = null;
		return false;
	}

	// Token: 0x060003A6 RID: 934 RVA: 0x00041FC0 File Offset: 0x000401C0
	private void FindHoverObject(out GameObject hover, out Character hoverCreature)
	{
		hover = null;
		hoverCreature = null;
		int num = Physics.RaycastNonAlloc(GameCamera.instance.transform.position, GameCamera.instance.transform.forward, this.m_raycastHoverHits, 50f, this.m_interactMask);
		Array.Sort<RaycastHit>(this.m_raycastHoverHits, 0, num, Player.RaycastHitComparer.Instance);
		int i = 0;
		while (i < num)
		{
			RaycastHit raycastHit = this.m_raycastHoverHits[i];
			if (!raycastHit.collider.attachedRigidbody || !(raycastHit.collider.attachedRigidbody.gameObject == base.gameObject))
			{
				if (hoverCreature == null)
				{
					Character character = raycastHit.collider.attachedRigidbody ? raycastHit.collider.attachedRigidbody.GetComponent<Character>() : raycastHit.collider.GetComponent<Character>();
					if (character != null && (!character.GetBaseAI() || !character.GetBaseAI().IsSleeping()) && !ParticleMist.IsMistBlocked(base.GetCenterPoint(), character.GetCenterPoint()))
					{
						hoverCreature = character;
					}
				}
				if (Vector3.Distance(this.m_eye.position, raycastHit.point) >= this.m_maxInteractDistance)
				{
					break;
				}
				if (raycastHit.collider.GetComponent<Hoverable>() != null)
				{
					hover = raycastHit.collider.gameObject;
					return;
				}
				if (raycastHit.collider.attachedRigidbody)
				{
					hover = raycastHit.collider.attachedRigidbody.gameObject;
					return;
				}
				hover = raycastHit.collider.gameObject;
				return;
			}
			else
			{
				i++;
			}
		}
	}

	// Token: 0x060003A7 RID: 935 RVA: 0x00042158 File Offset: 0x00040358
	private void Interact(GameObject go, bool hold, bool alt)
	{
		if (this.InAttack() || this.InDodge())
		{
			return;
		}
		if (hold && Time.time - this.m_lastHoverInteractTime < 0.2f)
		{
			return;
		}
		Interactable componentInParent = go.GetComponentInParent<Interactable>();
		if (componentInParent != null)
		{
			this.m_lastHoverInteractTime = Time.time;
			if (componentInParent.Interact(this, hold, alt))
			{
				base.DoInteractAnimation((componentInParent as MonoBehaviour).gameObject);
			}
		}
	}

	// Token: 0x060003A8 RID: 936 RVA: 0x000421C0 File Offset: 0x000403C0
	private void UpdateStations(float dt)
	{
		this.m_stationDiscoverTimer += dt;
		if (this.m_stationDiscoverTimer > 1f)
		{
			this.m_stationDiscoverTimer = 0f;
			CraftingStation.UpdateKnownStationsInRange(this);
		}
		if (!(this.m_currentStation != null))
		{
			if (this.m_inCraftingStation)
			{
				this.m_zanim.SetInt("crafting", 0);
				this.m_inCraftingStation = false;
				if (InventoryGui.IsVisible())
				{
					InventoryGui.instance.Hide();
				}
			}
			return;
		}
		if (!this.m_currentStation.InUseDistance(this))
		{
			InventoryGui.instance.Hide();
			this.SetCraftingStation(null);
			return;
		}
		if (!InventoryGui.IsVisible())
		{
			this.SetCraftingStation(null);
			return;
		}
		this.m_currentStation.PokeInUse();
		if (!this.AlwaysRotateCamera())
		{
			Vector3 normalized = (this.m_currentStation.transform.position - base.transform.position).normalized;
			normalized.y = 0f;
			normalized.Normalize();
			Quaternion to = Quaternion.LookRotation(normalized);
			base.transform.rotation = Quaternion.RotateTowards(base.transform.rotation, to, this.m_turnSpeed * dt);
		}
		this.m_zanim.SetInt("crafting", this.m_currentStation.m_useAnimation);
		this.m_inCraftingStation = true;
	}

	// Token: 0x060003A9 RID: 937 RVA: 0x0000D058 File Offset: 0x0000B258
	public void SetCraftingStation(CraftingStation station)
	{
		if (this.m_currentStation == station)
		{
			return;
		}
		if (station)
		{
			this.AddKnownStation(station);
			station.PokeInUse();
			base.HideHandItems(false, true);
		}
		this.m_currentStation = station;
	}

	// Token: 0x060003AA RID: 938 RVA: 0x0000D08E File Offset: 0x0000B28E
	public CraftingStation GetCurrentCraftingStation()
	{
		return this.m_currentStation;
	}

	// Token: 0x060003AB RID: 939 RVA: 0x00042308 File Offset: 0x00040508
	private void UpdateCover(float dt)
	{
		this.m_updateCoverTimer += dt;
		if (this.m_updateCoverTimer > 1f)
		{
			this.m_updateCoverTimer = 0f;
			Cover.GetCoverForPoint(base.GetCenterPoint(), out this.m_coverPercentage, out this.m_underRoof, 0.5f);
		}
	}

	// Token: 0x060003AC RID: 940 RVA: 0x0000D096 File Offset: 0x0000B296
	public Character GetHoverCreature()
	{
		return this.m_hoveringCreature;
	}

	// Token: 0x060003AD RID: 941 RVA: 0x0000D09E File Offset: 0x0000B29E
	public override GameObject GetHoverObject()
	{
		return this.m_hovering;
	}

	// Token: 0x060003AE RID: 942 RVA: 0x0000D0A6 File Offset: 0x0000B2A6
	public override void OnNearFire(Vector3 point)
	{
		this.m_nearFireTimer = 0f;
	}

	// Token: 0x060003AF RID: 943 RVA: 0x0000D0B3 File Offset: 0x0000B2B3
	public bool InShelter()
	{
		return this.m_coverPercentage >= 0.8f && this.m_underRoof;
	}

	// Token: 0x060003B0 RID: 944 RVA: 0x0000D0CA File Offset: 0x0000B2CA
	public float GetStamina()
	{
		return this.m_stamina;
	}

	// Token: 0x060003B1 RID: 945 RVA: 0x0000D0D2 File Offset: 0x0000B2D2
	public override float GetMaxStamina()
	{
		return this.m_maxStamina;
	}

	// Token: 0x060003B2 RID: 946 RVA: 0x0000D0DA File Offset: 0x0000B2DA
	public float GetAdrenaline()
	{
		return this.m_adrenaline;
	}

	// Token: 0x060003B3 RID: 947 RVA: 0x0000D0E2 File Offset: 0x0000B2E2
	public override float GetMaxAdrenaline()
	{
		return this.m_maxAdrenaline + base.GetMaxAdrenaline();
	}

	// Token: 0x060003B4 RID: 948 RVA: 0x0000D0F1 File Offset: 0x0000B2F1
	public float GetEitr()
	{
		return this.m_eitr;
	}

	// Token: 0x060003B5 RID: 949 RVA: 0x0000D0F9 File Offset: 0x0000B2F9
	public override float GetMaxEitr()
	{
		return this.m_maxEitr;
	}

	// Token: 0x060003B6 RID: 950 RVA: 0x0000D101 File Offset: 0x0000B301
	public override float GetEitrPercentage()
	{
		return this.m_eitr / this.m_maxEitr;
	}

	// Token: 0x060003B7 RID: 951 RVA: 0x0000D110 File Offset: 0x0000B310
	public override float GetStaminaPercentage()
	{
		return this.m_stamina / this.m_maxStamina;
	}

	// Token: 0x060003B8 RID: 952 RVA: 0x0000D11F File Offset: 0x0000B31F
	public void SetGodMode(bool godMode)
	{
		this.m_godMode = godMode;
	}

	// Token: 0x060003B9 RID: 953 RVA: 0x0000D128 File Offset: 0x0000B328
	public override bool InGodMode()
	{
		return this.m_godMode;
	}

	// Token: 0x060003BA RID: 954 RVA: 0x0000D130 File Offset: 0x0000B330
	public void SetGhostMode(bool ghostmode)
	{
		this.m_ghostMode = ghostmode;
	}

	// Token: 0x060003BB RID: 955 RVA: 0x0000D139 File Offset: 0x0000B339
	public override bool InGhostMode()
	{
		return this.m_ghostMode;
	}

	// Token: 0x17000010 RID: 16
	// (get) Token: 0x060003BC RID: 956 RVA: 0x0000D141 File Offset: 0x0000B341
	// (set) Token: 0x060003BD RID: 957 RVA: 0x0000D149 File Offset: 0x0000B349
	public bool AttackTowardsPlayerLookDir
	{
		get
		{
			return this.m_attackTowardsPlayerLookDir;
		}
		set
		{
			this.m_attackTowardsPlayerLookDir = value;
		}
	}

	// Token: 0x060003BE RID: 958 RVA: 0x00042358 File Offset: 0x00040558
	public override bool IsDebugFlying()
	{
		if (this.m_nview == null || !this.m_nview.IsValid())
		{
			return false;
		}
		if (this.m_nview.IsOwner())
		{
			return this.m_debugFly;
		}
		return this.m_nview.GetZDO().GetBool(ZDOVars.s_debugFly, false);
	}

	// Token: 0x060003BF RID: 959 RVA: 0x0000D152 File Offset: 0x0000B352
	public override void AddEitr(float v)
	{
		this.m_eitr += v;
		if (this.m_eitr > this.m_maxEitr)
		{
			this.m_eitr = this.m_maxEitr;
		}
	}

	// Token: 0x060003C0 RID: 960 RVA: 0x0000D17C File Offset: 0x0000B37C
	public override void AddStamina(float v)
	{
		this.m_stamina += v;
		if (this.m_stamina > this.m_maxStamina)
		{
			this.m_stamina = this.m_maxStamina;
		}
	}

	// Token: 0x060003C1 RID: 961 RVA: 0x000423AC File Offset: 0x000405AC
	public override void AddAdrenaline(float v)
	{
		float maxAdrenaline = this.GetMaxAdrenaline();
		if (v > 0f && maxAdrenaline > 0f)
		{
			float time = this.GetAdrenaline() / this.GetMaxAdrenaline();
			this.m_adrenalineDegenTimer = this.m_adrenalineDegenDelay.Evaluate(time);
			v *= Game.m_adrenalineRate;
			v *= this.m_adrenalineGainMultiplier.Evaluate(time);
			this.m_seman.ModifyAdrenaline(v, ref v);
		}
		if (v < 0f || (v > 0f && this.m_adrenaline < maxAdrenaline))
		{
			this.m_adrenaline += v;
		}
		if (this.m_adrenaline >= maxAdrenaline && maxAdrenaline > 0f)
		{
			List<ItemDrop.ItemData> allItems = base.GetInventory().GetAllItems();
			bool flag = false;
			foreach (ItemDrop.ItemData itemData in allItems)
			{
				if (itemData.m_equipped && itemData.m_shared.m_fullAdrenalineSE != null)
				{
					flag = true;
					StatusEffect statusEffect = base.GetSEMan().GetStatusEffect(itemData.m_shared.m_fullAdrenalineSE.NameHash());
					if (statusEffect != null)
					{
						statusEffect.ResetTime();
					}
					else
					{
						base.GetSEMan().AddStatusEffect(itemData.m_shared.m_fullAdrenalineSE, false, 0, 0f);
					}
				}
			}
			this.m_adrenaline = (flag ? 0f : maxAdrenaline);
			if (flag)
			{
				this.m_adrenalinePopEffects.Create(base.transform.position, Quaternion.identity, null, 1f, -1);
			}
		}
		if (this.m_adrenaline < 0f)
		{
			this.m_adrenaline = 0f;
		}
		StatusEffect statusEffect2 = null;
		for (int i = this.m_adrenalineEffects.Count - 1; i >= 0; i--)
		{
			Player.StatusEffectLevel statusEffectLevel = this.m_adrenalineEffects[i];
			if (this.m_adrenaline >= statusEffectLevel.m_rate)
			{
				statusEffect2 = statusEffectLevel.m_se;
				break;
			}
		}
		if (this.m_adrenalineEffects.Count > 0 && (((statusEffect2 == null) ? null : base.GetSEMan().GetStatusEffect(statusEffect2.NameHash())) != statusEffect2 || (statusEffect2 == null && base.GetSEMan().GetStatusEffect(this.m_adrenalineEffects[0].m_se.NameHash()) != null)))
		{
			foreach (Player.StatusEffectLevel statusEffectLevel2 in this.m_adrenalineEffects)
			{
				base.GetSEMan().RemoveStatusEffect(statusEffectLevel2.m_se.NameHash(), false);
			}
			if (statusEffect2 != null)
			{
				base.GetSEMan().AddStatusEffect(statusEffect2.NameHash(), true, 0, 0f);
				Hud.instance.AdrenalineBarFlash();
			}
		}
	}

	// Token: 0x060003C2 RID: 962 RVA: 0x00042694 File Offset: 0x00040894
	public override void UseEitr(float v)
	{
		if (v == 0f)
		{
			return;
		}
		if (!this.m_nview.IsValid())
		{
			return;
		}
		if (this.m_nview.IsOwner())
		{
			this.RPC_UseEitr(0L, v);
			return;
		}
		this.m_nview.InvokeRPC("UseEitr", new object[]
		{
			v
		});
	}

	// Token: 0x060003C3 RID: 963 RVA: 0x0000D1A6 File Offset: 0x0000B3A6
	private void RPC_UseEitr(long sender, float v)
	{
		if (v == 0f)
		{
			return;
		}
		this.m_eitr -= v;
		if (this.m_eitr < 0f)
		{
			this.m_eitr = 0f;
		}
		this.m_eitrRegenTimer = this.m_eitrRegenDelay;
	}

	// Token: 0x060003C4 RID: 964 RVA: 0x000426F0 File Offset: 0x000408F0
	public override bool HaveEitr(float amount = 0f)
	{
		if (this.m_nview.IsValid() && !this.m_nview.IsOwner())
		{
			return this.m_nview.GetZDO().GetFloat(ZDOVars.s_eitr, this.m_maxEitr) > amount;
		}
		return this.m_eitr > amount;
	}

	// Token: 0x060003C5 RID: 965 RVA: 0x00042740 File Offset: 0x00040940
	public override void UseStamina(float v)
	{
		if (v == 0f || float.IsNaN(v))
		{
			return;
		}
		v *= Game.m_staminaRate;
		if (!this.m_nview.IsValid())
		{
			return;
		}
		if (this.m_nview.IsOwner())
		{
			this.RPC_UseStamina(0L, v);
			return;
		}
		this.m_nview.InvokeRPC("UseStamina", new object[]
		{
			v
		});
	}

	// Token: 0x060003C6 RID: 966 RVA: 0x0000D1E3 File Offset: 0x0000B3E3
	private void RPC_UseStamina(long sender, float v)
	{
		if (v == 0f)
		{
			return;
		}
		this.m_stamina -= v;
		if (this.m_stamina < 0f)
		{
			this.m_stamina = 0f;
		}
		this.m_staminaRegenTimer = this.m_staminaRegenDelay;
	}

	// Token: 0x060003C7 RID: 967 RVA: 0x000427AC File Offset: 0x000409AC
	public override bool HaveStamina(float amount = 0f)
	{
		if (this.m_nview.IsValid() && !this.m_nview.IsOwner())
		{
			return this.m_nview.GetZDO().GetFloat(ZDOVars.s_stamina, this.m_maxStamina) > amount;
		}
		return this.m_stamina > amount;
	}

	// Token: 0x060003C8 RID: 968 RVA: 0x000427FC File Offset: 0x000409FC
	public void Save(ZPackage pkg)
	{
		pkg.Write(29);
		pkg.Write(base.GetMaxHealth());
		pkg.Write(base.GetHealth());
		pkg.Write(this.GetMaxStamina());
		pkg.Write(this.m_timeSinceDeath);
		pkg.Write(this.m_guardianPower);
		pkg.Write(this.m_guardianPowerCooldown);
		this.m_inventory.Save(pkg);
		pkg.Write(this.m_knownRecipes.Count);
		foreach (string data in this.m_knownRecipes)
		{
			pkg.Write(data);
		}
		pkg.Write(this.m_knownStations.Count);
		foreach (KeyValuePair<string, int> keyValuePair in this.m_knownStations)
		{
			pkg.Write(keyValuePair.Key);
			pkg.Write(keyValuePair.Value);
		}
		pkg.Write(this.m_knownMaterial.Count);
		foreach (string data2 in this.m_knownMaterial)
		{
			pkg.Write(data2);
		}
		pkg.Write(this.m_shownTutorials.Count);
		foreach (string data3 in this.m_shownTutorials)
		{
			pkg.Write(data3);
		}
		pkg.Write(this.m_uniques.Count);
		foreach (string data4 in this.m_uniques)
		{
			pkg.Write(data4);
		}
		pkg.Write(this.m_trophies.Count);
		foreach (string data5 in this.m_trophies)
		{
			pkg.Write(data5);
		}
		pkg.Write(this.m_knownBiome.Count);
		foreach (Heightmap.Biome data6 in this.m_knownBiome)
		{
			pkg.Write((int)data6);
		}
		pkg.Write(this.m_knownTexts.Count);
		foreach (KeyValuePair<string, string> keyValuePair2 in this.m_knownTexts)
		{
			pkg.Write(keyValuePair2.Key.Replace("\u0016", ""));
			pkg.Write(keyValuePair2.Value.Replace("\u0016", ""));
		}
		pkg.Write(this.m_beardItem);
		pkg.Write(this.m_hairItem);
		pkg.Write(this.m_skinColor);
		pkg.Write(this.m_hairColor);
		pkg.Write(this.m_modelIndex);
		pkg.Write(this.m_foods.Count);
		foreach (Player.Food food in this.m_foods)
		{
			pkg.Write(food.m_name);
			pkg.Write(food.m_time);
		}
		this.m_skills.Save(pkg);
		pkg.Write(this.m_customData.Count);
		foreach (KeyValuePair<string, string> keyValuePair3 in this.m_customData)
		{
			pkg.Write(keyValuePair3.Key);
			pkg.Write(keyValuePair3.Value);
		}
		pkg.Write(this.GetStamina());
		pkg.Write(this.GetMaxEitr());
		pkg.Write(this.GetEitr());
	}

	// Token: 0x060003C9 RID: 969 RVA: 0x00042C90 File Offset: 0x00040E90
	public void Load(ZPackage pkg)
	{
		this.m_isLoading = true;
		base.UnequipAllItems();
		int num = pkg.ReadInt();
		if (num >= 7)
		{
			this.SetMaxHealth(pkg.ReadSingle(), false);
		}
		float num2 = pkg.ReadSingle();
		float maxHealth = base.GetMaxHealth();
		if (num2 <= 0f || num2 > maxHealth || float.IsNaN(num2))
		{
			num2 = maxHealth;
		}
		base.SetHealth(num2);
		if (num >= 10)
		{
			float stamina = pkg.ReadSingle();
			this.SetMaxStamina(stamina, false);
			this.m_stamina = stamina;
		}
		if (num >= 8 && num < 28)
		{
			pkg.ReadBool();
		}
		if (num >= 20)
		{
			this.m_timeSinceDeath = pkg.ReadSingle();
		}
		if (num >= 23)
		{
			string guardianPower = pkg.ReadString();
			this.SetGuardianPower(guardianPower);
		}
		if (num >= 24)
		{
			this.m_guardianPowerCooldown = pkg.ReadSingle();
		}
		if (num == 2)
		{
			pkg.ReadZDOID();
		}
		this.m_inventory.Load(pkg);
		int num3 = pkg.ReadInt();
		for (int i = 0; i < num3; i++)
		{
			string item = pkg.ReadString();
			this.m_knownRecipes.Add(item);
		}
		if (num < 15)
		{
			int num4 = pkg.ReadInt();
			for (int j = 0; j < num4; j++)
			{
				pkg.ReadString();
			}
		}
		else
		{
			int num5 = pkg.ReadInt();
			for (int k = 0; k < num5; k++)
			{
				string key = pkg.ReadString();
				int value = pkg.ReadInt();
				this.m_knownStations.Add(key, value);
			}
		}
		int num6 = pkg.ReadInt();
		for (int l = 0; l < num6; l++)
		{
			string item2 = pkg.ReadString();
			this.m_knownMaterial.Add(item2);
		}
		if (num < 19 || num >= 21)
		{
			int num7 = pkg.ReadInt();
			for (int m = 0; m < num7; m++)
			{
				string item3 = pkg.ReadString();
				this.m_shownTutorials.Add(item3);
			}
		}
		if (num >= 6)
		{
			int num8 = pkg.ReadInt();
			for (int n = 0; n < num8; n++)
			{
				string item4 = pkg.ReadString();
				this.m_uniques.Add(item4);
			}
		}
		if (num >= 9)
		{
			int num9 = pkg.ReadInt();
			for (int num10 = 0; num10 < num9; num10++)
			{
				string item5 = pkg.ReadString();
				this.m_trophies.Add(item5);
			}
		}
		if (num >= 18)
		{
			int num11 = pkg.ReadInt();
			for (int num12 = 0; num12 < num11; num12++)
			{
				Heightmap.Biome item6 = (Heightmap.Biome)pkg.ReadInt();
				this.m_knownBiome.Add(item6);
			}
		}
		if (num >= 22)
		{
			int num13 = pkg.ReadInt();
			for (int num14 = 0; num14 < num13; num14++)
			{
				string key2 = pkg.ReadString();
				string value2 = pkg.ReadString();
				this.m_knownTexts[key2] = value2;
			}
		}
		if (num >= 4)
		{
			string beard = pkg.ReadString();
			string hair = pkg.ReadString();
			base.SetBeard(beard);
			base.SetHair(hair);
		}
		if (num >= 5)
		{
			Vector3 skinColor = pkg.ReadVector3();
			Vector3 hairColor = pkg.ReadVector3();
			this.SetSkinColor(skinColor);
			this.SetHairColor(hairColor);
		}
		if (num >= 11)
		{
			int playerModel = pkg.ReadInt();
			this.SetPlayerModel(playerModel);
		}
		if (num >= 12)
		{
			this.m_foods.Clear();
			int num15 = pkg.ReadInt();
			for (int num16 = 0; num16 < num15; num16++)
			{
				if (num >= 14)
				{
					Player.Food food = new Player.Food();
					food.m_name = pkg.ReadString();
					if (num >= 25)
					{
						food.m_time = pkg.ReadSingle();
					}
					else
					{
						food.m_health = pkg.ReadSingle();
						if (num >= 16)
						{
							food.m_stamina = pkg.ReadSingle();
						}
					}
					GameObject itemPrefab = ObjectDB.instance.GetItemPrefab(food.m_name);
					if (itemPrefab == null)
					{
						ZLog.LogWarning("Failed to find food item " + food.m_name);
					}
					else
					{
						food.m_item = itemPrefab.GetComponent<ItemDrop>().m_itemData;
						this.m_foods.Add(food);
					}
				}
				else
				{
					pkg.ReadString();
					pkg.ReadSingle();
					pkg.ReadSingle();
					pkg.ReadSingle();
					pkg.ReadSingle();
					pkg.ReadSingle();
					pkg.ReadSingle();
					if (num >= 13)
					{
						pkg.ReadSingle();
					}
				}
			}
		}
		if (num >= 17)
		{
			this.m_skills.Load(pkg);
		}
		if (num >= 26)
		{
			int num17 = pkg.ReadInt();
			for (int num18 = 0; num18 < num17; num18++)
			{
				string key3 = pkg.ReadString();
				string value3 = pkg.ReadString();
				this.m_customData[key3] = value3;
			}
			this.m_stamina = Mathf.Clamp(pkg.ReadSingle(), 0f, this.m_maxStamina);
			this.SetMaxEitr(pkg.ReadSingle(), false);
			this.m_eitr = Mathf.Clamp(pkg.ReadSingle(), 0f, this.m_maxEitr);
		}
		if (num < 27)
		{
			if (this.m_knownMaterial.Contains("$item_flametal"))
			{
				ZLog.DevLog("Pre ashlands character loaded, replacing flametal with ancient as known material.");
				this.m_knownMaterial.Remove("$item_flametal");
				this.m_knownMaterial.Add("$item_flametal_old");
			}
			if (this.m_knownMaterial.Contains("$item_flametalore"))
			{
				ZLog.DevLog("Pre ashlands character loaded, replacing flametal ore with ancient as known material.");
				this.m_knownMaterial.Remove("$item_flametalore");
				this.m_knownMaterial.Add("$item_flametalore_old");
			}
		}
		this.m_isLoading = false;
		this.UpdateAvailablePiecesList();
		this.EquipInventoryItems();
		this.UpdateEvents();
	}

	// Token: 0x060003CA RID: 970 RVA: 0x000431D4 File Offset: 0x000413D4
	private void EquipInventoryItems()
	{
		foreach (ItemDrop.ItemData itemData in this.m_inventory.GetEquippedItems())
		{
			if (!base.EquipItem(itemData, false))
			{
				itemData.m_equipped = false;
			}
		}
	}

	// Token: 0x060003CB RID: 971 RVA: 0x0000D220 File Offset: 0x0000B420
	public override bool CanMove()
	{
		return !this.m_teleporting && !this.InCutscene() && (!this.IsEncumbered() || this.HaveStamina(0f)) && base.CanMove();
	}

	// Token: 0x060003CC RID: 972 RVA: 0x0000D253 File Offset: 0x0000B453
	public override bool IsEncumbered()
	{
		return this.m_inventory.GetTotalWeight() > this.GetMaxCarryWeight();
	}

	// Token: 0x060003CD RID: 973 RVA: 0x00043238 File Offset: 0x00041438
	public float GetMaxCarryWeight()
	{
		float maxCarryWeight = this.m_maxCarryWeight;
		this.m_seman.ModifyMaxCarryWeight(maxCarryWeight, ref maxCarryWeight);
		return maxCarryWeight;
	}

	// Token: 0x060003CE RID: 974 RVA: 0x0000D268 File Offset: 0x0000B468
	public override bool HaveUniqueKey(string name)
	{
		return this.m_uniques.Contains(name);
	}

	// Token: 0x060003CF RID: 975 RVA: 0x0004325C File Offset: 0x0004145C
	public bool HaveUniqueKeyValue(string key, string value)
	{
		key = key.ToLower();
		value = value.ToLower();
		foreach (string text in this.m_uniques)
		{
			string[] array = text.Split(' ', StringSplitOptions.None);
			if (array.Length >= 2 && array[0].ToLower() == key && array[1].ToLower() == value)
			{
				return true;
			}
		}
		return false;
	}

	// Token: 0x060003D0 RID: 976 RVA: 0x000432F0 File Offset: 0x000414F0
	public bool TryGetUniqueKeyValue(string key, out string value)
	{
		key = key.ToLower();
		foreach (string text in this.m_uniques)
		{
			string[] array = text.Split(' ', StringSplitOptions.None);
			if (array.Length >= 2 && array[0].ToLower() == key)
			{
				value = array[1];
				return true;
			}
		}
		value = null;
		return false;
	}

	// Token: 0x060003D1 RID: 977 RVA: 0x00043374 File Offset: 0x00041574
	public bool RemoveUniqueKeyValue(string key)
	{
		key = key.ToLower();
		int count = this.m_uniques.Count;
		this.m_uniques.RemoveWhere(delegate(string x)
		{
			string[] array = x.Split(' ', StringSplitOptions.None);
			return array.Length >= 2 && array[0].ToLower() == key;
		});
		if (this.m_uniques.Count != count)
		{
			ZoneSystem instance = ZoneSystem.instance;
			if (instance != null)
			{
				instance.UpdateWorldRates();
			}
			this.UpdateEvents();
			return true;
		}
		return false;
	}

	// Token: 0x060003D2 RID: 978 RVA: 0x0000D276 File Offset: 0x0000B476
	public void AddUniqueKeyValue(string key, string value)
	{
		this.AddUniqueKey(key + " " + value);
	}

	// Token: 0x060003D3 RID: 979 RVA: 0x0000D28A File Offset: 0x0000B48A
	public override void AddUniqueKey(string name)
	{
		if (!this.m_uniques.Contains(name))
		{
			this.m_uniques.Add(name);
		}
		ZoneSystem instance = ZoneSystem.instance;
		if (instance != null)
		{
			instance.UpdateWorldRates();
		}
		this.UpdateEvents();
	}

	// Token: 0x060003D4 RID: 980 RVA: 0x0000D2BD File Offset: 0x0000B4BD
	public override bool RemoveUniqueKey(string name)
	{
		if (this.m_uniques.Contains(name))
		{
			this.m_uniques.Remove(name);
			ZoneSystem.instance.UpdateWorldRates();
			this.UpdateEvents();
			return true;
		}
		return false;
	}

	// Token: 0x060003D5 RID: 981 RVA: 0x0000D2ED File Offset: 0x0000B4ED
	public List<string> GetUniqueKeys()
	{
		this.m_tempUniqueKeys.Clear();
		this.m_tempUniqueKeys.AddRange(this.m_uniques);
		return this.m_tempUniqueKeys;
	}

	// Token: 0x060003D6 RID: 982 RVA: 0x0000D311 File Offset: 0x0000B511
	public void ResetUniqueKeys()
	{
		this.m_uniques.Clear();
	}

	// Token: 0x060003D7 RID: 983 RVA: 0x0000D31E File Offset: 0x0000B51E
	public bool IsBiomeKnown(Heightmap.Biome biome)
	{
		return this.m_knownBiome.Contains(biome);
	}

	// Token: 0x060003D8 RID: 984 RVA: 0x000433EC File Offset: 0x000415EC
	private void AddKnownBiome(Heightmap.Biome biome)
	{
		if (!this.m_knownBiome.Contains(biome))
		{
			this.m_knownBiome.Add(biome);
			if (biome != Heightmap.Biome.Meadows && biome != Heightmap.Biome.None)
			{
				string text = "$biome_" + biome.ToString().ToLower();
				MessageHud.instance.ShowBiomeFoundMsg(text, true);
			}
			if (biome == Heightmap.Biome.BlackForest && !ZoneSystem.instance.GetGlobalKey("defeated_eikthyr"))
			{
				this.ShowTutorial("blackforest", false);
			}
			Gogan.LogEvent("Game", "BiomeFound", biome.ToString(), 0L);
		}
		if (biome == Heightmap.Biome.BlackForest)
		{
			this.ShowTutorial("haldor", false);
		}
		if (biome == Heightmap.Biome.AshLands)
		{
			this.ShowTutorial("ashlands", false);
		}
	}

	// Token: 0x060003D9 RID: 985 RVA: 0x0000D32C File Offset: 0x0000B52C
	public void AddKnownLocationName(string label)
	{
		if (!this.m_shownTutorials.Contains(label))
		{
			this.m_shownTutorials.Add(label);
			MessageHud.instance.ShowBiomeFoundMsg(label, true);
		}
	}

	// Token: 0x060003DA RID: 986 RVA: 0x0000D355 File Offset: 0x0000B555
	public bool IsRecipeKnown(string name)
	{
		return this.m_knownRecipes.Contains(name);
	}

	// Token: 0x060003DB RID: 987 RVA: 0x000434A4 File Offset: 0x000416A4
	private void AddKnownRecipe(Recipe recipe)
	{
		if (!this.m_knownRecipes.Contains(recipe.m_item.m_itemData.m_shared.m_name))
		{
			this.m_knownRecipes.Add(recipe.m_item.m_itemData.m_shared.m_name);
			MessageHud.instance.QueueUnlockMsg(recipe.m_item.m_itemData.GetIcon(), "$msg_newrecipe", recipe.m_item.m_itemData.m_shared.m_name);
			Gogan.LogEvent("Game", "RecipeFound", recipe.m_item.m_itemData.m_shared.m_name, 0L);
		}
	}

	// Token: 0x060003DC RID: 988 RVA: 0x00043550 File Offset: 0x00041750
	private void AddKnownPiece(Piece piece)
	{
		if (this.m_knownRecipes.Contains(piece.m_name))
		{
			return;
		}
		this.m_knownRecipes.Add(piece.m_name);
		string topic = (piece.m_category == Piece.PieceCategory.Feasts || piece.m_category == Piece.PieceCategory.Food || piece.m_category == Piece.PieceCategory.Meads) ? "$msg_newdish" : "$msg_newpiece";
		MessageHud.instance.QueueUnlockMsg(piece.m_icon, topic, piece.m_name);
		Gogan.LogEvent("Game", "PieceFound", piece.m_name, 0L);
	}

	// Token: 0x060003DD RID: 989 RVA: 0x000435DC File Offset: 0x000417DC
	public void AddKnownStation(CraftingStation station)
	{
		int level = station.GetLevel(true);
		int num;
		if (this.m_knownStations.TryGetValue(station.m_name, out num))
		{
			if (num < level)
			{
				this.m_knownStations[station.m_name] = level;
				MessageHud.instance.QueueUnlockMsg(station.m_icon, "$msg_newstation_level", station.m_name + " $msg_level " + level.ToString());
				this.UpdateKnownRecipesList();
			}
			return;
		}
		this.m_knownStations.Add(station.m_name, level);
		MessageHud.instance.QueueUnlockMsg(station.m_icon, "$msg_newstation", station.m_name);
		Gogan.LogEvent("Game", "StationFound", station.m_name, 0L);
		this.UpdateKnownRecipesList();
	}

	// Token: 0x060003DE RID: 990 RVA: 0x0004369C File Offset: 0x0004189C
	private bool KnowStationLevel(string name, int level)
	{
		int num;
		return this.m_knownStations.TryGetValue(name, out num) && num >= level;
	}

	// Token: 0x060003DF RID: 991 RVA: 0x000436C4 File Offset: 0x000418C4
	public void AddKnownText(string label, string text)
	{
		if (label.Length == 0)
		{
			ZLog.LogWarning("Text " + text + " Is missing label");
			return;
		}
		if (!this.m_knownTexts.ContainsKey(label.Replace("\u0016", "")))
		{
			this.m_knownTexts.Add(label, text);
			this.Message(MessageHud.MessageType.TopLeft, Localization.instance.Localize("$msg_newtext", new string[]
			{
				label
			}), 0, this.m_textIcon);
		}
	}

	// Token: 0x060003E0 RID: 992 RVA: 0x0000D363 File Offset: 0x0000B563
	public List<KeyValuePair<string, string>> GetKnownTexts()
	{
		return this.m_knownTexts.ToList<KeyValuePair<string, string>>();
	}

	// Token: 0x060003E1 RID: 993 RVA: 0x00043740 File Offset: 0x00041940
	public void AddKnownItem(ItemDrop.ItemData item)
	{
		if (item.m_shared.m_itemType == ItemDrop.ItemData.ItemType.Trophy)
		{
			this.AddTrophy(item);
		}
		if (!this.m_knownMaterial.Contains(item.m_shared.m_name))
		{
			this.m_knownMaterial.Add(item.m_shared.m_name);
			if (item.m_shared.m_itemType == ItemDrop.ItemData.ItemType.Material)
			{
				MessageHud.instance.QueueUnlockMsg(item.GetIcon(), "$msg_newmaterial", item.m_shared.m_name);
			}
			else if (item.m_shared.m_itemType == ItemDrop.ItemData.ItemType.Trophy)
			{
				MessageHud.instance.QueueUnlockMsg(item.GetIcon(), "$msg_newtrophy", item.m_shared.m_name);
			}
			else
			{
				MessageHud.instance.QueueUnlockMsg(item.GetIcon(), "$msg_newitem", item.m_shared.m_name);
			}
			Gogan.LogEvent("Game", "ItemFound", item.m_shared.m_name, 0L);
			this.UpdateKnownRecipesList();
			this.UpdateEvents();
		}
	}

	// Token: 0x060003E2 RID: 994 RVA: 0x00043840 File Offset: 0x00041A40
	private void AddTrophy(ItemDrop.ItemData item)
	{
		if (item.m_shared.m_itemType != ItemDrop.ItemData.ItemType.Trophy)
		{
			return;
		}
		if (!this.m_trophies.Contains(item.m_dropPrefab.name))
		{
			this.m_trophies.Add(item.m_dropPrefab.name);
		}
	}

	// Token: 0x060003E3 RID: 995 RVA: 0x0000D370 File Offset: 0x0000B570
	public List<string> GetTrophies()
	{
		List<string> list = new List<string>();
		list.AddRange(this.m_trophies);
		return list;
	}

	// Token: 0x060003E4 RID: 996 RVA: 0x0004388C File Offset: 0x00041A8C
	private void UpdateKnownRecipesList()
	{
		if (Game.instance == null)
		{
			return;
		}
		foreach (Recipe recipe in ObjectDB.instance.m_recipes)
		{
			bool flag = this.m_currentSeason != null && this.m_currentSeason.Recipes.Contains(recipe);
			if ((recipe.m_enabled || flag) && recipe.m_item && !this.m_knownRecipes.Contains(recipe.m_item.m_itemData.m_shared.m_name) && this.HaveRequirements(recipe, true, 0, 1))
			{
				this.AddKnownRecipe(recipe);
			}
		}
		this.m_tempOwnedPieceTables.Clear();
		this.m_inventory.GetAllPieceTables(this.m_tempOwnedPieceTables);
		bool flag2 = false;
		foreach (PieceTable pieceTable in this.m_tempOwnedPieceTables)
		{
			foreach (GameObject gameObject in pieceTable.m_pieces)
			{
				Piece component = gameObject.GetComponent<Piece>();
				bool flag3 = this.m_currentSeason != null && this.m_currentSeason.Pieces.Contains(gameObject);
				if ((component.m_enabled || flag3) && !this.m_knownRecipes.Contains(component.m_name) && this.HaveRequirements(component, Player.RequirementMode.IsKnown))
				{
					this.AddKnownPiece(component);
					flag2 = true;
				}
			}
		}
		if (flag2)
		{
			this.UpdateAvailablePiecesList();
		}
	}

	// Token: 0x060003E5 RID: 997 RVA: 0x0000D383 File Offset: 0x0000B583
	private void UpdateAvailablePiecesList()
	{
		if (this.m_buildPieces != null)
		{
			this.m_buildPieces.UpdateAvailable(this.m_knownRecipes, this, false, this.m_noPlacementCost || ZoneSystem.instance.GetGlobalKey(GlobalKeys.AllPiecesUnlocked));
		}
		this.SetupPlacementGhost();
	}

	// Token: 0x060003E6 RID: 998 RVA: 0x00043A68 File Offset: 0x00041C68
	private void UpdateCurrentSeason()
	{
		this.m_currentSeason = null;
		foreach (SeasonalItemGroup seasonalItemGroup in this.m_seasonalItemGroups)
		{
			if (seasonalItemGroup.IsInSeason())
			{
				this.m_currentSeason = seasonalItemGroup;
				break;
			}
		}
	}

	// Token: 0x060003E7 RID: 999 RVA: 0x00043ACC File Offset: 0x00041CCC
	public override void Message(MessageHud.MessageType type, string msg, int amount = 0, Sprite icon = null)
	{
		if (this.m_nview == null || !this.m_nview.IsValid())
		{
			return;
		}
		if (this.m_nview.IsOwner())
		{
			if (MessageHud.instance)
			{
				MessageHud.instance.ShowMessage(type, msg, amount, icon, false);
				return;
			}
		}
		else
		{
			this.m_nview.InvokeRPC("Message", new object[]
			{
				(int)type,
				msg,
				amount
			});
		}
	}

	// Token: 0x060003E8 RID: 1000 RVA: 0x0000D3C3 File Offset: 0x0000B5C3
	private void RPC_Message(long sender, int type, string msg, int amount)
	{
		if (!this.m_nview.IsOwner())
		{
			return;
		}
		if (MessageHud.instance)
		{
			MessageHud.instance.ShowMessage((MessageHud.MessageType)type, msg, amount, null, false);
		}
	}

	// Token: 0x060003E9 RID: 1001 RVA: 0x00043B4C File Offset: 0x00041D4C
	public static Player GetPlayer(long playerID)
	{
		foreach (Player player in Player.s_players)
		{
			if (player.GetPlayerID() == playerID)
			{
				return player;
			}
		}
		return null;
	}

	// Token: 0x060003EA RID: 1002 RVA: 0x00043BA8 File Offset: 0x00041DA8
	public static Player GetClosestPlayer(Vector3 point, float maxRange)
	{
		Player result = null;
		float num = 999999f;
		foreach (Player player in Player.s_players)
		{
			float num2 = Vector3.Distance(player.transform.position, point);
			if (num2 < num && num2 < maxRange)
			{
				num = num2;
				result = player;
			}
		}
		return result;
	}

	// Token: 0x060003EB RID: 1003 RVA: 0x00043C20 File Offset: 0x00041E20
	public static bool IsPlayerInRange(Vector3 point, float range, long playerID)
	{
		foreach (Player player in Player.s_players)
		{
			if (player.GetPlayerID() == playerID)
			{
				return global::Utils.DistanceXZ(player.transform.position, point) < range;
			}
		}
		return false;
	}

	// Token: 0x060003EC RID: 1004 RVA: 0x00043C90 File Offset: 0x00041E90
	public static void MessageAllInRange(Vector3 point, float range, MessageHud.MessageType type, string msg, Sprite icon = null)
	{
		foreach (Player player in Player.s_players)
		{
			if (Vector3.Distance(player.transform.position, point) < range)
			{
				player.Message(type, msg, 0, icon);
			}
		}
	}

	// Token: 0x060003ED RID: 1005 RVA: 0x00043CFC File Offset: 0x00041EFC
	public static int GetPlayersInRangeXZ(Vector3 point, float range)
	{
		int num = 0;
		using (List<Player>.Enumerator enumerator = Player.s_players.GetEnumerator())
		{
			while (enumerator.MoveNext())
			{
				if (global::Utils.DistanceXZ(enumerator.Current.transform.position, point) < range)
				{
					num++;
				}
			}
		}
		return num;
	}

	// Token: 0x060003EE RID: 1006 RVA: 0x00043D60 File Offset: 0x00041F60
	public static void GetPlayersInRange(Vector3 point, float range, List<Player> players)
	{
		foreach (Player player in Player.s_players)
		{
			if (Vector3.Distance(player.transform.position, point) < range)
			{
				players.Add(player);
			}
		}
	}

	// Token: 0x060003EF RID: 1007 RVA: 0x00043DC8 File Offset: 0x00041FC8
	public static bool IsPlayerInRange(Vector3 point, float range)
	{
		using (List<Player>.Enumerator enumerator = Player.s_players.GetEnumerator())
		{
			while (enumerator.MoveNext())
			{
				if (Vector3.Distance(enumerator.Current.transform.position, point) < range)
				{
					return true;
				}
			}
		}
		return false;
	}

	// Token: 0x060003F0 RID: 1008 RVA: 0x00043E2C File Offset: 0x0004202C
	public static bool IsPlayerInRange(Vector3 point, float range, float minNoise)
	{
		foreach (Player player in Player.s_players)
		{
			if (Vector3.Distance(player.transform.position, point) < range)
			{
				float noiseRange = player.GetNoiseRange();
				if (range <= noiseRange && noiseRange >= minNoise)
				{
					return true;
				}
			}
		}
		return false;
	}

	// Token: 0x060003F1 RID: 1009 RVA: 0x00043EA4 File Offset: 0x000420A4
	public static Player GetPlayerNoiseRange(Vector3 point, float maxNoiseRange = 100f)
	{
		foreach (Player player in Player.s_players)
		{
			float num = Vector3.Distance(player.transform.position, point);
			float num2 = Mathf.Min(player.GetNoiseRange(), maxNoiseRange);
			if (num < num2)
			{
				return player;
			}
		}
		return null;
	}

	// Token: 0x060003F2 RID: 1010 RVA: 0x0000D3EF File Offset: 0x0000B5EF
	public static List<Player> GetAllPlayers()
	{
		return Player.s_players;
	}

	// Token: 0x060003F3 RID: 1011 RVA: 0x0000D3F6 File Offset: 0x0000B5F6
	public static Player GetRandomPlayer()
	{
		if (Player.s_players.Count == 0)
		{
			return null;
		}
		return Player.s_players[UnityEngine.Random.Range(0, Player.s_players.Count)];
	}

	// Token: 0x060003F4 RID: 1012 RVA: 0x00043F1C File Offset: 0x0004211C
	public void GetAvailableRecipes(ref List<Recipe> available)
	{
		available.Clear();
		foreach (Recipe recipe in ObjectDB.instance.m_recipes)
		{
			bool flag = this.m_currentSeason != null && this.m_currentSeason.Recipes.Contains(recipe);
			if ((recipe.m_enabled || flag) && recipe.m_item)
			{
				if (Player.s_FilterCraft.Count > 0)
				{
					bool flag2 = false;
					int num = 0;
					while (num < Player.s_FilterCraft.Count && (Player.s_FilterCraft[num].Length <= 0 || (!recipe.m_item.name.ToLower().Contains(Player.s_FilterCraft[num].ToLower()) && !recipe.m_item.m_itemData.m_shared.m_name.ToLower().Contains(Player.s_FilterCraft[num].ToLower()) && !Localization.instance.Localize(recipe.m_item.m_itemData.m_shared.m_name).ToLower().Contains(Player.s_FilterCraft[num].ToLower()))))
					{
						if (num + 1 == Player.s_FilterCraft.Count)
						{
							flag2 = true;
						}
						num++;
					}
					if (flag2)
					{
						continue;
					}
				}
				if ((recipe.m_item.m_itemData.m_shared.m_dlc.Length <= 0 || DLCMan.instance.IsDLCInstalled(recipe.m_item.m_itemData.m_shared.m_dlc)) && (this.m_knownRecipes.Contains(recipe.m_item.m_itemData.m_shared.m_name) || this.m_noPlacementCost || ZoneSystem.instance.GetGlobalKey(GlobalKeys.AllRecipesUnlocked)) && (this.RequiredCraftingStation(recipe, 1, false) || this.m_noPlacementCost))
				{
					available.Add(recipe);
				}
			}
		}
	}

	// Token: 0x060003F5 RID: 1013 RVA: 0x00044150 File Offset: 0x00042350
	private void OnInventoryChanged()
	{
		if (this.m_isLoading)
		{
			return;
		}
		foreach (ItemDrop.ItemData itemData in this.m_inventory.GetAllItems())
		{
			this.AddKnownItem(itemData);
			if (!itemData.m_pickedUp)
			{
				itemData.m_pickedUp = true;
				PlayerProfile playerProfile = Game.instance.GetPlayerProfile();
				playerProfile.IncrementStat(PlayerStatType.ItemsPickedUp, 1f);
				playerProfile.m_itemPickupStats.IncrementOrSet(itemData.m_shared.m_name, (float)itemData.m_stack);
			}
			if (itemData.m_shared.m_name == "$item_hammer")
			{
				this.ShowTutorial("hammer", false);
			}
			else if (itemData.m_shared.m_name == "$item_hoe")
			{
				this.ShowTutorial("hoe", false);
			}
			else if (itemData.m_shared.m_name == "$item_bellfragment")
			{
				this.ShowTutorial("bellfragment", false);
			}
			else if (itemData.m_shared.m_name == "$item_pickaxe_antler")
			{
				this.ShowTutorial("pickaxe", false);
			}
			else if (itemData.m_shared.m_name.CustomStartsWith("$item_shield"))
			{
				this.ShowTutorial("shield", false);
			}
			if (itemData.m_shared.m_name == "$item_trophy_eikthyr")
			{
				this.ShowTutorial("boss_trophy", false);
			}
			if (itemData.m_shared.m_name == "$item_wishbone")
			{
				this.ShowTutorial("wishbone", false);
			}
			else if (itemData.m_shared.m_name == "$item_copperore" || itemData.m_shared.m_name == "$item_tinore")
			{
				this.ShowTutorial("ore", false);
			}
			else if (itemData.m_shared.m_food > 0f || itemData.m_shared.m_foodStamina > 0f)
			{
				this.ShowTutorial("food", false);
			}
			else if (itemData.m_shared.m_itemType == ItemDrop.ItemData.ItemType.Trinket)
			{
				this.ShowTutorial("trinket", false);
			}
		}
		this.UpdateKnownRecipesList();
		this.UpdateAvailablePiecesList();
	}

	// Token: 0x060003F6 RID: 1014 RVA: 0x0000D420 File Offset: 0x0000B620
	public bool InDebugFlyMode()
	{
		return this.m_debugFly;
	}

	// Token: 0x060003F7 RID: 1015 RVA: 0x0000D428 File Offset: 0x0000B628
	public void ShowTutorial(string name, bool force = false)
	{
		if (this.HaveSeenTutorial(name))
		{
			return;
		}
		Tutorial.instance.ShowText(name, force);
	}

	// Token: 0x060003F8 RID: 1016 RVA: 0x0000D440 File Offset: 0x0000B640
	public void SetSeenTutorial(string name)
	{
		if (name.Length == 0)
		{
			return;
		}
		if (this.m_shownTutorials.Contains(name))
		{
			return;
		}
		this.m_shownTutorials.Add(name);
	}

	// Token: 0x060003F9 RID: 1017 RVA: 0x0000D467 File Offset: 0x0000B667
	public bool HaveSeenTutorial(string name)
	{
		return name.Length != 0 && this.m_shownTutorials.Contains(name);
	}

	// Token: 0x060003FA RID: 1018 RVA: 0x0000D47F File Offset: 0x0000B67F
	public static bool IsSeenTutorialsCleared()
	{
		return !Player.m_localPlayer || Player.m_localPlayer.m_shownTutorials.Count == 0;
	}

	// Token: 0x060003FB RID: 1019 RVA: 0x0000D4A1 File Offset: 0x0000B6A1
	public static void ResetSeenTutorials()
	{
		if (Player.m_localPlayer)
		{
			Player.m_localPlayer.m_shownTutorials.Clear();
		}
	}

	// Token: 0x060003FC RID: 1020 RVA: 0x000443A0 File Offset: 0x000425A0
	public void SetMouseLook(Vector2 mouseLook)
	{
		Quaternion quaternion = this.m_lookYaw * Quaternion.Euler(0f, mouseLook.x, 0f);
		if (PlayerCustomizaton.IsBarberGuiVisible())
		{
			if (Vector3.Dot(base.transform.rotation * Vector3.forward, this.m_lookYaw * Vector3.forward) > 0f)
			{
				this.SetMouseLookBackward(true);
			}
			if (Vector3.Dot(base.transform.rotation * Vector3.forward, quaternion * Vector3.forward) < 0f)
			{
				this.m_lookYaw = quaternion;
			}
		}
		else
		{
			this.m_lookYaw = quaternion;
		}
		this.m_lookPitch = Mathf.Clamp(this.m_lookPitch - mouseLook.y, -89f, 89f);
		this.UpdateEyeRotation();
		this.m_lookDir = this.m_eye.forward;
		if (this.m_lookTransitionTime > 0f && mouseLook != Vector2.zero)
		{
			this.m_lookTransitionTime = 0f;
		}
	}

	// Token: 0x060003FD RID: 1021 RVA: 0x000444A8 File Offset: 0x000426A8
	public void SetMouseLookForward(bool includePitch = true)
	{
		this.m_lookYaw = Quaternion.Euler(0f, base.transform.rotation.eulerAngles.y, 0f);
		if (includePitch)
		{
			this.m_lookPitch = 0f;
		}
	}

	// Token: 0x060003FE RID: 1022 RVA: 0x000444F0 File Offset: 0x000426F0
	public void SetMouseLookBackward(bool includePitch = true)
	{
		this.m_lookYaw = Quaternion.Euler(0f, base.transform.rotation.eulerAngles.y + 180f, 0f);
		if (includePitch)
		{
			this.m_lookPitch = 0f;
		}
	}

	// Token: 0x060003FF RID: 1023 RVA: 0x0000D4BE File Offset: 0x0000B6BE
	protected override void UpdateEyeRotation()
	{
		this.m_eye.rotation = this.m_lookYaw * Quaternion.Euler(this.m_lookPitch, 0f, 0f);
	}

	// Token: 0x06000400 RID: 1024 RVA: 0x0000D4EB File Offset: 0x0000B6EB
	public Ragdoll GetRagdoll()
	{
		return this.m_ragdoll;
	}

	// Token: 0x06000401 RID: 1025 RVA: 0x0000D4F3 File Offset: 0x0000B6F3
	public void OnDodgeMortal()
	{
		this.m_dodgeInvincible = false;
	}

	// Token: 0x06000402 RID: 1026 RVA: 0x00044540 File Offset: 0x00042740
	private float GetDodgeStaminaUse()
	{
		float num = this.m_dodgeStaminaUsage - this.m_dodgeStaminaUsage * this.GetEquipmentMovementModifier() + this.m_dodgeStaminaUsage * this.GetEquipmentDodgeStaminaModifier();
		this.m_seman.ModifyDodgeStaminaUsage(num, ref num, true);
		float skillFactor = this.m_skills.GetSkillFactor(Skills.SkillType.Dodge);
		float num2 = Mathf.Lerp(1f, 0.5f, skillFactor);
		num *= num2;
		return num;
	}

	// Token: 0x06000403 RID: 1027 RVA: 0x000445A4 File Offset: 0x000427A4
	private void UpdateDodge(float dt)
	{
		this.m_queuedDodgeTimer -= dt;
		if (this.m_queuedDodgeTimer > 0f && base.IsOnGround() && !this.IsDead() && !this.InAttack() && !this.IsEncumbered() && !this.InDodge() && !base.IsStaggering())
		{
			float dodgeStaminaUse = this.GetDodgeStaminaUse();
			if (this.HaveStamina(dodgeStaminaUse))
			{
				this.ClearActionQueue();
				this.m_queuedDodgeTimer = 0f;
				this.m_dodgeInvincible = true;
				base.transform.rotation = Quaternion.LookRotation(this.m_queuedDodgeDir);
				this.m_body.rotation = base.transform.rotation;
				this.m_zanim.SetTrigger("dodge");
				base.AddNoise(5f);
				this.UseStamina(dodgeStaminaUse);
				this.m_dodgeEffects.Create(base.transform.position, Quaternion.identity, base.transform, 1f, -1);
			}
			else
			{
				Hud.instance.StaminaBarEmptyFlash();
			}
		}
		bool flag = this.m_animator.GetBool(Player.s_animatorTagDodge) || base.GetNextOrCurrentAnimHash() == Player.s_animatorTagDodge;
		bool flag2 = flag && this.m_dodgeInvincible;
		if (this.m_dodgeInvincibleCached != flag2)
		{
			this.m_nview.GetZDO().Set(ZDOVars.s_dodgeinv, flag2);
		}
		this.m_dodgeInvincibleCached = flag2;
		if (!this.m_inDodge)
		{
			this.m_beenHitWhileDodging = false;
		}
		this.m_inDodge = flag;
	}

	// Token: 0x06000404 RID: 1028 RVA: 0x0000D4FC File Offset: 0x0000B6FC
	public override bool IsDodgeInvincible()
	{
		if (!this.m_nview.IsValid())
		{
			return false;
		}
		if (this.m_nview.IsOwner())
		{
			return this.m_dodgeInvincibleCached;
		}
		return this.m_nview.GetZDO().GetBool(ZDOVars.s_dodgeinv, false);
	}

	// Token: 0x06000405 RID: 1029 RVA: 0x0000D537 File Offset: 0x0000B737
	public override bool InDodge()
	{
		return this.m_nview.IsValid() && this.m_nview.IsOwner() && this.m_inDodge;
	}

	// Token: 0x06000406 RID: 1030 RVA: 0x0004472C File Offset: 0x0004292C
	public override bool IsDead()
	{
		ZDO zdo = this.m_nview.GetZDO();
		return zdo != null && zdo.GetBool(ZDOVars.s_dead, false);
	}

	// Token: 0x06000407 RID: 1031 RVA: 0x0000D55B File Offset: 0x0000B75B
	private void Dodge(Vector3 dodgeDir)
	{
		if (this.IsEncumbered())
		{
			return;
		}
		this.m_queuedDodgeTimer = 0.5f;
		this.m_queuedDodgeDir = dodgeDir;
		this.m_skills.RaiseSkill(Skills.SkillType.Dodge, 0.1f);
	}

	// Token: 0x06000408 RID: 1032 RVA: 0x0000D58A File Offset: 0x0000B78A
	public void HitWhileDodging()
	{
		this.m_nview.InvokeRPC("RPC_HitWhileDodging", Array.Empty<object>());
	}

	// Token: 0x06000409 RID: 1033 RVA: 0x00044758 File Offset: 0x00042958
	private void RPC_HitWhileDodging(long sender)
	{
		if (!this.m_nview.IsOwner())
		{
			return;
		}
		if (this.m_beenHitWhileDodging)
		{
			return;
		}
		this.m_beenHitWhileDodging = true;
		this.m_perfectDodgeEffects.Create(base.transform.position, Quaternion.identity, base.transform, 1f, -1);
		float dodgeStaminaUse = this.GetDodgeStaminaUse();
		this.AddStamina(dodgeStaminaUse * this.m_perfectDodgeStaminaReturnMultiplier);
		this.AddAdrenaline(this.m_perfectDodgeAdrenaline);
		this.m_skills.RaiseSkill(Skills.SkillType.Dodge, 1f);
	}

	// Token: 0x0600040A RID: 1034 RVA: 0x000447E0 File Offset: 0x000429E0
	protected override bool AlwaysRotateCamera()
	{
		ItemDrop.ItemData currentWeapon = base.GetCurrentWeapon();
		if ((currentWeapon != null && this.m_currentAttack != null && this.m_lastCombatTimer < 1f && this.m_currentAttack.m_attackType != Attack.AttackType.None && !this.m_attackTowardsPlayerLookDir) || this.IsDrawingBow() || this.m_blocking)
		{
			return true;
		}
		if (currentWeapon != null && currentWeapon.m_shared.m_alwaysRotate && this.m_moveDir.magnitude < 0.01f)
		{
			return true;
		}
		if (this.m_currentAttack != null && this.m_currentAttack.m_loopingAttack && this.InAttack())
		{
			return true;
		}
		if (this.InPlaceMode())
		{
			Vector3 from = base.GetLookYaw() * Vector3.forward;
			Vector3 forward = base.transform.forward;
			if (Vector3.Angle(from, forward) > 95f)
			{
				return true;
			}
		}
		return false;
	}

	// Token: 0x0600040B RID: 1035 RVA: 0x000448AC File Offset: 0x00042AAC
	public override bool TeleportTo(Vector3 pos, Quaternion rot, bool distantTeleport)
	{
		if (!this.m_nview.IsOwner())
		{
			this.m_nview.InvokeRPC("RPC_TeleportTo", new object[]
			{
				pos,
				rot,
				distantTeleport
			});
			return false;
		}
		if (this.IsTeleporting())
		{
			return false;
		}
		if (this.m_teleportCooldown < 2f)
		{
			return false;
		}
		this.m_teleporting = true;
		this.m_distantTeleport = distantTeleport;
		this.m_teleportTimer = 0f;
		this.m_teleportCooldown = 0f;
		base.InvalidateCachedLiquidDepth();
		this.m_teleportFromPos = base.transform.position;
		this.m_teleportFromRot = base.transform.rotation;
		this.m_teleportTargetPos = pos;
		this.m_teleportTargetRot = rot;
		return true;
	}

	// Token: 0x0600040C RID: 1036 RVA: 0x00044970 File Offset: 0x00042B70
	private void UpdateTeleport(float dt)
	{
		if (!this.m_teleporting)
		{
			this.m_teleportCooldown += dt;
			return;
		}
		this.m_teleportCooldown = 0f;
		this.m_teleportTimer += dt;
		if (this.m_teleportTimer > 2f)
		{
			Vector3 dir = this.m_teleportTargetRot * Vector3.forward;
			base.transform.position = this.m_teleportTargetPos;
			base.transform.rotation = this.m_teleportTargetRot;
			this.m_body.linearVelocity = Vector3.zero;
			this.m_maxAirAltitude = base.transform.position.y;
			base.SetLookDir(dir, 0f);
			if ((this.m_teleportTimer > 8f || !this.m_distantTeleport) && ZNetScene.instance.IsAreaReady(this.m_teleportTargetPos))
			{
				float num = 0f;
				if (ZoneSystem.instance.FindFloor(this.m_teleportTargetPos, out num))
				{
					this.m_teleportTimer = 0f;
					this.m_teleporting = false;
					base.ResetCloth();
					return;
				}
				if (this.m_teleportTimer > 15f || !this.m_distantTeleport)
				{
					if (this.m_distantTeleport)
					{
						Vector3 position = base.transform.position;
						position.y = ZoneSystem.instance.GetSolidHeight(this.m_teleportTargetPos) + 0.5f;
						base.transform.position = position;
					}
					else
					{
						base.transform.rotation = this.m_teleportFromRot;
						base.transform.position = this.m_teleportFromPos;
						this.m_maxAirAltitude = base.transform.position.y;
						this.Message(MessageHud.MessageType.Center, "$msg_portal_blocked", 0, null);
					}
					this.m_teleportTimer = 0f;
					this.m_teleporting = false;
					base.ResetCloth();
				}
			}
		}
	}

	// Token: 0x0600040D RID: 1037 RVA: 0x0000D5A1 File Offset: 0x0000B7A1
	public override bool IsTeleporting()
	{
		return this.m_teleporting;
	}

	// Token: 0x0600040E RID: 1038 RVA: 0x0000D5A9 File Offset: 0x0000B7A9
	public bool ShowTeleportAnimation()
	{
		return this.m_teleporting && this.m_distantTeleport;
	}

	// Token: 0x0600040F RID: 1039 RVA: 0x0000D5BB File Offset: 0x0000B7BB
	public void SetPlayerModel(int index)
	{
		if (this.m_modelIndex == index)
		{
			return;
		}
		this.m_modelIndex = index;
		this.m_visEquipment.SetModel(index);
	}

	// Token: 0x06000410 RID: 1040 RVA: 0x0000D5DA File Offset: 0x0000B7DA
	public int GetPlayerModel()
	{
		return this.m_modelIndex;
	}

	// Token: 0x06000411 RID: 1041 RVA: 0x0000D5E2 File Offset: 0x0000B7E2
	public void SetSkinColor(Vector3 color)
	{
		if (color == this.m_skinColor)
		{
			return;
		}
		this.m_skinColor = color;
		this.m_visEquipment.SetSkinColor(this.m_skinColor);
	}

	// Token: 0x06000412 RID: 1042 RVA: 0x0000D60B File Offset: 0x0000B80B
	public void SetHairColor(Vector3 color)
	{
		if (this.m_hairColor == color)
		{
			return;
		}
		this.m_hairColor = color;
		this.m_visEquipment.SetHairColor(this.m_hairColor);
	}

	// Token: 0x06000413 RID: 1043 RVA: 0x0000D634 File Offset: 0x0000B834
	public Vector3 GetHairColor()
	{
		return this.m_hairColor;
	}

	// Token: 0x06000414 RID: 1044 RVA: 0x0000D63C File Offset: 0x0000B83C
	protected override void SetupVisEquipment(VisEquipment visEq, bool isRagdoll)
	{
		base.SetupVisEquipment(visEq, isRagdoll);
		visEq.SetModel(this.m_modelIndex);
		visEq.SetSkinColor(this.m_skinColor);
		visEq.SetHairColor(this.m_hairColor);
	}

	// Token: 0x06000415 RID: 1045 RVA: 0x00044B38 File Offset: 0x00042D38
	public override bool CanConsumeItem(ItemDrop.ItemData item, bool checkWorldLevel = false)
	{
		if (!base.CanConsumeItem(item, checkWorldLevel))
		{
			return false;
		}
		if (item.m_shared.m_food > 0f && !this.CanEat(item, true))
		{
			return false;
		}
		if (item.m_shared.m_consumeStatusEffect)
		{
			StatusEffect consumeStatusEffect = item.m_shared.m_consumeStatusEffect;
			if (this.m_seman.HaveStatusEffect(item.m_shared.m_consumeStatusEffect.NameHash()) || this.m_seman.HaveStatusEffectCategory(consumeStatusEffect.m_category))
			{
				this.Message(MessageHud.MessageType.Center, "$msg_cantconsume", 0, null);
				return false;
			}
		}
		return true;
	}

	// Token: 0x06000416 RID: 1046 RVA: 0x00044BD0 File Offset: 0x00042DD0
	public override bool ConsumeItem(Inventory inventory, ItemDrop.ItemData item, bool checkWorldLevel = false)
	{
		if (!this.CanConsumeItem(item, checkWorldLevel))
		{
			return false;
		}
		if (item.m_shared.m_consumeStatusEffect)
		{
			StatusEffect consumeStatusEffect = item.m_shared.m_consumeStatusEffect;
			this.m_seman.AddStatusEffect(item.m_shared.m_consumeStatusEffect, true, 0, 0f);
		}
		if (item.m_shared.m_food > 0f)
		{
			this.EatFood(item);
		}
		inventory.RemoveOneItem(item);
		return true;
	}

	// Token: 0x06000417 RID: 1047 RVA: 0x0000D66A File Offset: 0x0000B86A
	public void SetIntro(bool intro)
	{
		if (this.m_intro == intro)
		{
			return;
		}
		this.m_intro = intro;
		this.m_zanim.SetBool("intro", intro);
	}

	// Token: 0x06000418 RID: 1048 RVA: 0x0000D68E File Offset: 0x0000B88E
	public override bool InIntro()
	{
		return this.m_intro;
	}

	// Token: 0x06000419 RID: 1049 RVA: 0x0000D696 File Offset: 0x0000B896
	public override bool InCutscene()
	{
		return base.GetCurrentAnimHash() == Player.s_animatorTagCutscene || this.InIntro() || this.m_sleeping || base.InCutscene();
	}

	// Token: 0x0600041A RID: 1050 RVA: 0x00044C48 File Offset: 0x00042E48
	public void SetMaxStamina(float stamina, bool flashBar)
	{
		if (flashBar && Hud.instance != null && stamina > this.m_maxStamina)
		{
			Hud.instance.StaminaBarUppgradeFlash();
		}
		this.m_maxStamina = stamina;
		this.m_stamina = Mathf.Clamp(this.m_stamina, 0f, this.m_maxStamina);
	}

	// Token: 0x0600041B RID: 1051 RVA: 0x00044C9C File Offset: 0x00042E9C
	private void SetMaxEitr(float eitr, bool flashBar)
	{
		if (flashBar && Hud.instance != null && eitr > this.m_maxEitr)
		{
			Hud.instance.EitrBarUppgradeFlash();
		}
		this.m_maxEitr = eitr;
		this.m_eitr = Mathf.Clamp(this.m_eitr, 0f, this.m_maxEitr);
	}

	// Token: 0x0600041C RID: 1052 RVA: 0x0000D6C1 File Offset: 0x0000B8C1
	public void SetMaxHealth(float health, bool flashBar)
	{
		if (flashBar && Hud.instance != null && health > base.GetMaxHealth())
		{
			Hud.instance.FlashHealthBar();
		}
		base.SetMaxHealth(health);
	}

	// Token: 0x0600041D RID: 1053 RVA: 0x0000D6ED File Offset: 0x0000B8ED
	public override bool IsPVPEnabled()
	{
		if (!this.m_nview.IsValid())
		{
			return false;
		}
		if (this.m_nview.IsOwner())
		{
			return this.m_pvp;
		}
		return this.m_nview.GetZDO().GetBool(ZDOVars.s_pvp, false);
	}

	// Token: 0x0600041E RID: 1054 RVA: 0x00044CF0 File Offset: 0x00042EF0
	public void SetPVP(bool enabled)
	{
		if (this.m_pvp == enabled)
		{
			return;
		}
		this.m_pvp = enabled;
		this.m_nview.GetZDO().Set(ZDOVars.s_pvp, this.m_pvp);
		if (this.m_pvp)
		{
			this.Message(MessageHud.MessageType.Center, "$msg_pvpon", 0, null);
			return;
		}
		this.Message(MessageHud.MessageType.Center, "$msg_pvpoff", 0, null);
	}

	// Token: 0x0600041F RID: 1055 RVA: 0x0000D728 File Offset: 0x0000B928
	public bool CanSwitchPVP()
	{
		return this.m_lastCombatTimer > 10f;
	}

	// Token: 0x06000420 RID: 1056 RVA: 0x0000D737 File Offset: 0x0000B937
	public bool NoCostCheat()
	{
		return this.m_noPlacementCost;
	}

	// Token: 0x06000421 RID: 1057 RVA: 0x00044D50 File Offset: 0x00042F50
	public bool StartEmote(string emote, bool oneshot = true)
	{
		if (!this.CanMove() || this.InAttack() || this.IsDrawingBow() || this.IsAttached() || this.IsAttachedToShip())
		{
			return false;
		}
		this.SetCrouch(false);
		int @int = this.m_nview.GetZDO().GetInt(ZDOVars.s_emoteID, 0);
		this.m_nview.GetZDO().Set(ZDOVars.s_emoteID, @int + 1, false);
		this.m_nview.GetZDO().Set(ZDOVars.s_emote, emote);
		this.m_nview.GetZDO().Set(ZDOVars.s_emoteOneshot, oneshot);
		Player.LastEmote = emote;
		Player.LastEmoteTime = DateTime.Now;
		return true;
	}

	// Token: 0x06000422 RID: 1058 RVA: 0x00044DFC File Offset: 0x00042FFC
	protected override void StopEmote()
	{
		if (this.m_nview.GetZDO().GetString(ZDOVars.s_emote, "") != "")
		{
			int @int = this.m_nview.GetZDO().GetInt(ZDOVars.s_emoteID, 0);
			this.m_nview.GetZDO().Set(ZDOVars.s_emoteID, @int + 1, false);
			this.m_nview.GetZDO().Set(ZDOVars.s_emote, "");
		}
	}

	// Token: 0x06000423 RID: 1059 RVA: 0x00044E7C File Offset: 0x0004307C
	private void UpdateEmote()
	{
		if (this.m_nview.IsOwner() && this.InEmote() && this.m_moveDir != Vector3.zero)
		{
			this.StopEmote();
		}
		int @int = this.m_nview.GetZDO().GetInt(ZDOVars.s_emoteID, 0);
		if (@int != this.m_emoteID)
		{
			this.m_emoteID = @int;
			if (!string.IsNullOrEmpty(this.m_emoteState))
			{
				this.m_animator.SetBool("emote_" + this.m_emoteState, false);
			}
			this.m_emoteState = "";
			this.m_animator.SetTrigger("emote_stop");
			string @string = this.m_nview.GetZDO().GetString(ZDOVars.s_emote, "");
			if (!string.IsNullOrEmpty(@string))
			{
				bool @bool = this.m_nview.GetZDO().GetBool(ZDOVars.s_emoteOneshot, false);
				this.m_animator.ResetTrigger("emote_stop");
				if (@bool)
				{
					this.m_animator.SetTrigger("emote_" + @string);
					return;
				}
				this.m_emoteState = @string;
				this.m_animator.SetBool("emote_" + @string, true);
			}
		}
	}

	// Token: 0x06000424 RID: 1060 RVA: 0x0000D73F File Offset: 0x0000B93F
	public override bool InEmote()
	{
		return !string.IsNullOrEmpty(this.m_emoteState) || base.GetCurrentAnimHash() == Player.s_animatorTagEmote;
	}

	// Token: 0x06000425 RID: 1061 RVA: 0x0000D75D File Offset: 0x0000B95D
	public override bool IsCrouching()
	{
		return base.GetCurrentAnimHash() == Player.s_animatorTagCrouch;
	}

	// Token: 0x06000426 RID: 1062 RVA: 0x00044FA4 File Offset: 0x000431A4
	private void UpdateCrouch(float dt)
	{
		if (this.m_crouchToggled)
		{
			if (!this.HaveStamina(0f) || base.IsSwimming() || this.InBed() || this.InPlaceMode() || this.m_run || this.IsBlocking() || base.IsFlying())
			{
				this.SetCrouch(false);
			}
			bool flag = this.InAttack() || this.IsDrawingBow();
			this.m_zanim.SetBool(Player.s_crouching, this.m_crouchToggled && !flag);
			return;
		}
		this.m_zanim.SetBool(Player.s_crouching, false);
	}

	// Token: 0x06000427 RID: 1063 RVA: 0x0000D76C File Offset: 0x0000B96C
	protected override void SetCrouch(bool crouch)
	{
		this.m_crouchToggled = crouch;
	}

	// Token: 0x06000428 RID: 1064 RVA: 0x00045040 File Offset: 0x00043240
	public void SetGuardianPower(string name)
	{
		this.m_guardianPower = name;
		this.m_guardianPowerHash = (string.IsNullOrEmpty(name) ? 0 : name.GetStableHashCode());
		this.m_guardianSE = ObjectDB.instance.GetStatusEffect(this.m_guardianPowerHash);
		if (ZoneSystem.instance)
		{
			this.AddUniqueKey(name);
		}
	}

	// Token: 0x06000429 RID: 1065 RVA: 0x0000D775 File Offset: 0x0000B975
	public string GetGuardianPowerName()
	{
		return this.m_guardianPower;
	}

	// Token: 0x0600042A RID: 1066 RVA: 0x0000D77D File Offset: 0x0000B97D
	public void GetGuardianPowerHUD(out StatusEffect se, out float cooldown)
	{
		se = this.m_guardianSE;
		cooldown = this.m_guardianPowerCooldown;
	}

	// Token: 0x0600042B RID: 1067 RVA: 0x00045094 File Offset: 0x00043294
	public bool StartGuardianPower()
	{
		if (this.m_guardianSE == null)
		{
			return false;
		}
		if ((this.InAttack() && !this.HaveQueuedChain()) || this.InDodge() || !this.CanMove() || base.IsKnockedBack() || base.IsStaggering() || this.InMinorAction())
		{
			return false;
		}
		if (this.m_guardianPowerCooldown > 0f)
		{
			this.Message(MessageHud.MessageType.Center, "$hud_powernotready", 0, null);
			return false;
		}
		this.m_zanim.SetTrigger("gpower");
		Game.instance.IncrementPlayerStat(PlayerStatType.UseGuardianPower, 1f);
		string prefabName = global::Utils.GetPrefabName(this.m_guardianSE.name);
		uint num = <PrivateImplementationDetails>.ComputeStringHash(prefabName);
		if (num <= 2474185561U)
		{
			if (num <= 2006288425U)
			{
				if (num != 1427920915U)
				{
					if (num == 2006288425U)
					{
						if (prefabName == "GP_Bonemass")
						{
							Game.instance.IncrementPlayerStat(PlayerStatType.UsePowerBonemass, 1f);
							return true;
						}
					}
				}
				else if (prefabName == "GP_Queen")
				{
					Game.instance.IncrementPlayerStat(PlayerStatType.UsePowerQueen, 1f);
					return true;
				}
			}
			else if (num != 2142994390U)
			{
				if (num == 2474185561U)
				{
					if (prefabName == "GP_Yagluth")
					{
						Game.instance.IncrementPlayerStat(PlayerStatType.UsePowerYagluth, 1f);
						return true;
					}
				}
			}
			else if (prefabName == "GP_Moder")
			{
				Game.instance.IncrementPlayerStat(PlayerStatType.UsePowerModer, 1f);
				return true;
			}
		}
		else if (num <= 3121473449U)
		{
			if (num != 2548002664U)
			{
				if (num == 3121473449U)
				{
					if (prefabName == "GP_Ashlands")
					{
						Game.instance.IncrementPlayerStat(PlayerStatType.UsePowerAshlands, 1f);
						return true;
					}
				}
			}
			else if (prefabName == "GP_DeepNorth")
			{
				Game.instance.IncrementPlayerStat(PlayerStatType.UsePowerDeepNorth, 1f);
				return true;
			}
		}
		else if (num != 3360619182U)
		{
			if (num == 3839426325U)
			{
				if (prefabName == "GP_Eikthyr")
				{
					Game.instance.IncrementPlayerStat(PlayerStatType.UsePowerEikthyr, 1f);
					return true;
				}
			}
		}
		else if (prefabName == "GP_TheElder")
		{
			Game.instance.IncrementPlayerStat(PlayerStatType.UsePowerElder, 1f);
			return true;
		}
		ZLog.LogWarning("Missing stat for guardian power: " + prefabName);
		return true;
	}

	// Token: 0x0600042C RID: 1068 RVA: 0x00045314 File Offset: 0x00043514
	public bool ActivateGuardianPower()
	{
		if (this.m_guardianPowerCooldown > 0f)
		{
			return false;
		}
		if (this.m_guardianSE == null)
		{
			return false;
		}
		List<Player> list = new List<Player>();
		Player.GetPlayersInRange(base.transform.position, 10f, list);
		foreach (Player player in list)
		{
			player.GetSEMan().AddStatusEffect(this.m_guardianSE.NameHash(), true, 0, 0f);
		}
		if (this.m_adrenalineGuardianPower != 0f)
		{
			this.AddAdrenaline(this.m_adrenalineGuardianPower);
		}
		this.m_guardianPowerCooldown = this.m_guardianSE.m_cooldown;
		return false;
	}

	// Token: 0x0600042D RID: 1069 RVA: 0x0000D78F File Offset: 0x0000B98F
	private void UpdateGuardianPower(float dt)
	{
		this.m_guardianPowerCooldown -= dt;
		if (this.m_guardianPowerCooldown < 0f)
		{
			this.m_guardianPowerCooldown = 0f;
		}
	}

	// Token: 0x0600042E RID: 1070 RVA: 0x000453E0 File Offset: 0x000435E0
	public override void AttachStart(Transform attachPoint, GameObject colliderRoot, bool hideWeapons, bool isBed, bool onShip, string attachAnimation, Vector3 detachOffset, Transform cameraPos = null)
	{
		if (this.m_attached)
		{
			return;
		}
		this.m_attached = true;
		this.m_attachedToShip = onShip;
		this.m_attachPoint = attachPoint;
		this.m_detachOffset = detachOffset;
		this.m_attachAnimation = attachAnimation;
		this.m_attachPointCamera = cameraPos;
		this.m_zanim.SetBool(attachAnimation, true);
		this.m_nview.GetZDO().Set(ZDOVars.s_inBed, isBed);
		if (colliderRoot != null)
		{
			this.m_attachColliders = colliderRoot.GetComponentsInChildren<Collider>();
			ZLog.Log("Ignoring " + this.m_attachColliders.Length.ToString() + " colliders");
			foreach (Collider collider in this.m_attachColliders)
			{
				Physics.IgnoreCollision(this.m_collider, collider, true);
			}
		}
		if (hideWeapons)
		{
			base.HideHandItems(false, true);
		}
		this.UpdateAttach();
		base.ResetCloth();
	}

	// Token: 0x0600042F RID: 1071 RVA: 0x000454C0 File Offset: 0x000436C0
	private void UpdateAttach()
	{
		if (this.m_attached)
		{
			if (this.m_attachPoint != null)
			{
				base.transform.position = this.m_attachPoint.position;
				base.transform.rotation = this.m_attachPoint.rotation;
				Rigidbody componentInParent = this.m_attachPoint.GetComponentInParent<Rigidbody>();
				this.m_body.useGravity = false;
				this.m_body.linearVelocity = (componentInParent ? componentInParent.GetPointVelocity(base.transform.position) : Vector3.zero);
				this.m_body.angularVelocity = Vector3.zero;
				this.m_maxAirAltitude = base.transform.position.y;
				return;
			}
			this.AttachStop();
		}
	}

	// Token: 0x06000430 RID: 1072 RVA: 0x0000D7B7 File Offset: 0x0000B9B7
	public override bool IsAttached()
	{
		return this.m_attached || base.IsAttached();
	}

	// Token: 0x06000431 RID: 1073 RVA: 0x0000D7C9 File Offset: 0x0000B9C9
	public Transform GetAttachPoint()
	{
		return this.m_attachPoint;
	}

	// Token: 0x06000432 RID: 1074 RVA: 0x0000D7D1 File Offset: 0x0000B9D1
	public Transform GetAttachCameraPoint()
	{
		return this.m_attachPointCamera;
	}

	// Token: 0x06000433 RID: 1075 RVA: 0x0000D7D9 File Offset: 0x0000B9D9
	public void ResetAttachCameraPoint()
	{
		this.m_attachPointCamera = null;
	}

	// Token: 0x06000434 RID: 1076 RVA: 0x0000D7E2 File Offset: 0x0000B9E2
	public override bool IsAttachedToShip()
	{
		return this.m_attached && this.m_attachedToShip;
	}

	// Token: 0x06000435 RID: 1077 RVA: 0x0000D7F4 File Offset: 0x0000B9F4
	public override bool IsRiding()
	{
		return this.m_doodadController != null && this.m_doodadController.IsValid() && this.m_doodadController is Sadle;
	}

	// Token: 0x06000436 RID: 1078 RVA: 0x0000D81B File Offset: 0x0000BA1B
	public override bool InBed()
	{
		return this.m_nview.IsValid() && this.m_nview.GetZDO().GetBool(ZDOVars.s_inBed, false);
	}

	// Token: 0x06000437 RID: 1079 RVA: 0x00045588 File Offset: 0x00043788
	public override void AttachStop()
	{
		if (this.m_sleeping)
		{
			return;
		}
		if (this.m_attached)
		{
			if (this.m_attachPoint != null)
			{
				base.transform.position = this.m_attachPoint.TransformPoint(this.m_detachOffset);
			}
			if (this.m_attachColliders != null)
			{
				foreach (Collider collider in this.m_attachColliders)
				{
					if (collider)
					{
						Physics.IgnoreCollision(this.m_collider, collider, false);
					}
				}
				this.m_attachColliders = null;
			}
			this.m_body.useGravity = true;
			this.m_attached = false;
			this.m_attachPoint = null;
			this.m_attachPointCamera = null;
			this.m_zanim.SetBool(this.m_attachAnimation, false);
			this.m_nview.GetZDO().Set(ZDOVars.s_inBed, false);
			base.ResetCloth();
		}
	}

	// Token: 0x06000438 RID: 1080 RVA: 0x0000D842 File Offset: 0x0000BA42
	public void StartDoodadControl(IDoodadController shipControl)
	{
		this.m_doodadController = shipControl;
		ZLog.Log("Doodad controlls set " + shipControl.GetControlledComponent().gameObject.name);
	}

	// Token: 0x06000439 RID: 1081 RVA: 0x0000D86A File Offset: 0x0000BA6A
	public void StopDoodadControl()
	{
		if (this.m_doodadController != null)
		{
			if (this.m_doodadController.IsValid())
			{
				this.m_doodadController.OnUseStop(this);
			}
			ZLog.Log("Stop doodad controlls");
			this.m_doodadController = null;
		}
	}

	// Token: 0x0600043A RID: 1082 RVA: 0x0000D89E File Offset: 0x0000BA9E
	private void SetDoodadControlls(ref Vector3 moveDir, ref Vector3 lookDir, ref bool run, ref bool autoRun, bool block)
	{
		if (this.m_doodadController.IsValid())
		{
			this.m_doodadController.ApplyControlls(moveDir, lookDir, run, autoRun, block);
		}
		moveDir = Vector3.zero;
		autoRun = false;
		run = false;
	}

	// Token: 0x0600043B RID: 1083 RVA: 0x0000D8DD File Offset: 0x0000BADD
	public Ship GetControlledShip()
	{
		if (this.m_doodadController != null && this.m_doodadController.IsValid())
		{
			return this.m_doodadController.GetControlledComponent() as Ship;
		}
		return null;
	}

	// Token: 0x0600043C RID: 1084 RVA: 0x0000D906 File Offset: 0x0000BB06
	public IDoodadController GetDoodadController()
	{
		return this.m_doodadController;
	}

	// Token: 0x0600043D RID: 1085 RVA: 0x00045660 File Offset: 0x00043860
	private void UpdateDoodadControls(float dt)
	{
		if (this.m_doodadController == null)
		{
			return;
		}
		if (!this.m_doodadController.IsValid())
		{
			this.StopDoodadControl();
			return;
		}
		Vector3 forward = this.m_doodadController.GetControlledComponent().transform.forward;
		forward.y = 0f;
		forward.Normalize();
		Quaternion to = Quaternion.LookRotation(forward);
		base.transform.rotation = Quaternion.RotateTowards(base.transform.rotation, to, 100f * dt);
		if (Vector3.Distance(this.m_doodadController.GetPosition(), base.transform.position) > this.m_maxInteractDistance)
		{
			this.StopDoodadControl();
		}
	}

	// Token: 0x0600043E RID: 1086 RVA: 0x0000D90E File Offset: 0x0000BB0E
	public bool IsSleeping()
	{
		return this.m_sleeping;
	}

	// Token: 0x0600043F RID: 1087 RVA: 0x00045708 File Offset: 0x00043908
	public void SetSleeping(bool sleep)
	{
		if (this.m_sleeping == sleep)
		{
			return;
		}
		this.m_sleeping = sleep;
		if (!sleep)
		{
			this.Message(MessageHud.MessageType.Center, "$msg_goodmorning", 0, null);
			this.m_seman.AddStatusEffect(SEMan.s_statusEffectRested, true, 0, 0f);
			this.m_wakeupTime = ZNet.instance.GetTimeSeconds();
			Game.instance.IncrementPlayerStat(PlayerStatType.Sleep, 1f);
		}
	}

	// Token: 0x06000440 RID: 1088 RVA: 0x00045770 File Offset: 0x00043970
	public void SetControls(Vector3 movedir, bool attack, bool attackHold, bool secondaryAttack, bool secondaryAttackHold, bool block, bool blockHold, bool jump, bool crouch, bool run, bool autoRun, bool dodge = false)
	{
		if ((this.IsAttached() || this.InEmote()) && (movedir != Vector3.zero || attack || secondaryAttack || block || blockHold || jump || crouch) && this.GetDoodadController() == null)
		{
			attack = false;
			attackHold = false;
			secondaryAttack = false;
			secondaryAttackHold = false;
			this.StopEmote();
			this.AttachStop();
		}
		if (this.m_doodadController != null)
		{
			this.SetDoodadControlls(ref movedir, ref this.m_lookDir, ref run, ref autoRun, blockHold);
			if (jump || attack || secondaryAttack || dodge)
			{
				attack = false;
				attackHold = false;
				secondaryAttack = false;
				secondaryAttackHold = false;
				this.StopDoodadControl();
			}
		}
		if (run)
		{
			this.m_walk = false;
		}
		if (!this.m_autoRun)
		{
			Vector3 lookDir = this.m_lookDir;
			lookDir.y = 0f;
			lookDir.Normalize();
			this.m_moveDir = movedir.z * lookDir + movedir.x * Vector3.Cross(Vector3.up, lookDir);
		}
		if (!this.m_autoRun && autoRun && !this.InPlaceMode())
		{
			this.m_autoRun = true;
			this.SetCrouch(false);
			this.m_moveDir = this.m_lookDir;
			this.m_moveDir.y = 0f;
			this.m_moveDir.Normalize();
		}
		else if (this.m_autoRun)
		{
			if (attack || jump || dodge || crouch || movedir != Vector3.zero || this.InPlaceMode() || attackHold || secondaryAttackHold)
			{
				this.m_autoRun = false;
			}
			else if (autoRun || blockHold)
			{
				this.m_moveDir = this.m_lookDir;
				this.m_moveDir.y = 0f;
				this.m_moveDir.Normalize();
				blockHold = false;
				block = false;
			}
		}
		this.m_attack = attack;
		this.m_attackHold = attackHold;
		this.m_secondaryAttack = secondaryAttack;
		this.m_secondaryAttackHold = secondaryAttackHold;
		this.m_blocking = blockHold;
		this.m_run = run;
		if (crouch)
		{
			this.SetCrouch(!this.m_crouchToggled);
		}
		if (ZInput.InputLayout == InputLayout.Default || !ZInput.IsGamepadActive())
		{
			if (jump)
			{
				if (this.m_blocking)
				{
					Vector3 dodgeDir = this.m_moveDir;
					if (dodgeDir.magnitude < 0.1f)
					{
						dodgeDir = -this.m_lookDir;
						dodgeDir.y = 0f;
						dodgeDir.Normalize();
					}
					this.Dodge(dodgeDir);
					return;
				}
				if (this.IsCrouching() || this.m_crouchToggled)
				{
					Vector3 dodgeDir2 = this.m_moveDir;
					if (dodgeDir2.magnitude < 0.1f)
					{
						dodgeDir2 = this.m_lookDir;
						dodgeDir2.y = 0f;
						dodgeDir2.Normalize();
					}
					this.Dodge(dodgeDir2);
					return;
				}
				base.Jump(false);
				return;
			}
		}
		else if (ZInput.IsNonClassicFunctionality())
		{
			if (dodge)
			{
				if (this.m_blocking)
				{
					Vector3 dodgeDir3 = this.m_moveDir;
					if (dodgeDir3.magnitude < 0.1f)
					{
						dodgeDir3 = -this.m_lookDir;
						dodgeDir3.y = 0f;
						dodgeDir3.Normalize();
					}
					this.Dodge(dodgeDir3);
				}
				else if (this.IsCrouching() || this.m_crouchToggled)
				{
					Vector3 dodgeDir4 = this.m_moveDir;
					if (dodgeDir4.magnitude < 0.1f)
					{
						dodgeDir4 = this.m_lookDir;
						dodgeDir4.y = 0f;
						dodgeDir4.Normalize();
					}
					this.Dodge(dodgeDir4);
				}
			}
			if (jump)
			{
				base.Jump(false);
			}
		}
	}

	// Token: 0x06000441 RID: 1089 RVA: 0x0000D916 File Offset: 0x0000BB16
	private void UpdateTargeted(float dt)
	{
		this.m_timeSinceTargeted += dt;
		this.m_timeSinceSensed += dt;
	}

	// Token: 0x06000442 RID: 1090 RVA: 0x00045AB0 File Offset: 0x00043CB0
	public override void OnTargeted(bool sensed, bool alerted)
	{
		if (sensed)
		{
			if (this.m_timeSinceSensed > 0.5f)
			{
				this.m_timeSinceSensed = 0f;
				this.m_nview.InvokeRPC("OnTargeted", new object[]
				{
					sensed,
					alerted
				});
				return;
			}
		}
		else if (this.m_timeSinceTargeted > 0.5f)
		{
			this.m_timeSinceTargeted = 0f;
			this.m_nview.InvokeRPC("OnTargeted", new object[]
			{
				sensed,
				alerted
			});
		}
	}

	// Token: 0x06000443 RID: 1091 RVA: 0x0000D934 File Offset: 0x0000BB34
	private void RPC_OnTargeted(long sender, bool sensed, bool alerted)
	{
		this.m_timeSinceTargeted = 0f;
		if (sensed)
		{
			this.m_timeSinceSensed = 0f;
		}
		if (alerted)
		{
			MusicMan.instance.ResetCombatTimer();
		}
	}

	// Token: 0x06000444 RID: 1092 RVA: 0x0000D95C File Offset: 0x0000BB5C
	protected override void OnDamaged(HitData hit)
	{
		base.OnDamaged(hit);
		if (hit.GetTotalDamage() > base.GetMaxHealth() / 10f)
		{
			Hud.instance.DamageFlash();
		}
	}

	// Token: 0x06000445 RID: 1093 RVA: 0x0000D983 File Offset: 0x0000BB83
	public bool IsTargeted()
	{
		return this.m_timeSinceTargeted < 1f;
	}

	// Token: 0x06000446 RID: 1094 RVA: 0x0000D992 File Offset: 0x0000BB92
	public bool IsSensed()
	{
		return this.m_timeSinceSensed < 1f;
	}

	// Token: 0x06000447 RID: 1095 RVA: 0x00045B44 File Offset: 0x00043D44
	protected override void ApplyArmorDamageMods(ref HitData.DamageModifiers mods)
	{
		if (this.m_chestItem != null)
		{
			mods.Apply(this.m_chestItem.m_shared.m_damageModifiers);
		}
		if (this.m_legItem != null)
		{
			mods.Apply(this.m_legItem.m_shared.m_damageModifiers);
		}
		if (this.m_helmetItem != null)
		{
			mods.Apply(this.m_helmetItem.m_shared.m_damageModifiers);
		}
		if (this.m_shoulderItem != null)
		{
			mods.Apply(this.m_shoulderItem.m_shared.m_damageModifiers);
		}
	}

	// Token: 0x06000448 RID: 1096 RVA: 0x00045BCC File Offset: 0x00043DCC
	public override float GetBodyArmor()
	{
		float num = 0f;
		if (this.m_chestItem != null)
		{
			num += this.m_chestItem.GetArmor();
		}
		if (this.m_legItem != null)
		{
			num += this.m_legItem.GetArmor();
		}
		if (this.m_helmetItem != null)
		{
			num += this.m_helmetItem.GetArmor();
		}
		if (this.m_shoulderItem != null)
		{
			num += this.m_shoulderItem.GetArmor();
		}
		this.m_seman.ApplyArmorMods(ref num);
		return num;
	}

	// Token: 0x06000449 RID: 1097 RVA: 0x00045C48 File Offset: 0x00043E48
	public bool TryGetArmorDifference(ItemDrop.ItemData item, out float difference)
	{
		ItemDrop.ItemData.ItemType itemType = item.m_shared.m_itemType;
		if (itemType <= ItemDrop.ItemData.ItemType.Chest)
		{
			if (itemType == ItemDrop.ItemData.ItemType.Helmet)
			{
				if (this.m_helmetItem == null)
				{
					difference = item.m_shared.m_armor;
				}
				else if (item == this.m_helmetItem)
				{
					difference = 0f - item.m_shared.m_armor;
				}
				else
				{
					difference = this.GetBodyArmor() - this.m_helmetItem.m_shared.m_armor + item.m_shared.m_armor - this.GetBodyArmor();
				}
				return true;
			}
			if (itemType == ItemDrop.ItemData.ItemType.Chest)
			{
				if (this.m_chestItem == null)
				{
					difference = item.m_shared.m_armor;
				}
				else if (item == this.m_chestItem)
				{
					difference = 0f - item.m_shared.m_armor;
				}
				else
				{
					difference = this.GetBodyArmor() - this.m_chestItem.m_shared.m_armor + item.m_shared.m_armor - this.GetBodyArmor();
				}
				return true;
			}
		}
		else
		{
			if (itemType == ItemDrop.ItemData.ItemType.Legs)
			{
				if (this.m_legItem == null)
				{
					difference = item.m_shared.m_armor;
				}
				else if (item == this.m_legItem)
				{
					difference = 0f - item.m_shared.m_armor;
				}
				else
				{
					difference = this.GetBodyArmor() - this.m_legItem.m_shared.m_armor + item.m_shared.m_armor - this.GetBodyArmor();
				}
				return true;
			}
			if (itemType == ItemDrop.ItemData.ItemType.Shoulder)
			{
				if (this.m_shoulderItem == null)
				{
					difference = item.m_shared.m_armor;
				}
				else if (item == this.m_shoulderItem)
				{
					difference = 0f - item.m_shared.m_armor;
				}
				else
				{
					difference = this.GetBodyArmor() - this.m_shoulderItem.m_shared.m_armor + item.m_shared.m_armor - this.GetBodyArmor();
				}
				return true;
			}
		}
		difference = 0f;
		return false;
	}

	// Token: 0x0600044A RID: 1098 RVA: 0x00045E1C File Offset: 0x0004401C
	protected override void OnSneaking(float dt)
	{
		float t = Mathf.Pow(this.m_skills.GetSkillFactor(Skills.SkillType.Sneak), 0.5f);
		float num = Mathf.Lerp(1f, 0.25f, t);
		float num2 = dt * this.m_sneakStaminaDrain * num;
		num2 += num2 * this.GetEquipmentSneakStaminaModifier();
		this.m_seman.ModifySneakStaminaUsage(num2, ref num2, true);
		this.UseStamina(num2);
		if (!this.HaveStamina(0f))
		{
			Hud.instance.StaminaBarEmptyFlash();
		}
		this.m_sneakSkillImproveTimer += dt;
		if (this.m_sneakSkillImproveTimer > 1f)
		{
			this.m_sneakSkillImproveTimer = 0f;
			if (BaseAI.InStealthRange(this))
			{
				this.RaiseSkill(Skills.SkillType.Sneak, 1f);
				return;
			}
			this.RaiseSkill(Skills.SkillType.Sneak, 0.1f);
		}
	}

	// Token: 0x0600044B RID: 1099 RVA: 0x00045EE0 File Offset: 0x000440E0
	private void UpdateStealth(float dt)
	{
		this.m_stealthFactorUpdateTimer += dt;
		if (this.m_stealthFactorUpdateTimer > 0.5f)
		{
			this.m_stealthFactorUpdateTimer = 0f;
			this.m_stealthFactorTarget = 0f;
			if (this.IsCrouching())
			{
				this.m_lastStealthPosition = base.transform.position;
				float skillFactor = this.m_skills.GetSkillFactor(Skills.SkillType.Sneak);
				float lightFactor = StealthSystem.instance.GetLightFactor(base.GetCenterPoint());
				this.m_stealthFactorTarget = Mathf.Lerp(0.5f + lightFactor * 0.5f, 0.2f + lightFactor * 0.4f, skillFactor);
				this.m_stealthFactorTarget = Mathf.Clamp01(this.m_stealthFactorTarget);
				this.m_seman.ModifyStealth(this.m_stealthFactorTarget, ref this.m_stealthFactorTarget);
				this.m_stealthFactorTarget = Mathf.Clamp01(this.m_stealthFactorTarget);
			}
			else
			{
				this.m_stealthFactorTarget = 1f;
			}
		}
		float num = Mathf.MoveTowards(this.m_stealthFactor, this.m_stealthFactorTarget, dt / 4f);
		if (!this.m_stealthFactor.Equals(num))
		{
			this.m_nview.GetZDO().Set(ZDOVars.s_stealth, num);
		}
		this.m_stealthFactor = num;
	}

	// Token: 0x0600044C RID: 1100 RVA: 0x0004600C File Offset: 0x0004420C
	public override float GetStealthFactor()
	{
		if (!this.m_nview.IsValid())
		{
			return 0f;
		}
		if (this.m_nview.IsOwner())
		{
			return this.m_stealthFactor;
		}
		return this.m_nview.GetZDO().GetFloat(ZDOVars.s_stealth, 0f);
	}

	// Token: 0x0600044D RID: 1101 RVA: 0x0004605C File Offset: 0x0004425C
	public override bool InAttack()
	{
		if (MonoUpdaters.UpdateCount == this.m_cachedFrame)
		{
			return this.m_cachedAttack;
		}
		this.m_cachedFrame = MonoUpdaters.UpdateCount;
		if (base.GetNextOrCurrentAnimHash() == Humanoid.s_animatorTagAttack)
		{
			this.m_cachedAttack = true;
			return true;
		}
		for (int i = 1; i < this.m_animator.layerCount; i++)
		{
			if ((this.m_animator.IsInTransition(i) ? this.m_animator.GetNextAnimatorStateInfo(i).tagHash : this.m_animator.GetCurrentAnimatorStateInfo(i).tagHash) == Humanoid.s_animatorTagAttack)
			{
				this.m_cachedAttack = true;
				return true;
			}
		}
		this.m_cachedAttack = false;
		return false;
	}

	// Token: 0x0600044E RID: 1102 RVA: 0x0000D9A1 File Offset: 0x0000BBA1
	private float GetEquipmentModifier(int index)
	{
		if (this.m_equipmentModifierValues != null)
		{
			return this.m_equipmentModifierValues[index];
		}
		return 0f;
	}

	// Token: 0x0600044F RID: 1103 RVA: 0x0000D9B9 File Offset: 0x0000BBB9
	public override float GetEquipmentMovementModifier()
	{
		return this.GetEquipmentModifier(0);
	}

	// Token: 0x06000450 RID: 1104 RVA: 0x0000D9C2 File Offset: 0x0000BBC2
	public override float GetEquipmentHomeItemModifier()
	{
		return this.GetEquipmentModifier(1);
	}

	// Token: 0x06000451 RID: 1105 RVA: 0x0000D9CB File Offset: 0x0000BBCB
	public override float GetEquipmentHeatResistanceModifier()
	{
		return this.GetEquipmentModifier(2);
	}

	// Token: 0x06000452 RID: 1106 RVA: 0x0000D9D4 File Offset: 0x0000BBD4
	public override float GetEquipmentJumpStaminaModifier()
	{
		return this.GetEquipmentModifier(3);
	}

	// Token: 0x06000453 RID: 1107 RVA: 0x0000D9DD File Offset: 0x0000BBDD
	public override float GetEquipmentAttackStaminaModifier()
	{
		return this.GetEquipmentModifier(4);
	}

	// Token: 0x06000454 RID: 1108 RVA: 0x0000D9E6 File Offset: 0x0000BBE6
	public override float GetEquipmentBlockStaminaModifier()
	{
		return this.GetEquipmentModifier(5);
	}

	// Token: 0x06000455 RID: 1109 RVA: 0x0000D9EF File Offset: 0x0000BBEF
	public override float GetEquipmentDodgeStaminaModifier()
	{
		return this.GetEquipmentModifier(6);
	}

	// Token: 0x06000456 RID: 1110 RVA: 0x0000D9F8 File Offset: 0x0000BBF8
	public override float GetEquipmentSwimStaminaModifier()
	{
		return this.GetEquipmentModifier(7);
	}

	// Token: 0x06000457 RID: 1111 RVA: 0x0000DA01 File Offset: 0x0000BC01
	public override float GetEquipmentSneakStaminaModifier()
	{
		return this.GetEquipmentModifier(8);
	}

	// Token: 0x06000458 RID: 1112 RVA: 0x0000DA0A File Offset: 0x0000BC0A
	public override float GetEquipmentRunStaminaModifier()
	{
		return this.GetEquipmentModifier(9);
	}

	// Token: 0x06000459 RID: 1113 RVA: 0x0000DA14 File Offset: 0x0000BC14
	public override float GetEquipmentMaxAdrenaline()
	{
		return this.GetEquipmentModifier(10);
	}

	// Token: 0x0600045A RID: 1114 RVA: 0x00046104 File Offset: 0x00044304
	private float GetEquipmentModifierPlusSE(int index)
	{
		float result = this.m_equipmentModifierValues[index];
		switch (index)
		{
		case 3:
			this.m_seman.ModifyJumpStaminaUsage(1f, ref result, false);
			break;
		case 4:
			this.m_seman.ModifyAttackStaminaUsage(1f, ref result, false);
			break;
		case 5:
			this.m_seman.ModifyBlockStaminaUsage(1f, ref result, false);
			break;
		case 6:
			this.m_seman.ModifyDodgeStaminaUsage(1f, ref result, false);
			break;
		case 7:
			this.m_seman.ModifySwimStaminaUsage(1f, ref result, false);
			break;
		case 8:
			this.m_seman.ModifySneakStaminaUsage(1f, ref result, false);
			break;
		case 9:
			this.m_seman.ModifyRunStaminaDrain(1f, ref result, Vector3.zero, false);
			break;
		}
		return result;
	}

	// Token: 0x0600045B RID: 1115 RVA: 0x0000DA1E File Offset: 0x0000BC1E
	protected override float GetJogSpeedFactor()
	{
		return 1f + this.GetEquipmentMovementModifier();
	}

	// Token: 0x0600045C RID: 1116 RVA: 0x000461E0 File Offset: 0x000443E0
	protected override float GetRunSpeedFactor()
	{
		float skillFactor = this.m_skills.GetSkillFactor(Skills.SkillType.Run);
		return (1f + skillFactor * 0.25f) * (1f + this.GetEquipmentMovementModifier() * 1.5f);
	}

	// Token: 0x0600045D RID: 1117 RVA: 0x0004621C File Offset: 0x0004441C
	public override bool InMinorAction()
	{
		int tagHash = this.m_animator.GetCurrentAnimatorStateInfo(1).tagHash;
		if (tagHash == Player.s_animatorTagMinorAction || tagHash == Player.s_animatorTagMinorActionFast)
		{
			return true;
		}
		if (this.m_animator.IsInTransition(1))
		{
			int tagHash2 = this.m_animator.GetNextAnimatorStateInfo(1).tagHash;
			return tagHash2 == Player.s_animatorTagMinorAction || tagHash2 == Player.s_animatorTagMinorActionFast;
		}
		return false;
	}

	// Token: 0x0600045E RID: 1118 RVA: 0x00046288 File Offset: 0x00044488
	public override bool InMinorActionSlowdown()
	{
		return this.m_animator.GetCurrentAnimatorStateInfo(1).tagHash == Player.s_animatorTagMinorAction || (this.m_animator.IsInTransition(1) && this.m_animator.GetNextAnimatorStateInfo(1).tagHash == Player.s_animatorTagMinorAction);
	}

	// Token: 0x0600045F RID: 1119 RVA: 0x000462E0 File Offset: 0x000444E0
	public override bool GetRelativePosition(out ZDOID parent, out string attachJoint, out Vector3 relativePos, out Quaternion relativeRot, out Vector3 relativeVel)
	{
		if (this.m_attached && this.m_attachPoint)
		{
			ZNetView componentInParent = this.m_attachPoint.GetComponentInParent<ZNetView>();
			if (componentInParent && componentInParent.IsValid())
			{
				parent = componentInParent.GetZDO().m_uid;
				if (componentInParent.GetComponent<Character>() != null)
				{
					attachJoint = this.m_attachPoint.name;
					relativePos = Vector3.zero;
					relativeRot = Quaternion.identity;
				}
				else
				{
					attachJoint = "";
					relativePos = componentInParent.transform.InverseTransformPoint(base.transform.position);
					relativeRot = Quaternion.Inverse(componentInParent.transform.rotation) * base.transform.rotation;
				}
				relativeVel = Vector3.zero;
				return true;
			}
		}
		return base.GetRelativePosition(out parent, out attachJoint, out relativePos, out relativeRot, out relativeVel);
	}

	// Token: 0x06000460 RID: 1120 RVA: 0x0000DA2C File Offset: 0x0000BC2C
	public override Skills GetSkills()
	{
		return this.m_skills;
	}

	// Token: 0x06000461 RID: 1121 RVA: 0x0000DA34 File Offset: 0x0000BC34
	public override float GetRandomSkillFactor(Skills.SkillType skill)
	{
		return this.m_skills.GetRandomSkillFactor(skill);
	}

	// Token: 0x06000462 RID: 1122 RVA: 0x0000DA42 File Offset: 0x0000BC42
	public override float GetSkillFactor(Skills.SkillType skill)
	{
		return this.m_skills.GetSkillFactor(skill);
	}

	// Token: 0x06000463 RID: 1123 RVA: 0x000463D4 File Offset: 0x000445D4
	protected override void DoDamageCameraShake(HitData hit)
	{
		float totalStaggerDamage = hit.m_damage.GetTotalStaggerDamage();
		if (GameCamera.instance && totalStaggerDamage > 0f)
		{
			float num = Mathf.Clamp01(totalStaggerDamage / base.GetMaxHealth());
			GameCamera.instance.AddShake(base.transform.position, 50f, this.m_baseCameraShake * num, false);
		}
	}

	// Token: 0x06000464 RID: 1124 RVA: 0x00046434 File Offset: 0x00044634
	protected override void DamageArmorDurability(HitData hit)
	{
		List<ItemDrop.ItemData> list = new List<ItemDrop.ItemData>();
		if (this.m_chestItem != null)
		{
			list.Add(this.m_chestItem);
		}
		if (this.m_legItem != null)
		{
			list.Add(this.m_legItem);
		}
		if (this.m_helmetItem != null)
		{
			list.Add(this.m_helmetItem);
		}
		if (this.m_shoulderItem != null)
		{
			list.Add(this.m_shoulderItem);
		}
		if (list.Count == 0)
		{
			return;
		}
		float num = hit.GetTotalPhysicalDamage() + hit.GetTotalElementalDamage();
		if (num <= 0f)
		{
			return;
		}
		int index = UnityEngine.Random.Range(0, list.Count);
		ItemDrop.ItemData itemData = list[index];
		itemData.m_durability = Mathf.Max(0f, itemData.m_durability - num);
	}

	// Token: 0x06000465 RID: 1125 RVA: 0x000464E4 File Offset: 0x000446E4
	protected override bool ToggleEquipped(ItemDrop.ItemData item)
	{
		if (!item.IsEquipable())
		{
			return false;
		}
		if (this.InAttack())
		{
			return true;
		}
		if (item.m_shared.m_equipDuration <= 0f)
		{
			if (base.IsItemEquiped(item))
			{
				base.UnequipItem(item, true);
			}
			else
			{
				base.EquipItem(item, true);
			}
		}
		else if (base.IsItemEquiped(item))
		{
			this.QueueUnequipAction(item);
		}
		else
		{
			this.QueueEquipAction(item);
		}
		return true;
	}

	// Token: 0x06000466 RID: 1126 RVA: 0x00046550 File Offset: 0x00044750
	public void GetActionProgress(out string name, out float progress, out Player.MinorActionData data)
	{
		Player.MinorActionData minorActionData;
		float num;
		if (this.TryGetFirstElementProgress(out minorActionData, out num))
		{
			data = minorActionData;
			name = minorActionData.m_progressText;
			progress = num;
			return;
		}
		data = null;
		name = null;
		progress = 0f;
	}

	// Token: 0x06000467 RID: 1127 RVA: 0x00046588 File Offset: 0x00044788
	public void GetActionProgress(out string name, out float progress)
	{
		Player.MinorActionData minorActionData;
		this.GetActionProgress(out name, out progress, out minorActionData);
	}

	// Token: 0x06000468 RID: 1128 RVA: 0x000465A0 File Offset: 0x000447A0
	private bool TryGetFirstElementProgress(out Player.MinorActionData firstElement, out float progress)
	{
		firstElement = null;
		progress = 0f;
		if (this.m_actionQueue.Count > 0)
		{
			firstElement = this.m_actionQueue[0];
			if (firstElement.m_duration > 0f)
			{
				progress = Mathf.Clamp01(firstElement.m_time / firstElement.m_duration);
			}
			return true;
		}
		return false;
	}

	// Token: 0x06000469 RID: 1129 RVA: 0x0000DA50 File Offset: 0x0000BC50
	public int GetActionQueueCount()
	{
		return this.m_actionQueue.Count;
	}

	// Token: 0x0600046A RID: 1130 RVA: 0x000465FC File Offset: 0x000447FC
	private void UpdateActionQueue(float dt)
	{
		if (this.m_actionQueuePause > 0f)
		{
			this.m_actionQueuePause -= dt;
			if (this.m_actionAnimation != null)
			{
				this.m_zanim.SetBool(this.m_actionAnimation, false);
				this.m_actionAnimation = null;
			}
			return;
		}
		if (this.InAttack())
		{
			if (this.m_actionAnimation != null)
			{
				this.m_zanim.SetBool(this.m_actionAnimation, false);
				this.m_actionAnimation = null;
			}
			return;
		}
		if (this.m_actionQueue.Count == 0)
		{
			if (this.m_actionAnimation != null)
			{
				this.m_zanim.SetBool(this.m_actionAnimation, false);
				this.m_actionAnimation = null;
			}
			return;
		}
		Player.MinorActionData minorActionData = this.m_actionQueue[0];
		if (this.m_actionAnimation != null && this.m_actionAnimation != minorActionData.m_animation)
		{
			this.m_zanim.SetBool(this.m_actionAnimation, false);
			this.m_actionAnimation = null;
		}
		this.m_zanim.SetBool(minorActionData.m_animation, true);
		this.m_actionAnimation = minorActionData.m_animation;
		if (minorActionData.m_time == 0f && minorActionData.m_startEffect != null)
		{
			minorActionData.m_startEffect.Create(base.transform.position, Quaternion.identity, null, 1f, -1);
		}
		if (minorActionData.m_staminaDrain > 0f)
		{
			this.UseStamina(minorActionData.m_staminaDrain * dt);
		}
		if (minorActionData.m_eitrDrain > 0f)
		{
			this.UseEitr(minorActionData.m_eitrDrain * dt);
		}
		minorActionData.m_time += dt;
		if (minorActionData.m_time > minorActionData.m_duration)
		{
			this.m_actionQueue.RemoveAt(0);
			this.m_zanim.SetBool(this.m_actionAnimation, false);
			this.m_actionAnimation = null;
			if (!string.IsNullOrEmpty(minorActionData.m_doneAnimation))
			{
				this.m_zanim.SetTrigger(minorActionData.m_doneAnimation);
			}
			switch (minorActionData.m_type)
			{
			case Player.MinorActionData.ActionType.Equip:
				base.EquipItem(minorActionData.m_item, true);
				break;
			case Player.MinorActionData.ActionType.Unequip:
				base.UnequipItem(minorActionData.m_item, true);
				break;
			case Player.MinorActionData.ActionType.Reload:
				this.SetWeaponLoaded(minorActionData.m_item);
				break;
			}
			this.m_actionQueuePause = 0.3f;
		}
	}

	// Token: 0x0600046B RID: 1131 RVA: 0x00046820 File Offset: 0x00044A20
	private void QueueEquipAction(ItemDrop.ItemData item)
	{
		if (item == null)
		{
			return;
		}
		if (this.IsEquipActionQueued(item))
		{
			this.RemoveEquipAction(item);
			return;
		}
		this.CancelReloadAction();
		Player.MinorActionData minorActionData = new Player.MinorActionData();
		minorActionData.m_item = item;
		minorActionData.m_type = Player.MinorActionData.ActionType.Equip;
		minorActionData.m_duration = item.m_shared.m_equipDuration;
		minorActionData.m_progressText = "$hud_equipping " + item.m_shared.m_name;
		minorActionData.m_animation = "equipping";
		if (minorActionData.m_duration >= 1f)
		{
			minorActionData.m_startEffect = this.m_equipStartEffects;
		}
		this.m_actionQueue.Add(minorActionData);
	}

	// Token: 0x0600046C RID: 1132 RVA: 0x000468B8 File Offset: 0x00044AB8
	private void QueueUnequipAction(ItemDrop.ItemData item)
	{
		if (item == null)
		{
			return;
		}
		if (this.IsEquipActionQueued(item))
		{
			this.RemoveEquipAction(item);
			return;
		}
		this.CancelReloadAction();
		Player.MinorActionData minorActionData = new Player.MinorActionData();
		minorActionData.m_item = item;
		minorActionData.m_type = Player.MinorActionData.ActionType.Unequip;
		minorActionData.m_duration = item.m_shared.m_equipDuration;
		minorActionData.m_progressText = "$hud_unequipping " + item.m_shared.m_name;
		minorActionData.m_animation = "equipping";
		this.m_actionQueue.Add(minorActionData);
	}

	// Token: 0x0600046D RID: 1133 RVA: 0x00046938 File Offset: 0x00044B38
	private void QueueReloadAction()
	{
		if (this.IsReloadActionQueued())
		{
			return;
		}
		ItemDrop.ItemData currentWeapon = base.GetCurrentWeapon();
		if (currentWeapon == null || !currentWeapon.m_shared.m_attack.m_requiresReload)
		{
			return;
		}
		Player.MinorActionData minorActionData = new Player.MinorActionData();
		minorActionData.m_item = currentWeapon;
		minorActionData.m_type = Player.MinorActionData.ActionType.Reload;
		minorActionData.m_duration = currentWeapon.GetWeaponLoadingTime();
		minorActionData.m_progressText = "$hud_reloading " + currentWeapon.m_shared.m_name;
		minorActionData.m_animation = currentWeapon.m_shared.m_attack.m_reloadAnimation;
		minorActionData.m_doneAnimation = currentWeapon.m_shared.m_attack.m_reloadAnimation + "_done";
		minorActionData.m_staminaDrain = currentWeapon.m_shared.m_attack.m_reloadStaminaDrain;
		minorActionData.m_eitrDrain = currentWeapon.m_shared.m_attack.m_reloadEitrDrain;
		this.m_actionQueue.Add(minorActionData);
	}

	// Token: 0x0600046E RID: 1134 RVA: 0x0000DA5D File Offset: 0x0000BC5D
	protected override void ClearActionQueue()
	{
		this.m_actionQueue.Clear();
	}

	// Token: 0x0600046F RID: 1135 RVA: 0x00046A14 File Offset: 0x00044C14
	public override void RemoveEquipAction(ItemDrop.ItemData item)
	{
		if (item == null)
		{
			return;
		}
		foreach (Player.MinorActionData minorActionData in this.m_actionQueue)
		{
			if (minorActionData.m_item == item)
			{
				this.m_actionQueue.Remove(minorActionData);
				break;
			}
		}
	}

	// Token: 0x06000470 RID: 1136 RVA: 0x00046A7C File Offset: 0x00044C7C
	public bool IsEquipActionQueued(ItemDrop.ItemData item)
	{
		if (item == null)
		{
			return false;
		}
		foreach (Player.MinorActionData minorActionData in this.m_actionQueue)
		{
			if ((minorActionData.m_type == Player.MinorActionData.ActionType.Equip || minorActionData.m_type == Player.MinorActionData.ActionType.Unequip) && minorActionData.m_item == item)
			{
				return true;
			}
		}
		return false;
	}

	// Token: 0x06000471 RID: 1137 RVA: 0x00046AF0 File Offset: 0x00044CF0
	private bool IsReloadActionQueued()
	{
		using (List<Player.MinorActionData>.Enumerator enumerator = this.m_actionQueue.GetEnumerator())
		{
			while (enumerator.MoveNext())
			{
				if (enumerator.Current.m_type == Player.MinorActionData.ActionType.Reload)
				{
					return true;
				}
			}
		}
		return false;
	}

	// Token: 0x06000472 RID: 1138 RVA: 0x00046B4C File Offset: 0x00044D4C
	public void ResetCharacter()
	{
		this.m_guardianPowerCooldown = 0f;
		Player.ResetSeenTutorials();
		this.m_knownRecipes.Clear();
		this.m_knownStations.Clear();
		this.m_knownMaterial.Clear();
		this.m_uniques.Clear();
		this.m_trophies.Clear();
		this.m_skills.Clear();
		this.m_knownBiome.Clear();
		this.m_knownTexts.Clear();
	}

	// Token: 0x06000473 RID: 1139 RVA: 0x0000DA6A File Offset: 0x0000BC6A
	public void ResetCharacterKnownItems()
	{
		this.m_knownRecipes.Clear();
		this.m_knownStations.Clear();
		this.m_knownMaterial.Clear();
		this.m_trophies.Clear();
	}

	// Token: 0x06000474 RID: 1140 RVA: 0x00046BC4 File Offset: 0x00044DC4
	public bool ToggleDebugFly()
	{
		this.m_debugFly = !this.m_debugFly;
		this.m_nview.GetZDO().Set(ZDOVars.s_debugFly, this.m_debugFly);
		this.Message(MessageHud.MessageType.TopLeft, "Debug fly:" + this.m_debugFly.ToString(), 0, null);
		return this.m_debugFly;
	}

	// Token: 0x06000475 RID: 1141 RVA: 0x0000DA98 File Offset: 0x0000BC98
	public void SetNoPlacementCost(bool value)
	{
		if (value != this.m_noPlacementCost)
		{
			this.ToggleNoPlacementCost();
		}
	}

	// Token: 0x06000476 RID: 1142 RVA: 0x0000DAAA File Offset: 0x0000BCAA
	public bool ToggleNoPlacementCost()
	{
		this.m_noPlacementCost = !this.m_noPlacementCost;
		this.Message(MessageHud.MessageType.TopLeft, "No placement cost:" + this.m_noPlacementCost.ToString(), 0, null);
		this.UpdateAvailablePiecesList();
		return this.m_noPlacementCost;
	}

	// Token: 0x06000477 RID: 1143 RVA: 0x0000CF0E File Offset: 0x0000B10E
	public bool IsKnownMaterial(string name)
	{
		return this.m_knownMaterial.Contains(name);
	}

	// Token: 0x17000011 RID: 17
	// (get) Token: 0x06000478 RID: 1144 RVA: 0x0000DAE5 File Offset: 0x0000BCE5
	public bool AlternativePlacementActive
	{
		get
		{
			return this.m_altPlace;
		}
	}

	// Token: 0x17000012 RID: 18
	// (get) Token: 0x06000479 RID: 1145 RVA: 0x0000DAED File Offset: 0x0000BCED
	public SeasonalItemGroup CurrentSeason
	{
		get
		{
			return this.m_currentSeason;
		}
	}

	// Token: 0x040004BD RID: 1213
	private Vector3 m_lastDistCheck;

	// Token: 0x040004BE RID: 1214
	private float m_statCheck;

	// Token: 0x040004BF RID: 1215
	[Header("Effects")]
	public EffectList m_buttonEffects = new EffectList();

	// Token: 0x040004C0 RID: 1216
	private List<string> m_readyEvents = new List<string>();

	// Token: 0x040004C1 RID: 1217
	private float m_lastMaxAdrenaline;

	// Token: 0x040004C2 RID: 1218
	private static List<IPlaced> m_placed = new List<IPlaced>();

	// Token: 0x040004C3 RID: 1219
	public static string LastEmote;

	// Token: 0x040004C4 RID: 1220
	public static DateTime LastEmoteTime;

	// Token: 0x040004C5 RID: 1221
	private float[] m_equipmentModifierValues;

	// Token: 0x040004C6 RID: 1222
	private static FieldInfo[] s_equipmentModifierSourceFields;

	// Token: 0x040004C7 RID: 1223
	private static readonly string[] s_equipmentModifierSources = new string[]
	{
		"m_movementModifier",
		"m_homeItemsStaminaModifier",
		"m_heatResistanceModifier",
		"m_jumpStaminaModifier",
		"m_attackStaminaModifier",
		"m_blockStaminaModifier",
		"m_dodgeStaminaModifier",
		"m_swimStaminaModifier",
		"m_sneakStaminaModifier",
		"m_runStaminaModifier",
		"m_maxAdrenaline"
	};

	// Token: 0x040004C8 RID: 1224
	private static readonly string[] s_equipmentModifierTooltips = new string[]
	{
		"$item_movement_modifier",
		"$base_item_modifier",
		"$item_heat_modifier",
		"$se_jumpstamina",
		"$se_attackstamina",
		"$se_blockstamina",
		"$se_dodgestamina",
		"$se_swimstamina",
		"$se_sneakstamina",
		"$se_runstamina",
		"$item_maxadrenaline"
	};

	// Token: 0x040004C9 RID: 1225
	private float m_baseValueUpdateTimer;

	// Token: 0x040004CA RID: 1226
	private float m_rotatePieceTimer;

	// Token: 0x040004CB RID: 1227
	private float m_rotatePieceTimeSince;

	// Token: 0x040004CC RID: 1228
	private float m_scrollCurrAmount;

	// Token: 0x040004CD RID: 1229
	private bool m_altPlace;

	// Token: 0x040004CE RID: 1230
	public static Player m_localPlayer = null;

	// Token: 0x040004CF RID: 1231
	private static readonly List<Player> s_players = new List<Player>();

	// Token: 0x040004D0 RID: 1232
	public static List<string> m_addUniqueKeyQueue = new List<string>();

	// Token: 0x040004D1 RID: 1233
	public static List<string> s_FilterCraft = new List<string>();

	// Token: 0x040004D2 RID: 1234
	public static bool m_debugMode = false;

	// Token: 0x040004D3 RID: 1235
	[Header("Player")]
	public float m_maxPlaceDistance = 5f;

	// Token: 0x040004D4 RID: 1236
	public float m_maxInteractDistance = 5f;

	// Token: 0x040004D5 RID: 1237
	public float m_scrollSens = 4f;

	// Token: 0x040004D6 RID: 1238
	public float m_autoPickupRange = 2f;

	// Token: 0x040004D7 RID: 1239
	public float m_maxCarryWeight = 300f;

	// Token: 0x040004D8 RID: 1240
	public float m_encumberedStaminaDrain = 10f;

	// Token: 0x040004D9 RID: 1241
	public float m_hardDeathCooldown = 10f;

	// Token: 0x040004DA RID: 1242
	public float m_baseCameraShake = 4f;

	// Token: 0x040004DB RID: 1243
	public float m_placeDelay = 0.4f;

	// Token: 0x040004DC RID: 1244
	public float m_removeDelay = 0.25f;

	// Token: 0x040004DD RID: 1245
	public GameObject m_placeMarker;

	// Token: 0x040004DE RID: 1246
	public GameObject m_tombstone;

	// Token: 0x040004DF RID: 1247
	public SoftReference<GameObject> m_valkyrie;

	// Token: 0x040004E0 RID: 1248
	public Sprite m_textIcon;

	// Token: 0x040004E1 RID: 1249
	public float m_baseHP = 25f;

	// Token: 0x040004E2 RID: 1250
	public float m_baseStamina = 75f;

	// Token: 0x040004E3 RID: 1251
	public double m_wakeupTime;

	// Token: 0x040004E4 RID: 1252
	[Header("Stamina")]
	public float m_staminaRegen = 5f;

	// Token: 0x040004E5 RID: 1253
	public float m_staminaRegenTimeMultiplier = 1f;

	// Token: 0x040004E6 RID: 1254
	public float m_staminaRegenDelay = 1f;

	// Token: 0x040004E7 RID: 1255
	public float m_runStaminaDrain = 10f;

	// Token: 0x040004E8 RID: 1256
	public float m_sneakStaminaDrain = 5f;

	// Token: 0x040004E9 RID: 1257
	public float m_swimStaminaDrainMinSkill = 5f;

	// Token: 0x040004EA RID: 1258
	public float m_swimStaminaDrainMaxSkill = 2f;

	// Token: 0x040004EB RID: 1259
	public float m_dodgeStaminaUsage = 10f;

	// Token: 0x040004EC RID: 1260
	public float m_dodgeAdrenaline = 10f;

	// Token: 0x040004ED RID: 1261
	public float m_weightStaminaFactor = 0.1f;

	// Token: 0x040004EE RID: 1262
	[Header("Adrenaline")]
	public float m_maxAdrenaline = 100f;

	// Token: 0x040004EF RID: 1263
	public AnimationCurve m_adrenalineDegen = new AnimationCurve();

	// Token: 0x040004F0 RID: 1264
	public AnimationCurve m_adrenalineDegenDelay = new AnimationCurve();

	// Token: 0x040004F1 RID: 1265
	public float m_perfectDodgeAdrenaline = 10f;

	// Token: 0x040004F2 RID: 1266
	public float m_perfectDodgeStaminaReturnMultiplier;

	// Token: 0x040004F3 RID: 1267
	public float m_attackMissAdrenaline = -5f;

	// Token: 0x040004F4 RID: 1268
	public float m_nonBlockDamageAdrenaline = -5f;

	// Token: 0x040004F5 RID: 1269
	public float m_staggerEnemyAdrenaline = 5f;

	// Token: 0x040004F6 RID: 1270
	public AnimationCurve m_adrenalineGainMultiplier = new AnimationCurve();

	// Token: 0x040004F7 RID: 1271
	public List<Player.StatusEffectLevel> m_adrenalineEffects = new List<Player.StatusEffectLevel>();

	// Token: 0x040004F8 RID: 1272
	public EffectList m_adrenalinePopEffects = new EffectList();

	// Token: 0x040004F9 RID: 1273
	[Header("Eitr")]
	public float m_eiterRegen = 5f;

	// Token: 0x040004FA RID: 1274
	public float m_eitrRegenDelay = 1f;

	// Token: 0x040004FB RID: 1275
	[Header("Player Effects")]
	public EffectList m_drownEffects = new EffectList();

	// Token: 0x040004FC RID: 1276
	public EffectList m_spawnEffects = new EffectList();

	// Token: 0x040004FD RID: 1277
	public EffectList m_removeEffects = new EffectList();

	// Token: 0x040004FE RID: 1278
	public EffectList m_dodgeEffects = new EffectList();

	// Token: 0x040004FF RID: 1279
	public EffectList m_autopickupEffects = new EffectList();

	// Token: 0x04000500 RID: 1280
	public EffectList m_skillLevelupEffects = new EffectList();

	// Token: 0x04000501 RID: 1281
	public EffectList m_equipStartEffects = new EffectList();

	// Token: 0x04000502 RID: 1282
	public EffectList m_perfectDodgeEffects = new EffectList();

	// Token: 0x04000503 RID: 1283
	private Skills m_skills;

	// Token: 0x04000504 RID: 1284
	private PieceTable m_buildPieces;

	// Token: 0x04000505 RID: 1285
	private bool m_noPlacementCost;

	// Token: 0x04000506 RID: 1286
	private const bool m_hideUnavailable = false;

	// Token: 0x04000507 RID: 1287
	private static bool m_enableAutoPickup = true;

	// Token: 0x04000508 RID: 1288
	private readonly HashSet<string> m_knownRecipes = new HashSet<string>();

	// Token: 0x04000509 RID: 1289
	private readonly Dictionary<string, int> m_knownStations = new Dictionary<string, int>();

	// Token: 0x0400050A RID: 1290
	private readonly HashSet<string> m_knownMaterial = new HashSet<string>();

	// Token: 0x0400050B RID: 1291
	private readonly HashSet<string> m_shownTutorials = new HashSet<string>();

	// Token: 0x0400050C RID: 1292
	private readonly HashSet<string> m_uniques = new HashSet<string>();

	// Token: 0x0400050D RID: 1293
	private readonly HashSet<string> m_trophies = new HashSet<string>();

	// Token: 0x0400050E RID: 1294
	private readonly HashSet<Heightmap.Biome> m_knownBiome = new HashSet<Heightmap.Biome>();

	// Token: 0x0400050F RID: 1295
	private readonly Dictionary<string, string> m_knownTexts = new Dictionary<string, string>();

	// Token: 0x04000510 RID: 1296
	private float m_stationDiscoverTimer;

	// Token: 0x04000511 RID: 1297
	private bool m_debugFly;

	// Token: 0x04000512 RID: 1298
	private bool m_godMode;

	// Token: 0x04000513 RID: 1299
	private bool m_ghostMode;

	// Token: 0x04000514 RID: 1300
	private float m_lookPitch;

	// Token: 0x04000515 RID: 1301
	private const int m_maxFoods = 3;

	// Token: 0x04000516 RID: 1302
	private const float m_foodDrainPerSec = 0.1f;

	// Token: 0x04000517 RID: 1303
	private float m_foodUpdateTimer;

	// Token: 0x04000518 RID: 1304
	private float m_foodRegenTimer;

	// Token: 0x04000519 RID: 1305
	private readonly List<Player.Food> m_foods = new List<Player.Food>();

	// Token: 0x0400051A RID: 1306
	private float m_stamina = 100f;

	// Token: 0x0400051B RID: 1307
	private float m_maxStamina = 100f;

	// Token: 0x0400051C RID: 1308
	private float m_staminaRegenTimer;

	// Token: 0x0400051D RID: 1309
	private float m_adrenaline;

	// Token: 0x0400051E RID: 1310
	private float m_adrenalineDegenTimer;

	// Token: 0x0400051F RID: 1311
	private float m_adrenalineGuardianPower = 10f;

	// Token: 0x04000520 RID: 1312
	private float m_eitr;

	// Token: 0x04000521 RID: 1313
	private float m_maxEitr;

	// Token: 0x04000522 RID: 1314
	private float m_eitrRegenTimer;

	// Token: 0x04000523 RID: 1315
	private string m_guardianPower = "";

	// Token: 0x04000524 RID: 1316
	private int m_guardianPowerHash;

	// Token: 0x04000525 RID: 1317
	public float m_guardianPowerCooldown;

	// Token: 0x04000526 RID: 1318
	private StatusEffect m_guardianSE;

	// Token: 0x04000527 RID: 1319
	private float m_placePressedTime = -1000f;

	// Token: 0x04000528 RID: 1320
	private float m_removePressedTime = -1000f;

	// Token: 0x04000529 RID: 1321
	private bool m_blockRemove;

	// Token: 0x0400052A RID: 1322
	private float m_lastToolUseTime;

	// Token: 0x0400052B RID: 1323
	private GameObject m_placementMarkerInstance;

	// Token: 0x0400052C RID: 1324
	private GameObject m_placementGhost;

	// Token: 0x0400052D RID: 1325
	private string m_placementGhostLast;

	// Token: 0x0400052E RID: 1326
	private Player.PlacementStatus m_placementStatus = Player.PlacementStatus.Invalid;

	// Token: 0x0400052F RID: 1327
	private float m_placeRotationDegrees = 22.5f;

	// Token: 0x04000530 RID: 1328
	private int m_placeRotation;

	// Token: 0x04000531 RID: 1329
	public float m_scrollAmountThreshold = 0.1f;

	// Token: 0x04000532 RID: 1330
	private int m_buildRemoveDebt;

	// Token: 0x04000533 RID: 1331
	private int m_placeRayMask;

	// Token: 0x04000534 RID: 1332
	private int m_placeGroundRayMask;

	// Token: 0x04000535 RID: 1333
	private int m_placeWaterRayMask;

	// Token: 0x04000536 RID: 1334
	private int m_removeRayMask;

	// Token: 0x04000537 RID: 1335
	private int m_interactMask;

	// Token: 0x04000538 RID: 1336
	private int m_autoPickupMask;

	// Token: 0x04000539 RID: 1337
	private readonly List<Player.MinorActionData> m_actionQueue = new List<Player.MinorActionData>();

	// Token: 0x0400053A RID: 1338
	private float m_actionQueuePause;

	// Token: 0x0400053B RID: 1339
	private string m_actionAnimation;

	// Token: 0x0400053C RID: 1340
	private GameObject m_hovering;

	// Token: 0x0400053D RID: 1341
	private Character m_hoveringCreature;

	// Token: 0x0400053E RID: 1342
	private float m_lastHoverInteractTime;

	// Token: 0x0400053F RID: 1343
	private bool m_pvp;

	// Token: 0x04000540 RID: 1344
	private float m_updateCoverTimer;

	// Token: 0x04000541 RID: 1345
	private float m_coverPercentage;

	// Token: 0x04000542 RID: 1346
	private bool m_underRoof = true;

	// Token: 0x04000543 RID: 1347
	private float m_nearFireTimer;

	// Token: 0x04000544 RID: 1348
	private bool m_isLoading;

	// Token: 0x04000545 RID: 1349
	private ItemDrop.ItemData m_weaponLoaded;

	// Token: 0x04000546 RID: 1350
	private float m_queuedAttackTimer;

	// Token: 0x04000547 RID: 1351
	private float m_queuedSecondAttackTimer;

	// Token: 0x04000548 RID: 1352
	private float m_queuedDodgeTimer;

	// Token: 0x04000549 RID: 1353
	private Vector3 m_queuedDodgeDir = Vector3.zero;

	// Token: 0x0400054A RID: 1354
	private bool m_inDodge;

	// Token: 0x0400054B RID: 1355
	private bool m_dodgeInvincible;

	// Token: 0x0400054C RID: 1356
	private CraftingStation m_currentStation;

	// Token: 0x0400054D RID: 1357
	private bool m_inCraftingStation;

	// Token: 0x0400054E RID: 1358
	private Ragdoll m_ragdoll;

	// Token: 0x0400054F RID: 1359
	private Piece m_hoveringPiece;

	// Token: 0x04000550 RID: 1360
	private Dictionary<Material, float> m_ghostRippleDistance = new Dictionary<Material, float>();

	// Token: 0x04000551 RID: 1361
	private bool m_attackTowardsPlayerLookDir;

	// Token: 0x04000552 RID: 1362
	private string m_emoteState = "";

	// Token: 0x04000553 RID: 1363
	private int m_emoteID;

	// Token: 0x04000554 RID: 1364
	private bool m_intro;

	// Token: 0x04000555 RID: 1365
	private bool m_crouchToggled;

	// Token: 0x04000556 RID: 1366
	public bool m_autoRun;

	// Token: 0x04000557 RID: 1367
	private bool m_safeInHome;

	// Token: 0x04000558 RID: 1368
	private IDoodadController m_doodadController;

	// Token: 0x04000559 RID: 1369
	private bool m_attached;

	// Token: 0x0400055A RID: 1370
	private string m_attachAnimation = "";

	// Token: 0x0400055B RID: 1371
	private bool m_sleeping;

	// Token: 0x0400055C RID: 1372
	private bool m_attachedToShip;

	// Token: 0x0400055D RID: 1373
	private Transform m_attachPoint;

	// Token: 0x0400055E RID: 1374
	private Vector3 m_detachOffset = Vector3.zero;

	// Token: 0x0400055F RID: 1375
	private Transform m_attachPointCamera;

	// Token: 0x04000560 RID: 1376
	private Collider[] m_attachColliders;

	// Token: 0x04000561 RID: 1377
	private int m_modelIndex;

	// Token: 0x04000562 RID: 1378
	private Vector3 m_skinColor = Vector3.one;

	// Token: 0x04000563 RID: 1379
	private Vector3 m_hairColor = Vector3.one;

	// Token: 0x04000564 RID: 1380
	private bool m_teleporting;

	// Token: 0x04000565 RID: 1381
	private bool m_distantTeleport;

	// Token: 0x04000566 RID: 1382
	private float m_teleportTimer;

	// Token: 0x04000567 RID: 1383
	private float m_teleportCooldown;

	// Token: 0x04000568 RID: 1384
	private Vector3 m_teleportFromPos;

	// Token: 0x04000569 RID: 1385
	private Quaternion m_teleportFromRot;

	// Token: 0x0400056A RID: 1386
	private Vector3 m_teleportTargetPos;

	// Token: 0x0400056B RID: 1387
	private Quaternion m_teleportTargetRot;

	// Token: 0x0400056C RID: 1388
	private bool m_beenHitWhileDodging;

	// Token: 0x0400056D RID: 1389
	private Heightmap.Biome m_currentBiome;

	// Token: 0x0400056E RID: 1390
	private float m_biomeTimer;

	// Token: 0x0400056F RID: 1391
	private List<string> m_tempUniqueKeys = new List<string>();

	// Token: 0x04000570 RID: 1392
	private int m_baseValue;

	// Token: 0x04000571 RID: 1393
	private int m_baseValueOld = -1;

	// Token: 0x04000572 RID: 1394
	private int m_comfortLevel;

	// Token: 0x04000573 RID: 1395
	private float m_drownDamageTimer;

	// Token: 0x04000574 RID: 1396
	private float m_timeSinceTargeted;

	// Token: 0x04000575 RID: 1397
	private float m_timeSinceSensed;

	// Token: 0x04000576 RID: 1398
	private float m_stealthFactorUpdateTimer;

	// Token: 0x04000577 RID: 1399
	private float m_stealthFactor;

	// Token: 0x04000578 RID: 1400
	private float m_stealthFactorTarget;

	// Token: 0x04000579 RID: 1401
	private Vector3 m_lastStealthPosition = Vector3.zero;

	// Token: 0x0400057A RID: 1402
	private float m_lastVelocity;

	// Token: 0x0400057B RID: 1403
	private float m_wakeupTimer = -1f;

	// Token: 0x0400057C RID: 1404
	private float m_timeSinceDeath = 999999f;

	// Token: 0x0400057D RID: 1405
	private float m_runSkillImproveTimer;

	// Token: 0x0400057E RID: 1406
	private float m_swimSkillImproveTimer;

	// Token: 0x0400057F RID: 1407
	private float m_sneakSkillImproveTimer;

	// Token: 0x04000580 RID: 1408
	private int m_manualSnapPoint = -1;

	// Token: 0x04000581 RID: 1409
	private readonly List<PieceTable> m_tempOwnedPieceTables = new List<PieceTable>();

	// Token: 0x04000582 RID: 1410
	private readonly List<Transform> m_tempSnapPoints1 = new List<Transform>();

	// Token: 0x04000583 RID: 1411
	private readonly List<Transform> m_tempSnapPoints2 = new List<Transform>();

	// Token: 0x04000584 RID: 1412
	private readonly List<Piece> m_tempPieces = new List<Piece>();

	// Token: 0x04000585 RID: 1413
	[HideInInspector]
	public Dictionary<string, string> m_customData = new Dictionary<string, string>();

	// Token: 0x04000586 RID: 1414
	private static int s_attackMask = 0;

	// Token: 0x04000587 RID: 1415
	private static readonly int s_crouching = ZSyncAnimation.GetHash("crouching");

	// Token: 0x04000588 RID: 1416
	private static readonly int s_animatorTagDodge = ZSyncAnimation.GetHash("dodge");

	// Token: 0x04000589 RID: 1417
	private static readonly int s_animatorTagCutscene = ZSyncAnimation.GetHash("cutscene");

	// Token: 0x0400058A RID: 1418
	private static readonly int s_animatorTagCrouch = ZSyncAnimation.GetHash("crouch");

	// Token: 0x0400058B RID: 1419
	private static readonly int s_animatorTagMinorAction = ZSyncAnimation.GetHash("minoraction");

	// Token: 0x0400058C RID: 1420
	private static readonly int s_animatorTagMinorActionFast = ZSyncAnimation.GetHash("minoraction_fast");

	// Token: 0x0400058D RID: 1421
	private static readonly int s_animatorTagEmote = ZSyncAnimation.GetHash("emote");

	// Token: 0x0400058E RID: 1422
	public const string BaseValueKey = "baseValue";

	// Token: 0x0400058F RID: 1423
	private int m_cachedFrame;

	// Token: 0x04000590 RID: 1424
	private bool m_cachedAttack;

	// Token: 0x04000591 RID: 1425
	private bool m_dodgeInvincibleCached;

	// Token: 0x04000592 RID: 1426
	[Header("Seasonal Items")]
	[SerializeField]
	private List<SeasonalItemGroup> m_seasonalItemGroups = new List<SeasonalItemGroup>();

	// Token: 0x04000593 RID: 1427
	private SeasonalItemGroup m_currentSeason;

	// Token: 0x04000594 RID: 1428
	private readonly RaycastHit[] m_raycastHoverHits = new RaycastHit[64];

	// Token: 0x02000044 RID: 68
	public enum RequirementMode
	{
		// Token: 0x04000596 RID: 1430
		CanBuild,
		// Token: 0x04000597 RID: 1431
		IsKnown,
		// Token: 0x04000598 RID: 1432
		CanAlmostBuild
	}

	// Token: 0x02000045 RID: 69
	public class Food
	{
		// Token: 0x0600047C RID: 1148 RVA: 0x0000DAF5 File Offset: 0x0000BCF5
		public bool CanEatAgain()
		{
			return this.m_time < this.m_item.m_shared.m_foodBurnTime / 2f;
		}

		// Token: 0x04000599 RID: 1433
		public string m_name = "";

		// Token: 0x0400059A RID: 1434
		public ItemDrop.ItemData m_item;

		// Token: 0x0400059B RID: 1435
		public float m_time;

		// Token: 0x0400059C RID: 1436
		public float m_health;

		// Token: 0x0400059D RID: 1437
		public float m_stamina;

		// Token: 0x0400059E RID: 1438
		public float m_eitr;
	}

	// Token: 0x02000046 RID: 70
	public class MinorActionData
	{
		// Token: 0x0400059F RID: 1439
		public Player.MinorActionData.ActionType m_type;

		// Token: 0x040005A0 RID: 1440
		public ItemDrop.ItemData m_item;

		// Token: 0x040005A1 RID: 1441
		public string m_progressText = "";

		// Token: 0x040005A2 RID: 1442
		public float m_time;

		// Token: 0x040005A3 RID: 1443
		public float m_duration;

		// Token: 0x040005A4 RID: 1444
		public string m_animation = "";

		// Token: 0x040005A5 RID: 1445
		public string m_doneAnimation = "";

		// Token: 0x040005A6 RID: 1446
		public float m_staminaDrain;

		// Token: 0x040005A7 RID: 1447
		public float m_eitrDrain;

		// Token: 0x040005A8 RID: 1448
		public EffectList m_startEffect;

		// Token: 0x02000047 RID: 71
		public enum ActionType
		{
			// Token: 0x040005AA RID: 1450
			Equip,
			// Token: 0x040005AB RID: 1451
			Unequip,
			// Token: 0x040005AC RID: 1452
			Reload
		}
	}

	// Token: 0x02000048 RID: 72
	public enum PlacementStatus
	{
		// Token: 0x040005AE RID: 1454
		Valid,
		// Token: 0x040005AF RID: 1455
		Invalid,
		// Token: 0x040005B0 RID: 1456
		BlockedbyPlayer,
		// Token: 0x040005B1 RID: 1457
		NoBuildZone,
		// Token: 0x040005B2 RID: 1458
		PrivateZone,
		// Token: 0x040005B3 RID: 1459
		MoreSpace,
		// Token: 0x040005B4 RID: 1460
		NoTeleportArea,
		// Token: 0x040005B5 RID: 1461
		ExtensionMissingStation,
		// Token: 0x040005B6 RID: 1462
		WrongBiome,
		// Token: 0x040005B7 RID: 1463
		NeedCultivated,
		// Token: 0x040005B8 RID: 1464
		NeedDirt,
		// Token: 0x040005B9 RID: 1465
		NotInDungeon,
		// Token: 0x040005BA RID: 1466
		NoRayHits
	}

	// Token: 0x02000049 RID: 73
	private class RaycastHitComparer : IComparer<RaycastHit>
	{
		// Token: 0x0600047F RID: 1151 RVA: 0x00027F48 File Offset: 0x00026148
		public int Compare(RaycastHit x, RaycastHit y)
		{
			return x.distance.CompareTo(y.distance);
		}

		// Token: 0x040005BB RID: 1467
		public static Player.RaycastHitComparer Instance = new Player.RaycastHitComparer();
	}

	// Token: 0x0200004A RID: 74
	[Serializable]
	public struct StatusEffectLevel
	{
		// Token: 0x040005BC RID: 1468
		public float m_rate;

		// Token: 0x040005BD RID: 1469
		public StatusEffect m_se;
	}
}
